{"content":"<h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<ul>\n<li>åˆ†ç±»ï¼šæ·±åº¦å­¦ä¹ ä¼˜åŒ–</li>\n<li>æ ‡ç­¾ï¼šDoRAï¼ŒLoRAï¼Œæƒé‡åˆ†è§£ï¼Œæ·±åº¦å­¦ä¹ </li>\n<li>æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥</li>\n</ul>\n<h2 id=\"æ ¸å¿ƒè§‚ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒè§‚ç‚¹\"><span>æ ¸å¿ƒè§‚ç‚¹</span></a></h2>\n<p>DoRAæ˜¯ä¸€ç§ç”¨äºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡å°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µæ‹†åˆ†ä¸ºå¤§å°å‘é‡å’Œæ–¹å‘çŸ©é˜µä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«è¿›è¡Œè®­ç»ƒå’Œå¤„ç†ï¼Œä»¥æå‡æ¨¡å‹æ€§èƒ½ã€‚</p>\n<h2 id=\"é‡ç‚¹æ®µè½\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#é‡ç‚¹æ®µè½\"><span>é‡ç‚¹æ®µè½</span></a></h2>\n<h3 id=\"doraçš„åŸºæœ¬æ­¥éª¤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#doraçš„åŸºæœ¬æ­¥éª¤\"><span>DoRAçš„åŸºæœ¬æ­¥éª¤</span></a></h3>\n<ol>\n<li><strong>æƒé‡çŸ©é˜µæ‹†åˆ†</strong>ï¼šå°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µåˆ†è§£ä¸ºä¸¤ä¸ªéƒ¨åˆ†â€”â€”å¤§å°å‘é‡ï¼ˆ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>ï¼‰å’Œæ–¹å‘çŸ©é˜µï¼ˆ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>ï¼‰ã€‚</li>\n<li><strong>åº”ç”¨LoRAå¤„ç†</strong>ï¼šå¯¹æ–¹å‘çŸ©é˜µ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>åº”ç”¨LoRAæŠ€æœ¯ï¼ŒåŒæ—¶å•ç‹¬è®­ç»ƒå¤§å°å‘é‡<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>ã€‚</li>\n</ol>\n<h3 id=\"ä»£ç ç¤ºä¾‹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ä»£ç ç¤ºä¾‹\"><span>ä»£ç ç¤ºä¾‹</span></a></h3>\n<p>ä»¥ä¸‹æ˜¯DoRAä¼˜åŒ–æŠ€æœ¯çš„æ ¸å¿ƒä»£ç å®ç°ï¼š</p>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> LinearWithDoRAMerged</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> rank</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> alpha</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> linear</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> LoRALayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">out_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> rank</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> alpha</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">m </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">norm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> keepdim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        lora </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">A </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">B</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        numerator </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">alpha </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">T</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        denominator </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> numerator</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">norm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> keepdim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        directional_component </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> numerator </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> denominator</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        new_weight </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">m </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> directional_component</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> new_weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">bias</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"æ“ä½œæ­¥éª¤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ“ä½œæ­¥éª¤\"><span>æ“ä½œæ­¥éª¤</span></a></h3>\n<p>âœ… <strong>æ­¥éª¤1</strong>ï¼šå°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µæ‹†åˆ†ä¸ºå¤§å°å‘é‡<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>å’Œæ–¹å‘çŸ©é˜µ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>ã€‚</p>\n<p>âš  <strong>æ­¥éª¤2</strong>ï¼šå¯¹æ–¹å‘çŸ©é˜µ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>åº”ç”¨LoRAå¤„ç†ã€‚</p>\n<p>â— <strong>æ­¥éª¤3</strong>ï¼šå•ç‹¬è®­ç»ƒå¤§å°å‘é‡<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>ä»¥ä¼˜åŒ–æ¨¡å‹æ€§èƒ½ã€‚</p>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<blockquote>\n<p>âš  <strong>è­¦å‘Š</strong>ï¼šåœ¨åº”ç”¨LoRAå¤„ç†æ—¶ï¼Œç¡®ä¿æ–¹å‘çŸ©é˜µçš„ç»´åº¦ä¸è¾“å…¥è¾“å‡ºç‰¹å¾åŒ¹é…ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´è®¡ç®—é”™è¯¯ã€‚</p>\n</blockquote>\n<h2 id=\"ğŸ’¡å¯å‘ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ’¡å¯å‘ç‚¹\"><span>ğŸ’¡å¯å‘ç‚¹</span></a></h2>\n<p>DoRAé€šè¿‡åˆ†è§£æƒé‡çŸ©é˜µï¼Œæä¾›äº†ä¸€ç§æ–°çš„ä¼˜åŒ–æ€è·¯ï¼Œå¯ä»¥åœ¨ä¸æ˜¾è‘—å¢åŠ è®¡ç®—å¤æ‚åº¦çš„æƒ…å†µä¸‹æå‡æ¨¡å‹æ€§èƒ½ã€‚</p>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ul class=\"task-list-container\">\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-0\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-0\"> å®æ–½DoRAæŠ€æœ¯äºç°æœ‰æ¨¡å‹ä»¥è§‚å¯Ÿæ€§èƒ½æå‡ã€‚</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-1\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-1\"> æ¢ç´¢å…¶ä»–å¯èƒ½çš„æƒé‡åˆ†è§£æ–¹æ³•ã€‚</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-2\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-2\"> ç»“åˆå…¶ä»–ä¼˜åŒ–æŠ€æœ¯ï¼Œå¦‚å‰ªææˆ–é‡åŒ–ï¼Œè¿›ä¸€æ­¥æé«˜æ•ˆç‡ã€‚</label></li>\n</ul>\n<blockquote>\n<p>åŸå§‹å‡ºå¤„ï¼š[PEFT/src/peft/tuners/lora/dora.py]</p>\n</blockquote>\n","env":{"base":"/","filePath":"/Users/qianyuhe/Desktop/my-project/docs/notes_bak/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /RLå¼ºåŒ–å­¦ä¹ åŸºç¡€/LoRAåŠå…¶å˜ä½“/DoRA.md","filePathRelative":"notes_bak/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /RLå¼ºåŒ–å­¦ä¹ åŸºç¡€/LoRAåŠå…¶å˜ä½“/DoRA.md","frontmatter":{"dg-publish":true,"dg-permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /RLå¼ºåŒ–å­¦ä¹ åŸºç¡€/LoRAåŠå…¶å˜ä½“/DoRA","dg-home":false,"dg-description":"åœ¨æ­¤è¾“å…¥ç¬”è®°çš„æè¿°","dg-hide":false,"dg-hide-title":false,"dg-show-backlinks":true,"dg-show-local-graph":true,"dg-show-inline-title":true,"dg-pinned":false,"dg-passphrase":"åœ¨æ­¤è¾“å…¥è®¿é—®å¯†ç ","dg-enable-mathjax":false,"dg-enable-mermaid":false,"dg-enable-uml":false,"dg-note-icon":0,"dg-enable-dataview":false,"tags":["NLP"],"permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /RLå¼ºåŒ–å­¦ä¹ åŸºç¡€/LoRAåŠå…¶å˜ä½“/DoRA/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true,"dgPassFrontmatter":true,"noteIcon":0,"created":"2025-04-24T03:18:55.737Z","updated":"2025-04-24T03:19:04.342Z","title":"DoRA","createTime":"2025/05/13 17:33:52"},"sfcBlocks":{"template":{"type":"template","content":"<template><h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<ul>\n<li>åˆ†ç±»ï¼šæ·±åº¦å­¦ä¹ ä¼˜åŒ–</li>\n<li>æ ‡ç­¾ï¼šDoRAï¼ŒLoRAï¼Œæƒé‡åˆ†è§£ï¼Œæ·±åº¦å­¦ä¹ </li>\n<li>æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥</li>\n</ul>\n<h2 id=\"æ ¸å¿ƒè§‚ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒè§‚ç‚¹\"><span>æ ¸å¿ƒè§‚ç‚¹</span></a></h2>\n<p>DoRAæ˜¯ä¸€ç§ç”¨äºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡å°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µæ‹†åˆ†ä¸ºå¤§å°å‘é‡å’Œæ–¹å‘çŸ©é˜µä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«è¿›è¡Œè®­ç»ƒå’Œå¤„ç†ï¼Œä»¥æå‡æ¨¡å‹æ€§èƒ½ã€‚</p>\n<h2 id=\"é‡ç‚¹æ®µè½\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#é‡ç‚¹æ®µè½\"><span>é‡ç‚¹æ®µè½</span></a></h2>\n<h3 id=\"doraçš„åŸºæœ¬æ­¥éª¤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#doraçš„åŸºæœ¬æ­¥éª¤\"><span>DoRAçš„åŸºæœ¬æ­¥éª¤</span></a></h3>\n<ol>\n<li><strong>æƒé‡çŸ©é˜µæ‹†åˆ†</strong>ï¼šå°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µåˆ†è§£ä¸ºä¸¤ä¸ªéƒ¨åˆ†â€”â€”å¤§å°å‘é‡ï¼ˆ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>ï¼‰å’Œæ–¹å‘çŸ©é˜µï¼ˆ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>ï¼‰ã€‚</li>\n<li><strong>åº”ç”¨LoRAå¤„ç†</strong>ï¼šå¯¹æ–¹å‘çŸ©é˜µ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>åº”ç”¨LoRAæŠ€æœ¯ï¼ŒåŒæ—¶å•ç‹¬è®­ç»ƒå¤§å°å‘é‡<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>ã€‚</li>\n</ol>\n<h3 id=\"ä»£ç ç¤ºä¾‹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ä»£ç ç¤ºä¾‹\"><span>ä»£ç ç¤ºä¾‹</span></a></h3>\n<p>ä»¥ä¸‹æ˜¯DoRAä¼˜åŒ–æŠ€æœ¯çš„æ ¸å¿ƒä»£ç å®ç°ï¼š</p>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> LinearWithDoRAMerged</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> rank</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> alpha</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> linear</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> LoRALayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">out_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> rank</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> alpha</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">m </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">norm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> keepdim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        lora </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">A </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">B</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        numerator </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">alpha </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">T</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        denominator </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> numerator</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">norm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> keepdim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        directional_component </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> numerator </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> denominator</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        new_weight </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">m </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> directional_component</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> new_weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">bias</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"æ“ä½œæ­¥éª¤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ“ä½œæ­¥éª¤\"><span>æ“ä½œæ­¥éª¤</span></a></h3>\n<p>âœ… <strong>æ­¥éª¤1</strong>ï¼šå°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µæ‹†åˆ†ä¸ºå¤§å°å‘é‡<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>å’Œæ–¹å‘çŸ©é˜µ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>ã€‚</p>\n<p>âš  <strong>æ­¥éª¤2</strong>ï¼šå¯¹æ–¹å‘çŸ©é˜µ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>åº”ç”¨LoRAå¤„ç†ã€‚</p>\n<p>â— <strong>æ­¥éª¤3</strong>ï¼šå•ç‹¬è®­ç»ƒå¤§å°å‘é‡<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>ä»¥ä¼˜åŒ–æ¨¡å‹æ€§èƒ½ã€‚</p>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<blockquote>\n<p>âš  <strong>è­¦å‘Š</strong>ï¼šåœ¨åº”ç”¨LoRAå¤„ç†æ—¶ï¼Œç¡®ä¿æ–¹å‘çŸ©é˜µçš„ç»´åº¦ä¸è¾“å…¥è¾“å‡ºç‰¹å¾åŒ¹é…ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´è®¡ç®—é”™è¯¯ã€‚</p>\n</blockquote>\n<h2 id=\"ğŸ’¡å¯å‘ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ’¡å¯å‘ç‚¹\"><span>ğŸ’¡å¯å‘ç‚¹</span></a></h2>\n<p>DoRAé€šè¿‡åˆ†è§£æƒé‡çŸ©é˜µï¼Œæä¾›äº†ä¸€ç§æ–°çš„ä¼˜åŒ–æ€è·¯ï¼Œå¯ä»¥åœ¨ä¸æ˜¾è‘—å¢åŠ è®¡ç®—å¤æ‚åº¦çš„æƒ…å†µä¸‹æå‡æ¨¡å‹æ€§èƒ½ã€‚</p>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ul class=\"task-list-container\">\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-0\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-0\"> å®æ–½DoRAæŠ€æœ¯äºç°æœ‰æ¨¡å‹ä»¥è§‚å¯Ÿæ€§èƒ½æå‡ã€‚</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-1\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-1\"> æ¢ç´¢å…¶ä»–å¯èƒ½çš„æƒé‡åˆ†è§£æ–¹æ³•ã€‚</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-2\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-2\"> ç»“åˆå…¶ä»–ä¼˜åŒ–æŠ€æœ¯ï¼Œå¦‚å‰ªææˆ–é‡åŒ–ï¼Œè¿›ä¸€æ­¥æé«˜æ•ˆç‡ã€‚</label></li>\n</ul>\n<blockquote>\n<p>åŸå§‹å‡ºå¤„ï¼š[PEFT/src/peft/tuners/lora/dora.py]</p>\n</blockquote>\n</template>","contentStripped":"<h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<ul>\n<li>åˆ†ç±»ï¼šæ·±åº¦å­¦ä¹ ä¼˜åŒ–</li>\n<li>æ ‡ç­¾ï¼šDoRAï¼ŒLoRAï¼Œæƒé‡åˆ†è§£ï¼Œæ·±åº¦å­¦ä¹ </li>\n<li>æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥</li>\n</ul>\n<h2 id=\"æ ¸å¿ƒè§‚ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒè§‚ç‚¹\"><span>æ ¸å¿ƒè§‚ç‚¹</span></a></h2>\n<p>DoRAæ˜¯ä¸€ç§ç”¨äºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡å°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µæ‹†åˆ†ä¸ºå¤§å°å‘é‡å’Œæ–¹å‘çŸ©é˜µä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«è¿›è¡Œè®­ç»ƒå’Œå¤„ç†ï¼Œä»¥æå‡æ¨¡å‹æ€§èƒ½ã€‚</p>\n<h2 id=\"é‡ç‚¹æ®µè½\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#é‡ç‚¹æ®µè½\"><span>é‡ç‚¹æ®µè½</span></a></h2>\n<h3 id=\"doraçš„åŸºæœ¬æ­¥éª¤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#doraçš„åŸºæœ¬æ­¥éª¤\"><span>DoRAçš„åŸºæœ¬æ­¥éª¤</span></a></h3>\n<ol>\n<li><strong>æƒé‡çŸ©é˜µæ‹†åˆ†</strong>ï¼šå°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µåˆ†è§£ä¸ºä¸¤ä¸ªéƒ¨åˆ†â€”â€”å¤§å°å‘é‡ï¼ˆ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>ï¼‰å’Œæ–¹å‘çŸ©é˜µï¼ˆ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>ï¼‰ã€‚</li>\n<li><strong>åº”ç”¨LoRAå¤„ç†</strong>ï¼šå¯¹æ–¹å‘çŸ©é˜µ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>åº”ç”¨LoRAæŠ€æœ¯ï¼ŒåŒæ—¶å•ç‹¬è®­ç»ƒå¤§å°å‘é‡<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>ã€‚</li>\n</ol>\n<h3 id=\"ä»£ç ç¤ºä¾‹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ä»£ç ç¤ºä¾‹\"><span>ä»£ç ç¤ºä¾‹</span></a></h3>\n<p>ä»¥ä¸‹æ˜¯DoRAä¼˜åŒ–æŠ€æœ¯çš„æ ¸å¿ƒä»£ç å®ç°ï¼š</p>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> LinearWithDoRAMerged</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> rank</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> alpha</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> linear</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> LoRALayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">out_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> rank</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> alpha</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">m </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">norm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> keepdim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        lora </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">A </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">B</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        numerator </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">alpha </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">T</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        denominator </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> numerator</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">norm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> keepdim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        directional_component </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> numerator </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> denominator</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        new_weight </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">m </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> directional_component</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> new_weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">bias</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"æ“ä½œæ­¥éª¤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ“ä½œæ­¥éª¤\"><span>æ“ä½œæ­¥éª¤</span></a></h3>\n<p>âœ… <strong>æ­¥éª¤1</strong>ï¼šå°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µæ‹†åˆ†ä¸ºå¤§å°å‘é‡<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>å’Œæ–¹å‘çŸ©é˜µ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>ã€‚</p>\n<p>âš  <strong>æ­¥éª¤2</strong>ï¼šå¯¹æ–¹å‘çŸ©é˜µ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">V</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span>åº”ç”¨LoRAå¤„ç†ã€‚</p>\n<p>â— <strong>æ­¥éª¤3</strong>ï¼šå•ç‹¬è®­ç»ƒå¤§å°å‘é‡<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>ä»¥ä¼˜åŒ–æ¨¡å‹æ€§èƒ½ã€‚</p>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<blockquote>\n<p>âš  <strong>è­¦å‘Š</strong>ï¼šåœ¨åº”ç”¨LoRAå¤„ç†æ—¶ï¼Œç¡®ä¿æ–¹å‘çŸ©é˜µçš„ç»´åº¦ä¸è¾“å…¥è¾“å‡ºç‰¹å¾åŒ¹é…ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´è®¡ç®—é”™è¯¯ã€‚</p>\n</blockquote>\n<h2 id=\"ğŸ’¡å¯å‘ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ’¡å¯å‘ç‚¹\"><span>ğŸ’¡å¯å‘ç‚¹</span></a></h2>\n<p>DoRAé€šè¿‡åˆ†è§£æƒé‡çŸ©é˜µï¼Œæä¾›äº†ä¸€ç§æ–°çš„ä¼˜åŒ–æ€è·¯ï¼Œå¯ä»¥åœ¨ä¸æ˜¾è‘—å¢åŠ è®¡ç®—å¤æ‚åº¦çš„æƒ…å†µä¸‹æå‡æ¨¡å‹æ€§èƒ½ã€‚</p>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ul class=\"task-list-container\">\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-0\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-0\"> å®æ–½DoRAæŠ€æœ¯äºç°æœ‰æ¨¡å‹ä»¥è§‚å¯Ÿæ€§èƒ½æå‡ã€‚</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-1\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-1\"> æ¢ç´¢å…¶ä»–å¯èƒ½çš„æƒé‡åˆ†è§£æ–¹æ³•ã€‚</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-2\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-2\"> ç»“åˆå…¶ä»–ä¼˜åŒ–æŠ€æœ¯ï¼Œå¦‚å‰ªææˆ–é‡åŒ–ï¼Œè¿›ä¸€æ­¥æé«˜æ•ˆç‡ã€‚</label></li>\n</ul>\n<blockquote>\n<p>åŸå§‹å‡ºå¤„ï¼š[PEFT/src/peft/tuners/lora/dora.py]</p>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"\n## å…ƒæ•°æ®\n- åˆ†ç±»ï¼šæ·±åº¦å­¦ä¹ ä¼˜åŒ–\n- æ ‡ç­¾ï¼šDoRAï¼ŒLoRAï¼Œæƒé‡åˆ†è§£ï¼Œæ·±åº¦å­¦ä¹ \n- æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥\n\n\n## æ ¸å¿ƒè§‚ç‚¹\nDoRAæ˜¯ä¸€ç§ç”¨äºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡å°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µæ‹†åˆ†ä¸ºå¤§å°å‘é‡å’Œæ–¹å‘çŸ©é˜µä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«è¿›è¡Œè®­ç»ƒå’Œå¤„ç†ï¼Œä»¥æå‡æ¨¡å‹æ€§èƒ½ã€‚\n\n\n## é‡ç‚¹æ®µè½\n\n### DoRAçš„åŸºæœ¬æ­¥éª¤\n1. **æƒé‡çŸ©é˜µæ‹†åˆ†**ï¼šå°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µåˆ†è§£ä¸ºä¸¤ä¸ªéƒ¨åˆ†â€”â€”å¤§å°å‘é‡ï¼ˆ$m$ï¼‰å’Œæ–¹å‘çŸ©é˜µï¼ˆ$V$ï¼‰ã€‚\n2. **åº”ç”¨LoRAå¤„ç†**ï¼šå¯¹æ–¹å‘çŸ©é˜µ$V$åº”ç”¨LoRAæŠ€æœ¯ï¼ŒåŒæ—¶å•ç‹¬è®­ç»ƒå¤§å°å‘é‡$m$ã€‚\n\n\n### ä»£ç ç¤ºä¾‹\nä»¥ä¸‹æ˜¯DoRAä¼˜åŒ–æŠ€æœ¯çš„æ ¸å¿ƒä»£ç å®ç°ï¼š\n\n```python\nclass LinearWithDoRAMerged(nn.Module):\n    def __init__(self, linear, rank, alpha):\n        super().__init__()\n        self.linear = linear\n        self.lora = LoRALayer(linear.in_features, linear.out_features, rank, alpha)\n        self.m = nn.Parameter(self.linear.weight.norm(p=2, dim=0, keepdim=True))\n\n    def forward(self, x):\n        lora = self.lora.A @ self.lora.B\n        numerator = self.linear.weight + self.lora.alpha * lora.T\n        denominator = numerator.norm(p=2, dim=0, keepdim=True)\n        directional_component = numerator / denominator\n        new_weight = self.m * directional_component\n        return F.linear(x, new_weight, self.linear.bias)\n```\n\n\n### æ“ä½œæ­¥éª¤\nâœ… **æ­¥éª¤1**ï¼šå°†é¢„è®­ç»ƒçš„æƒé‡çŸ©é˜µæ‹†åˆ†ä¸ºå¤§å°å‘é‡$m$å’Œæ–¹å‘çŸ©é˜µ$V$ã€‚\n\nâš  **æ­¥éª¤2**ï¼šå¯¹æ–¹å‘çŸ©é˜µ$V$åº”ç”¨LoRAå¤„ç†ã€‚\n\nâ— **æ­¥éª¤3**ï¼šå•ç‹¬è®­ç»ƒå¤§å°å‘é‡$m$ä»¥ä¼˜åŒ–æ¨¡å‹æ€§èƒ½ã€‚\n\n\n## å¸¸è§é”™è¯¯\n> âš  **è­¦å‘Š**ï¼šåœ¨åº”ç”¨LoRAå¤„ç†æ—¶ï¼Œç¡®ä¿æ–¹å‘çŸ©é˜µçš„ç»´åº¦ä¸è¾“å…¥è¾“å‡ºç‰¹å¾åŒ¹é…ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´è®¡ç®—é”™è¯¯ã€‚\n\n\n## ğŸ’¡å¯å‘ç‚¹\nDoRAé€šè¿‡åˆ†è§£æƒé‡çŸ©é˜µï¼Œæä¾›äº†ä¸€ç§æ–°çš„ä¼˜åŒ–æ€è·¯ï¼Œå¯ä»¥åœ¨ä¸æ˜¾è‘—å¢åŠ è®¡ç®—å¤æ‚åº¦çš„æƒ…å†µä¸‹æå‡æ¨¡å‹æ€§èƒ½ã€‚\n\n\n## è¡ŒåŠ¨æ¸…å•\n- [ ] å®æ–½DoRAæŠ€æœ¯äºç°æœ‰æ¨¡å‹ä»¥è§‚å¯Ÿæ€§èƒ½æå‡ã€‚\n- [ ] æ¢ç´¢å…¶ä»–å¯èƒ½çš„æƒé‡åˆ†è§£æ–¹æ³•ã€‚\n- [ ] ç»“åˆå…¶ä»–ä¼˜åŒ–æŠ€æœ¯ï¼Œå¦‚å‰ªææˆ–é‡åŒ–ï¼Œè¿›ä¸€æ­¥æé«˜æ•ˆç‡ã€‚\n\n> åŸå§‹å‡ºå¤„ï¼š[PEFT/src/peft/tuners/lora/dora.py]","excerpt":"","includedFiles":[],"tasklistId":3,"title":"","headers":[{"level":2,"title":"å…ƒæ•°æ®","slug":"å…ƒæ•°æ®","link":"#å…ƒæ•°æ®","children":[]},{"level":2,"title":"æ ¸å¿ƒè§‚ç‚¹","slug":"æ ¸å¿ƒè§‚ç‚¹","link":"#æ ¸å¿ƒè§‚ç‚¹","children":[]},{"level":2,"title":"é‡ç‚¹æ®µè½","slug":"é‡ç‚¹æ®µè½","link":"#é‡ç‚¹æ®µè½","children":[{"level":3,"title":"DoRAçš„åŸºæœ¬æ­¥éª¤","slug":"doraçš„åŸºæœ¬æ­¥éª¤","link":"#doraçš„åŸºæœ¬æ­¥éª¤","children":[]},{"level":3,"title":"ä»£ç ç¤ºä¾‹","slug":"ä»£ç ç¤ºä¾‹","link":"#ä»£ç ç¤ºä¾‹","children":[]},{"level":3,"title":"æ“ä½œæ­¥éª¤","slug":"æ“ä½œæ­¥éª¤","link":"#æ“ä½œæ­¥éª¤","children":[]}]},{"level":2,"title":"å¸¸è§é”™è¯¯","slug":"å¸¸è§é”™è¯¯","link":"#å¸¸è§é”™è¯¯","children":[]},{"level":2,"title":"ğŸ’¡å¯å‘ç‚¹","slug":"ğŸ’¡å¯å‘ç‚¹","link":"#ğŸ’¡å¯å‘ç‚¹","children":[]},{"level":2,"title":"è¡ŒåŠ¨æ¸…å•","slug":"è¡ŒåŠ¨æ¸…å•","link":"#è¡ŒåŠ¨æ¸…å•","children":[]}]}}
