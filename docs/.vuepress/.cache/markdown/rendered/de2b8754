{"content":"<p>分类：机器学习</p>\n<p>标签：SFT训练，模型评估，深度学习</p>\n<p>日期：2023年10月22日</p>\n<h2 id=\"核心观点总结\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#核心观点总结\"><span>核心观点总结</span></a></h2>\n<p>在深度学习中，SFT（Supervised Fine-Tuning）训练和评估是提升模型性能的重要环节。本文介绍了OpenRLHF框架下的SFT训练启动脚本，并详细阐述了SFT评估的原则和方法。通过结合机评和人评，可以更全面地评估模型在不同维度上的表现。</p>\n<h2 id=\"重点段落\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#重点段落\"><span>重点段落</span></a></h2>\n<ol>\n<li>\n<p><strong>SFT训练启动脚本</strong><br>\n使用OpenRLHF进行SFT训练的启动脚本示例展示了如何设置训练参数，包括最大长度、数据集、批量大小、预训练模型、保存路径等。</p>\n</li>\n<li>\n<p><strong>评估原则</strong><br>\nSFT评估需要关注模型的Helpfulness（帮助性）、Honesty（诚实性）和Harmlessness（无害性）。此外，还需根据需求制定其他指标，如指令遵循、内容准确性和安全性。</p>\n</li>\n<li>\n<p><strong>机评与人评</strong><br>\n机评利用大模型如GPT4进行，需精心设计prompt以减少偏差；人评则通过人工直接判断模型输出的质量。</p>\n</li>\n</ol>\n<h2 id=\"操作步骤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#操作步骤\"><span>操作步骤</span></a></h2>\n<ol>\n<li>\n<p>✅ <strong>启动训练</strong><br>\n使用以下命令启动SFT训练：</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">openrlhf.cli.train_sft</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--max_len </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2048</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--dataset </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">xxx</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--input_key </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">question</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--output_key </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">response</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--train_batch_size </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">256</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--micro_train_batch_size </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--max_samples </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">500000</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--pretrain </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">meta-llama/Meta-Llama-3-8B</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--save_path </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./checkpoint/llama3-8b-sft</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--save_steps </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">-1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--logging_steps </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--eval_steps </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">-1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--zero_stage </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--max_epochs </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--bf16 </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--flash_attn </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--learning_rate </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5e-6</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--load_checkpoint </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--gradient_checkpointing</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>⚠ <strong>注意事项</strong></p>\n<ul>\n<li>确保数据集和预训练模型路径正确。</li>\n<li>调整学习率以适应不同数据集。</li>\n</ul>\n</li>\n<li>\n<p>❗ <strong>评估准备</strong><br>\n准备与训练集一致的高质量评测集合，确保评估任务类型明确。</p>\n</li>\n</ol>\n<h2 id=\"常见错误\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误\"><span>常见错误</span></a></h2>\n<blockquote>\n<p>在启动训练时，常见错误包括路径配置错误、参数设置不当以及未充分考虑数据集特点等。这些错误可能导致训练失败或结果不理想。</p>\n</blockquote>\n<h2 id=\"💡启发点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#💡启发点\"><span>💡启发点</span></a></h2>\n<ul>\n<li>在设计评估指标时，如何平衡不同维度的权重？</li>\n<li>如何更好地利用大模型进行机评以减少偏差？</li>\n</ul>\n<h2 id=\"行动清单\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#行动清单\"><span>行动清单</span></a></h2>\n<ul class=\"task-list-container\">\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-0\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-0\"> 优化训练脚本参数以提高效率。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-1\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-1\"> 制定详细的评估指标并测试其有效性。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-2\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-2\"> 探索更多评估方法以提升结果准确性。</label></li>\n</ul>\n<h2 id=\"📈趋势预测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#📈趋势预测\"><span>📈趋势预测</span></a></h2>\n<p>随着大模型的不断发展，未来SFT训练和评估将更加依赖于自动化工具和更智能的评估指标，以提高效率和准确性。</p>\n<h2 id=\"后续追踪\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#后续追踪\"><span>后续追踪</span></a></h2>\n<ul>\n<li>研究如何结合更多数据源进行多维度评估。</li>\n<li>探索新型评估算法以提高机评准确性。</li>\n</ul>\n<blockquote>\n<p>原始出处：此内容基于OpenRLHF框架的SFT训练与评估文档。</p>\n</blockquote>\n","env":{"base":"/","filePath":"/Users/qianyuhe/Desktop/my-project/docs/notes_bak/大语言模型学习/后训练/SFT监督微调/STF训练/训练启动脚本.md","filePathRelative":"notes_bak/大语言模型学习/后训练/SFT监督微调/STF训练/训练启动脚本.md","frontmatter":{"dg-publish":true,"dg-permalink":"/大语言模型学习/后训练/SFT监督微调/STF训练/训练启动脚本","dg-home":false,"dg-description":"在此输入笔记的描述","dg-hide":false,"dg-hide-title":false,"dg-show-backlinks":true,"dg-show-local-graph":true,"dg-show-inline-title":true,"dg-pinned":false,"dg-passphrase":"在此输入访问密码","dg-enable-mathjax":false,"dg-enable-mermaid":false,"dg-enable-uml":false,"dg-note-icon":0,"dg-enable-dataview":false,"tags":["NLP"],"permalink":"/大语言模型学习/后训练/SFT监督微调/STF训练/训练启动脚本/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true,"dgPassFrontmatter":true,"noteIcon":0,"created":"2025-04-11T05:07:45.000Z","updated":"2025-04-13T05:06:02.000Z","title":"训练启动脚本","createTime":"2025/05/13 17:33:52"},"sfcBlocks":{"template":{"type":"template","content":"<template><p>分类：机器学习</p>\n<p>标签：SFT训练，模型评估，深度学习</p>\n<p>日期：2023年10月22日</p>\n<h2 id=\"核心观点总结\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#核心观点总结\"><span>核心观点总结</span></a></h2>\n<p>在深度学习中，SFT（Supervised Fine-Tuning）训练和评估是提升模型性能的重要环节。本文介绍了OpenRLHF框架下的SFT训练启动脚本，并详细阐述了SFT评估的原则和方法。通过结合机评和人评，可以更全面地评估模型在不同维度上的表现。</p>\n<h2 id=\"重点段落\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#重点段落\"><span>重点段落</span></a></h2>\n<ol>\n<li>\n<p><strong>SFT训练启动脚本</strong><br>\n使用OpenRLHF进行SFT训练的启动脚本示例展示了如何设置训练参数，包括最大长度、数据集、批量大小、预训练模型、保存路径等。</p>\n</li>\n<li>\n<p><strong>评估原则</strong><br>\nSFT评估需要关注模型的Helpfulness（帮助性）、Honesty（诚实性）和Harmlessness（无害性）。此外，还需根据需求制定其他指标，如指令遵循、内容准确性和安全性。</p>\n</li>\n<li>\n<p><strong>机评与人评</strong><br>\n机评利用大模型如GPT4进行，需精心设计prompt以减少偏差；人评则通过人工直接判断模型输出的质量。</p>\n</li>\n</ol>\n<h2 id=\"操作步骤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#操作步骤\"><span>操作步骤</span></a></h2>\n<ol>\n<li>\n<p>✅ <strong>启动训练</strong><br>\n使用以下命令启动SFT训练：</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">openrlhf.cli.train_sft</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--max_len </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2048</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--dataset </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">xxx</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--input_key </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">question</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--output_key </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">response</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--train_batch_size </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">256</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--micro_train_batch_size </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--max_samples </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">500000</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--pretrain </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">meta-llama/Meta-Llama-3-8B</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--save_path </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./checkpoint/llama3-8b-sft</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--save_steps </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">-1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--logging_steps </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--eval_steps </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">-1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--zero_stage </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--max_epochs </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--bf16 </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--flash_attn </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--learning_rate </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5e-6</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--load_checkpoint </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--gradient_checkpointing</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>⚠ <strong>注意事项</strong></p>\n<ul>\n<li>确保数据集和预训练模型路径正确。</li>\n<li>调整学习率以适应不同数据集。</li>\n</ul>\n</li>\n<li>\n<p>❗ <strong>评估准备</strong><br>\n准备与训练集一致的高质量评测集合，确保评估任务类型明确。</p>\n</li>\n</ol>\n<h2 id=\"常见错误\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误\"><span>常见错误</span></a></h2>\n<blockquote>\n<p>在启动训练时，常见错误包括路径配置错误、参数设置不当以及未充分考虑数据集特点等。这些错误可能导致训练失败或结果不理想。</p>\n</blockquote>\n<h2 id=\"💡启发点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#💡启发点\"><span>💡启发点</span></a></h2>\n<ul>\n<li>在设计评估指标时，如何平衡不同维度的权重？</li>\n<li>如何更好地利用大模型进行机评以减少偏差？</li>\n</ul>\n<h2 id=\"行动清单\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#行动清单\"><span>行动清单</span></a></h2>\n<ul class=\"task-list-container\">\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-0\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-0\"> 优化训练脚本参数以提高效率。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-1\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-1\"> 制定详细的评估指标并测试其有效性。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-2\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-2\"> 探索更多评估方法以提升结果准确性。</label></li>\n</ul>\n<h2 id=\"📈趋势预测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#📈趋势预测\"><span>📈趋势预测</span></a></h2>\n<p>随着大模型的不断发展，未来SFT训练和评估将更加依赖于自动化工具和更智能的评估指标，以提高效率和准确性。</p>\n<h2 id=\"后续追踪\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#后续追踪\"><span>后续追踪</span></a></h2>\n<ul>\n<li>研究如何结合更多数据源进行多维度评估。</li>\n<li>探索新型评估算法以提高机评准确性。</li>\n</ul>\n<blockquote>\n<p>原始出处：此内容基于OpenRLHF框架的SFT训练与评估文档。</p>\n</blockquote>\n</template>","contentStripped":"<p>分类：机器学习</p>\n<p>标签：SFT训练，模型评估，深度学习</p>\n<p>日期：2023年10月22日</p>\n<h2 id=\"核心观点总结\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#核心观点总结\"><span>核心观点总结</span></a></h2>\n<p>在深度学习中，SFT（Supervised Fine-Tuning）训练和评估是提升模型性能的重要环节。本文介绍了OpenRLHF框架下的SFT训练启动脚本，并详细阐述了SFT评估的原则和方法。通过结合机评和人评，可以更全面地评估模型在不同维度上的表现。</p>\n<h2 id=\"重点段落\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#重点段落\"><span>重点段落</span></a></h2>\n<ol>\n<li>\n<p><strong>SFT训练启动脚本</strong><br>\n使用OpenRLHF进行SFT训练的启动脚本示例展示了如何设置训练参数，包括最大长度、数据集、批量大小、预训练模型、保存路径等。</p>\n</li>\n<li>\n<p><strong>评估原则</strong><br>\nSFT评估需要关注模型的Helpfulness（帮助性）、Honesty（诚实性）和Harmlessness（无害性）。此外，还需根据需求制定其他指标，如指令遵循、内容准确性和安全性。</p>\n</li>\n<li>\n<p><strong>机评与人评</strong><br>\n机评利用大模型如GPT4进行，需精心设计prompt以减少偏差；人评则通过人工直接判断模型输出的质量。</p>\n</li>\n</ol>\n<h2 id=\"操作步骤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#操作步骤\"><span>操作步骤</span></a></h2>\n<ol>\n<li>\n<p>✅ <strong>启动训练</strong><br>\n使用以下命令启动SFT训练：</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">openrlhf.cli.train_sft</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--max_len </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2048</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--dataset </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">xxx</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--input_key </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">question</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--output_key </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">response</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--train_batch_size </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">256</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--micro_train_batch_size </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--max_samples </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">500000</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--pretrain </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">meta-llama/Meta-Llama-3-8B</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--save_path </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./checkpoint/llama3-8b-sft</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--save_steps </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">-1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--logging_steps </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--eval_steps </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">-1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--zero_stage </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--max_epochs </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--bf16 </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--flash_attn </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--learning_rate </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5e-6</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--load_checkpoint </span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">--gradient_checkpointing</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>⚠ <strong>注意事项</strong></p>\n<ul>\n<li>确保数据集和预训练模型路径正确。</li>\n<li>调整学习率以适应不同数据集。</li>\n</ul>\n</li>\n<li>\n<p>❗ <strong>评估准备</strong><br>\n准备与训练集一致的高质量评测集合，确保评估任务类型明确。</p>\n</li>\n</ol>\n<h2 id=\"常见错误\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误\"><span>常见错误</span></a></h2>\n<blockquote>\n<p>在启动训练时，常见错误包括路径配置错误、参数设置不当以及未充分考虑数据集特点等。这些错误可能导致训练失败或结果不理想。</p>\n</blockquote>\n<h2 id=\"💡启发点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#💡启发点\"><span>💡启发点</span></a></h2>\n<ul>\n<li>在设计评估指标时，如何平衡不同维度的权重？</li>\n<li>如何更好地利用大模型进行机评以减少偏差？</li>\n</ul>\n<h2 id=\"行动清单\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#行动清单\"><span>行动清单</span></a></h2>\n<ul class=\"task-list-container\">\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-0\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-0\"> 优化训练脚本参数以提高效率。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-1\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-1\"> 制定详细的评估指标并测试其有效性。</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-2\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-2\"> 探索更多评估方法以提升结果准确性。</label></li>\n</ul>\n<h2 id=\"📈趋势预测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#📈趋势预测\"><span>📈趋势预测</span></a></h2>\n<p>随着大模型的不断发展，未来SFT训练和评估将更加依赖于自动化工具和更智能的评估指标，以提高效率和准确性。</p>\n<h2 id=\"后续追踪\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#后续追踪\"><span>后续追踪</span></a></h2>\n<ul>\n<li>研究如何结合更多数据源进行多维度评估。</li>\n<li>探索新型评估算法以提高机评准确性。</li>\n</ul>\n<blockquote>\n<p>原始出处：此内容基于OpenRLHF框架的SFT训练与评估文档。</p>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"分类：机器学习\n\n标签：SFT训练，模型评估，深度学习\n\n日期：2023年10月22日\n\n## 核心观点总结\n在深度学习中，SFT（Supervised Fine-Tuning）训练和评估是提升模型性能的重要环节。本文介绍了OpenRLHF框架下的SFT训练启动脚本，并详细阐述了SFT评估的原则和方法。通过结合机评和人评，可以更全面地评估模型在不同维度上的表现。\n\n\n## 重点段落\n1. **SFT训练启动脚本**  \n   使用OpenRLHF进行SFT训练的启动脚本示例展示了如何设置训练参数，包括最大长度、数据集、批量大小、预训练模型、保存路径等。\n\n2. **评估原则**  \n   SFT评估需要关注模型的Helpfulness（帮助性）、Honesty（诚实性）和Harmlessness（无害性）。此外，还需根据需求制定其他指标，如指令遵循、内容准确性和安全性。\n\n3. **机评与人评**  \n   机评利用大模型如GPT4进行，需精心设计prompt以减少偏差；人评则通过人工直接判断模型输出的质量。\n\n\n## 操作步骤\n1. ✅ **启动训练**  \n   使用以下命令启动SFT训练：\n   ```bash\n   openrlhf.cli.train_sft \\\n   --max_len 2048 \\\n   --dataset xxx \\\n   --input_key question \\\n   --output_key response \\\n   --train_batch_size 256 \\\n   --micro_train_batch_size 2 \\\n   --max_samples 500000 \\\n   --pretrain meta-llama/Meta-Llama-3-8B \\\n   --save_path ./checkpoint/llama3-8b-sft \\\n   --save_steps -1 \\\n   --logging_steps 1 \\\n   --eval_steps -1 \\\n   --zero_stage 2 \\\n   --max_epochs 1 \\\n   --bf16 \\\n   --flash_attn \\\n   --learning_rate 5e-6 \\\n   --load_checkpoint \\\n   --gradient_checkpointing\n   ```\n\n\n\n\n\n2. ⚠ **注意事项**  \n   - 确保数据集和预训练模型路径正确。\n   - 调整学习率以适应不同数据集。\n\n3. ❗ **评估准备**  \n   准备与训练集一致的高质量评测集合，确保评估任务类型明确。\n\n\n## 常见错误\n> 在启动训练时，常见错误包括路径配置错误、参数设置不当以及未充分考虑数据集特点等。这些错误可能导致训练失败或结果不理想。\n\n\n## 💡启发点\n- 在设计评估指标时，如何平衡不同维度的权重？\n- 如何更好地利用大模型进行机评以减少偏差？\n\n\n## 行动清单\n- [ ] 优化训练脚本参数以提高效率。\n- [ ] 制定详细的评估指标并测试其有效性。\n- [ ] 探索更多评估方法以提升结果准确性。\n\n\n## 📈趋势预测\n随着大模型的不断发展，未来SFT训练和评估将更加依赖于自动化工具和更智能的评估指标，以提高效率和准确性。\n\n\n## 后续追踪\n- 研究如何结合更多数据源进行多维度评估。\n- 探索新型评估算法以提高机评准确性。\n\n> 原始出处：此内容基于OpenRLHF框架的SFT训练与评估文档。","excerpt":"","includedFiles":[],"tasklistId":3,"title":"","headers":[{"level":2,"title":"核心观点总结","slug":"核心观点总结","link":"#核心观点总结","children":[]},{"level":2,"title":"重点段落","slug":"重点段落","link":"#重点段落","children":[]},{"level":2,"title":"操作步骤","slug":"操作步骤","link":"#操作步骤","children":[]},{"level":2,"title":"常见错误","slug":"常见错误","link":"#常见错误","children":[]},{"level":2,"title":"💡启发点","slug":"💡启发点","link":"#💡启发点","children":[]},{"level":2,"title":"行动清单","slug":"行动清单","link":"#行动清单","children":[]},{"level":2,"title":"📈趋势预测","slug":"📈趋势预测","link":"#📈趋势预测","children":[]},{"level":2,"title":"后续追踪","slug":"后续追踪","link":"#后续追踪","children":[]}]}}
