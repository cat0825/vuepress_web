{"content":"<h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<ul>\n<li><strong>åˆ†ç±»</strong>ï¼šæ·±åº¦å­¦ä¹ /Transformerä¼˜åŒ–</li>\n<li><strong>æ ‡ç­¾</strong>ï¼šAttentionæœºåˆ¶ã€è®¡ç®—å¤æ‚åº¦ã€Sparse Attentionã€Linear Attention</li>\n<li><strong>æ—¥æœŸ</strong>ï¼š2024å¹´10æœˆ2æ—¥</li>\n</ul>\n<hr>\n<h2 id=\"å†…å®¹æ¦‚è¿°\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å†…å®¹æ¦‚è¿°\"><span>å†…å®¹æ¦‚è¿°</span></a></h2>\n<p>æœ¬æ–‡æ¢è®¨äº†ä¼˜åŒ–Attentionè®¡ç®—å¤æ‚åº¦çš„å‡ ç§æŠ€æœ¯ï¼ŒåŒ…æ‹¬Sparse Attentionå’ŒLinear Attentionã€‚æ ¸å¿ƒç›®æ ‡æ˜¯é™ä½ä¼ ç»ŸSelf Attentionçš„è®¡ç®—å¤æ‚åº¦ï¼ŒåŒæ—¶ä¿ç•™å…¶åœ¨åºåˆ—æ•°æ®å¤„ç†ä¸­çš„å¼ºå¤§åŠŸèƒ½ã€‚</p>\n<hr>\n<h2 id=\"æ ¸å¿ƒå†…å®¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒå†…å®¹\"><span>æ ¸å¿ƒå†…å®¹</span></a></h2>\n<h3 id=\"self-attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#self-attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜\"><span>Self Attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜</span></a></h3>\n<p>ä¼ ç»ŸSelf Attentionçš„è®¡ç®—å¤æ‚åº¦ä¸º (O(N^2))ï¼Œéœ€è¦å¯¹åºåˆ—ä¸­çš„ä»»æ„ä¸¤ä¸ªå‘é‡è®¡ç®—ç›¸å…³æ€§ï¼Œç”Ÿæˆä¸€ä¸ª (N \\times N) çš„ç›¸å…³åº¦çŸ©é˜µã€‚è¿™ç§æ–¹æ³•åœ¨å¤„ç†é•¿åºåˆ—æ—¶ä¼šå¯¼è‡´è®¡ç®—æˆæœ¬è¿‡é«˜ã€‚</p>\n<h3 id=\"sparse-attention-å±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#sparse-attention-å±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³\"><span>Sparse Attentionï¼šå±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³</span></a></h3>\n<p>Sparse Attentioné€šè¿‡é™åˆ¶æ³¨æ„åŠ›çŸ©é˜µä¸­éƒ¨åˆ†åŒºåŸŸçš„è®¡ç®—æ¥é™ä½å¤æ‚åº¦ï¼š</p>\n<ul>\n<li><strong>ä¸»è¦åŸç†</strong>ï¼šç»“åˆç©ºæ´Attentionå’Œå±€éƒ¨Attentionï¼Œè®¾ç½®ç›¸å¯¹è·ç¦»è¶…è¿‡kæˆ–ä¸ºkçš„å€æ•°çš„æ³¨æ„åŠ›ä¸º0ã€‚</li>\n<li><strong>ä¼˜ç‚¹</strong>ï¼šæå‡æ•ˆç‡ï¼Œé€‚åˆå¤§å¤šæ•°åªéœ€å±€éƒ¨ç´§å¯†ç›¸å…³æ€§çš„ä»»åŠ¡ã€‚</li>\n<li><strong>ä¸è¶³</strong>ï¼š\n<ol>\n<li>ä¿ç•™åŒºåŸŸéœ€äººå·¥é€‰æ‹©ï¼Œç¼ºä¹çµæ´»æ€§ã€‚</li>\n<li>å®ç°éœ€è¦ç‰¹å®šä¼˜åŒ–è®¾è®¡ï¼Œä¸æ˜“æ¨å¹¿ã€‚</li>\n</ol>\n</li>\n</ul>\n<p>ğŸ“ˆ<strong>è¶‹åŠ¿é¢„æµ‹</strong>ï¼šSparse Attentionå¯èƒ½æˆä¸ºç‰¹å®šä»»åŠ¡çš„æœ‰æ•ˆè§£å†³æ–¹æ¡ˆï¼Œä½†éœ€è¿›ä¸€æ­¥ç ”ç©¶å¦‚ä½•åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸã€‚</p>\n<h3 id=\"linear-attention-ä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#linear-attention-ä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦\"><span>Linear Attentionï¼šä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦</span></a></h3>\n<p>Linear Attentioné€šè¿‡ç§»é™¤Softmaxæ“ä½œï¼Œå°†è®¡ç®—å¤æ‚åº¦ä» (O(N^2d)) é™è‡³ (O(Nd^2))ï¼š</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå…ˆè®¡ç®— (K^T \\cdot V)ï¼Œå†ç»“åˆæ ¸å‡½æ•°å½¢å¼å¤„ç† (Q \\cdot K^T)ï¼Œä»¥éè´Ÿæ¿€æ´»å‡½æ•°æ›¿ä»£Softmaxã€‚</li>\n<li><strong>å®ç°æ–¹å¼</strong>ï¼š<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> linear_attn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> k</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> v</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> kv_mask</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">None</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">shape</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> exists</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">kv_mask</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        mask_value </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> max_neg_value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        mask </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> kv_mask</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[:,</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> None</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> :,</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> None</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        k </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> k</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">masked_fill</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mask </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mask_value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    kv </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">einsum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bnd,bne->bde</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> k</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> v</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    q </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">einsum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bnd,bde->bne</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> kv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n</ul>\n<p>ğŸ’¡<strong>å¯å‘ç‚¹</strong>ï¼šæ ¸å‡½æ•°å½¢å¼çš„Attentionæœºåˆ¶åœ¨CVé¢†åŸŸå·²æœ‰åº”ç”¨ï¼Œæœªæ¥å¯ä»¥æ¢ç´¢æ›´å¤šåœºæ™¯é€‚é…ã€‚</p>\n<hr>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<p>âš ï¸ <strong>è¯¯åŒºè­¦å‘Š</strong>ï¼š</p>\n<ol>\n<li><strong>å¿½è§†ä»»åŠ¡éœ€æ±‚</strong>ï¼šå¹¶éæ‰€æœ‰ä»»åŠ¡éƒ½é€‚åˆç¨€ç–æˆ–çº¿æ€§Attentionï¼Œéœ€ç»“åˆå…·ä½“åœºæ™¯é€‰æ‹©ã€‚</li>\n<li><strong>å®ç°ä»£ç æ•ˆç‡ä½ä¸‹</strong>ï¼šæœªä¼˜åŒ–çŸ©é˜µè¿ç®—å¯èƒ½å¯¼è‡´æ€§èƒ½åè€Œä¸‹é™ã€‚</li>\n</ol>\n<hr>\n<h2 id=\"æ€è€ƒä¸å»¶ä¼¸é—®é¢˜\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ€è€ƒä¸å»¶ä¼¸é—®é¢˜\"><span>æ€è€ƒä¸å»¶ä¼¸é—®é¢˜</span></a></h2>\n<p>[æ€è€ƒ]</p>\n<ol>\n<li>å¦‚ä½•è®¾è®¡åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸçš„æœºåˆ¶ï¼Œä½¿Sparse Attentionæ›´æ™ºèƒ½åŒ–ï¼Ÿ</li>\n<li>Linear Attentionæ˜¯å¦é€‚åˆæ‰€æœ‰é•¿åºåˆ—ä»»åŠ¡ï¼Œæ˜¯å¦å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Ÿ</li>\n<li>æ ¸å‡½æ•°å½¢å¼çš„Attentionèƒ½å¦åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸè¿›ä¸€æ­¥æ¨å¹¿ï¼Ÿ</li>\n</ol>\n<hr>\n<h2 id=\"ä½œè€…è§‚ç‚¹-vs-ä¸ªäººè§‚ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ä½œè€…è§‚ç‚¹-vs-ä¸ªäººè§‚ç‚¹\"><span>ä½œè€…è§‚ç‚¹ vs ä¸ªäººè§‚ç‚¹</span></a></h2>\n<table>\n<thead>\n<tr>\n<th><strong>ä½œè€…è§‚ç‚¹</strong></th>\n<th><strong>ä¸ªäººè§‚ç‚¹</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Sparse Attentioné€‚åˆå±€éƒ¨ç›¸å…³æ€§ä»»åŠ¡</td>\n<td>åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸæ˜¯æœªæ¥ç ”ç©¶æ–¹å‘</td>\n</tr>\n<tr>\n<td>Linear Attentionæ˜¾è‘—é™ä½è®¡ç®—å¤æ‚åº¦</td>\n<td>æ ¸å‡½æ•°å½¢å¼å€¼å¾—æ¢ç´¢æ›´å¹¿æ³›åº”ç”¨åœºæ™¯</td>\n</tr>\n<tr>\n<td>å®ç°éœ€ä¼˜åŒ–çŸ©é˜µè¿ç®—ä»¥æå‡æ•ˆç‡</td>\n<td>é«˜æ•ˆå®ç°æ˜¯æŠ€æœ¯æ¨å¹¿çš„å…³é”®</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ol>\n<li>âœ… æ·±å…¥ç ”ç©¶Sparse Attentionçš„åŠ¨æ€ä¼˜åŒ–æ–¹æ³•ã€‚</li>\n<li>âš ï¸ æµ‹è¯•Linear Attentionåœ¨ä¸åŒä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚</li>\n<li>â—ï¸ æ¢ç´¢æ ¸å‡½æ•°å½¢å¼åœ¨å…¶ä»–é¢†åŸŸï¼ˆå¦‚è¯­éŸ³å¤„ç†ï¼‰çš„åº”ç”¨ã€‚</li>\n</ol>\n<hr>\n<h2 id=\"æ•°æ®è¡¨æ ¼\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è¡¨æ ¼\"><span>æ•°æ®è¡¨æ ¼</span></a></h2>\n<table>\n<thead>\n<tr>\n<th>æŠ€æœ¯åç§°</th>\n<th>å¤æ‚åº¦ä¼˜åŒ–</th>\n<th>ä¼˜ç¼ºç‚¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Self Attention</td>\n<td>(O(N^2))</td>\n<td>é«˜æˆæœ¬ï¼Œä½†æ•ˆæœå¼º</td>\n</tr>\n<tr>\n<td>Sparse Attention</td>\n<td>é™ä½éƒ¨åˆ†åŒºåŸŸè®¡ç®—</td>\n<td>é«˜æ•ˆä½†éœ€äººå·¥é€‰æ‹©ä¿ç•™åŒºåŸŸ</td>\n</tr>\n<tr>\n<td>Linear Attention</td>\n<td>(O(Nd^2))</td>\n<td>æ¥è¿‘çº¿æ€§ï¼Œé€‚åˆé•¿åºåˆ—ä»»åŠ¡</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’\"><span>åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’</span></a></h2>\n<ol>\n<li><strong>Sparse Attentionæ™ºèƒ½åŒ–</strong>ï¼šå¼€å‘åŠ¨æ€è°ƒæ•´æ³¨æ„åŠ›åŒºåŸŸçš„ç®—æ³•ï¼Œå‡å°‘äººå·¥å¹²é¢„ã€‚</li>\n<li><strong>Linear Attentionæ‰©å±•</strong>ï¼šæµ‹è¯•æ ¸å‡½æ•°å½¢å¼åœ¨å…¶ä»–é¢†åŸŸï¼ˆå¦‚å›¾åƒåˆ†å‰²ã€è¯­éŸ³è¯†åˆ«ï¼‰çš„è¡¨ç°ã€‚</li>\n<li><strong>æ··åˆæ¨¡å‹æ¢ç´¢</strong>ï¼šç»“åˆSparseå’ŒLinear Attentionï¼Œè®¾è®¡æ›´é«˜æ•ˆçš„æ··åˆæ¨¡å‹ã€‚</li>\n</ol>\n<hr>\n<blockquote>\n<p>æ¥æºï¼šæœ¬æ–‡å†…å®¹æ”¹ç¼–è‡ªåŸå§‹æŠ€æœ¯æ¢è®¨ï¼Œå®Œæ•´ä»£ç ä¸å®ç°å¯å‚è€ƒ <a href=\"https://github.com/lucidrains/linear-attention-transformer\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub</a>ã€‚</p>\n</blockquote>\n","env":{"base":"/","filePath":"/Users/qianyuhe/Desktop/my-project/docs/notes_bak/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Attentionæ³¨æ„åŠ›æœºåˆ¶/ä¼˜åŒ–Attentionè®¡ç®—å¤æ‚åº¦çš„æŠ€æœ¯æ¢è®¨.md","filePathRelative":"notes_bak/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Attentionæ³¨æ„åŠ›æœºåˆ¶/ä¼˜åŒ–Attentionè®¡ç®—å¤æ‚åº¦çš„æŠ€æœ¯æ¢è®¨.md","frontmatter":{"dg-publish":true,"dg-permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Attentionæ³¨æ„åŠ›æœºåˆ¶/ä¼˜åŒ–Attentionè®¡ç®—å¤æ‚åº¦çš„æŠ€æœ¯æ¢è®¨","dg-home":false,"dg-description":"åœ¨æ­¤è¾“å…¥ç¬”è®°çš„æè¿°","dg-hide":false,"dg-hide-title":false,"dg-show-backlinks":true,"dg-show-local-graph":true,"dg-show-inline-title":true,"dg-pinned":false,"dg-passphrase":"åœ¨æ­¤è¾“å…¥è®¿é—®å¯†ç ","dg-enable-mathjax":false,"dg-enable-mermaid":false,"dg-enable-uml":false,"dg-note-icon":0,"dg-enable-dataview":false,"tags":["NLP"],"permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Attentionæ³¨æ„åŠ›æœºåˆ¶/ä¼˜åŒ–Attentionè®¡ç®—å¤æ‚åº¦çš„æŠ€æœ¯æ¢è®¨/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true,"dgPassFrontmatter":true,"noteIcon":0,"created":"2025-04-03T14:46:39.000Z","updated":"2025-04-13T05:06:02.000Z","title":"ä¼˜åŒ–Attentionè®¡ç®—å¤æ‚åº¦çš„æŠ€æœ¯æ¢è®¨","createTime":"2025/05/13 17:33:53"},"sfcBlocks":{"template":{"type":"template","content":"<template><h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<ul>\n<li><strong>åˆ†ç±»</strong>ï¼šæ·±åº¦å­¦ä¹ /Transformerä¼˜åŒ–</li>\n<li><strong>æ ‡ç­¾</strong>ï¼šAttentionæœºåˆ¶ã€è®¡ç®—å¤æ‚åº¦ã€Sparse Attentionã€Linear Attention</li>\n<li><strong>æ—¥æœŸ</strong>ï¼š2024å¹´10æœˆ2æ—¥</li>\n</ul>\n<hr>\n<h2 id=\"å†…å®¹æ¦‚è¿°\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å†…å®¹æ¦‚è¿°\"><span>å†…å®¹æ¦‚è¿°</span></a></h2>\n<p>æœ¬æ–‡æ¢è®¨äº†ä¼˜åŒ–Attentionè®¡ç®—å¤æ‚åº¦çš„å‡ ç§æŠ€æœ¯ï¼ŒåŒ…æ‹¬Sparse Attentionå’ŒLinear Attentionã€‚æ ¸å¿ƒç›®æ ‡æ˜¯é™ä½ä¼ ç»ŸSelf Attentionçš„è®¡ç®—å¤æ‚åº¦ï¼ŒåŒæ—¶ä¿ç•™å…¶åœ¨åºåˆ—æ•°æ®å¤„ç†ä¸­çš„å¼ºå¤§åŠŸèƒ½ã€‚</p>\n<hr>\n<h2 id=\"æ ¸å¿ƒå†…å®¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒå†…å®¹\"><span>æ ¸å¿ƒå†…å®¹</span></a></h2>\n<h3 id=\"self-attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#self-attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜\"><span>Self Attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜</span></a></h3>\n<p>ä¼ ç»ŸSelf Attentionçš„è®¡ç®—å¤æ‚åº¦ä¸º (O(N^2))ï¼Œéœ€è¦å¯¹åºåˆ—ä¸­çš„ä»»æ„ä¸¤ä¸ªå‘é‡è®¡ç®—ç›¸å…³æ€§ï¼Œç”Ÿæˆä¸€ä¸ª (N \\times N) çš„ç›¸å…³åº¦çŸ©é˜µã€‚è¿™ç§æ–¹æ³•åœ¨å¤„ç†é•¿åºåˆ—æ—¶ä¼šå¯¼è‡´è®¡ç®—æˆæœ¬è¿‡é«˜ã€‚</p>\n<h3 id=\"sparse-attention-å±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#sparse-attention-å±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³\"><span>Sparse Attentionï¼šå±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³</span></a></h3>\n<p>Sparse Attentioné€šè¿‡é™åˆ¶æ³¨æ„åŠ›çŸ©é˜µä¸­éƒ¨åˆ†åŒºåŸŸçš„è®¡ç®—æ¥é™ä½å¤æ‚åº¦ï¼š</p>\n<ul>\n<li><strong>ä¸»è¦åŸç†</strong>ï¼šç»“åˆç©ºæ´Attentionå’Œå±€éƒ¨Attentionï¼Œè®¾ç½®ç›¸å¯¹è·ç¦»è¶…è¿‡kæˆ–ä¸ºkçš„å€æ•°çš„æ³¨æ„åŠ›ä¸º0ã€‚</li>\n<li><strong>ä¼˜ç‚¹</strong>ï¼šæå‡æ•ˆç‡ï¼Œé€‚åˆå¤§å¤šæ•°åªéœ€å±€éƒ¨ç´§å¯†ç›¸å…³æ€§çš„ä»»åŠ¡ã€‚</li>\n<li><strong>ä¸è¶³</strong>ï¼š\n<ol>\n<li>ä¿ç•™åŒºåŸŸéœ€äººå·¥é€‰æ‹©ï¼Œç¼ºä¹çµæ´»æ€§ã€‚</li>\n<li>å®ç°éœ€è¦ç‰¹å®šä¼˜åŒ–è®¾è®¡ï¼Œä¸æ˜“æ¨å¹¿ã€‚</li>\n</ol>\n</li>\n</ul>\n<p>ğŸ“ˆ<strong>è¶‹åŠ¿é¢„æµ‹</strong>ï¼šSparse Attentionå¯èƒ½æˆä¸ºç‰¹å®šä»»åŠ¡çš„æœ‰æ•ˆè§£å†³æ–¹æ¡ˆï¼Œä½†éœ€è¿›ä¸€æ­¥ç ”ç©¶å¦‚ä½•åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸã€‚</p>\n<h3 id=\"linear-attention-ä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#linear-attention-ä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦\"><span>Linear Attentionï¼šä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦</span></a></h3>\n<p>Linear Attentioné€šè¿‡ç§»é™¤Softmaxæ“ä½œï¼Œå°†è®¡ç®—å¤æ‚åº¦ä» (O(N^2d)) é™è‡³ (O(Nd^2))ï¼š</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå…ˆè®¡ç®— (K^T \\cdot V)ï¼Œå†ç»“åˆæ ¸å‡½æ•°å½¢å¼å¤„ç† (Q \\cdot K^T)ï¼Œä»¥éè´Ÿæ¿€æ´»å‡½æ•°æ›¿ä»£Softmaxã€‚</li>\n<li><strong>å®ç°æ–¹å¼</strong>ï¼š<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> linear_attn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> k</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> v</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> kv_mask</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">None</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">shape</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> exists</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">kv_mask</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        mask_value </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> max_neg_value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        mask </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> kv_mask</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[:,</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> None</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> :,</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> None</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        k </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> k</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">masked_fill</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mask </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mask_value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    kv </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">einsum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bnd,bne->bde</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> k</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> v</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    q </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">einsum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bnd,bde->bne</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> kv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n</ul>\n<p>ğŸ’¡<strong>å¯å‘ç‚¹</strong>ï¼šæ ¸å‡½æ•°å½¢å¼çš„Attentionæœºåˆ¶åœ¨CVé¢†åŸŸå·²æœ‰åº”ç”¨ï¼Œæœªæ¥å¯ä»¥æ¢ç´¢æ›´å¤šåœºæ™¯é€‚é…ã€‚</p>\n<hr>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<p>âš ï¸ <strong>è¯¯åŒºè­¦å‘Š</strong>ï¼š</p>\n<ol>\n<li><strong>å¿½è§†ä»»åŠ¡éœ€æ±‚</strong>ï¼šå¹¶éæ‰€æœ‰ä»»åŠ¡éƒ½é€‚åˆç¨€ç–æˆ–çº¿æ€§Attentionï¼Œéœ€ç»“åˆå…·ä½“åœºæ™¯é€‰æ‹©ã€‚</li>\n<li><strong>å®ç°ä»£ç æ•ˆç‡ä½ä¸‹</strong>ï¼šæœªä¼˜åŒ–çŸ©é˜µè¿ç®—å¯èƒ½å¯¼è‡´æ€§èƒ½åè€Œä¸‹é™ã€‚</li>\n</ol>\n<hr>\n<h2 id=\"æ€è€ƒä¸å»¶ä¼¸é—®é¢˜\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ€è€ƒä¸å»¶ä¼¸é—®é¢˜\"><span>æ€è€ƒä¸å»¶ä¼¸é—®é¢˜</span></a></h2>\n<p>[æ€è€ƒ]</p>\n<ol>\n<li>å¦‚ä½•è®¾è®¡åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸçš„æœºåˆ¶ï¼Œä½¿Sparse Attentionæ›´æ™ºèƒ½åŒ–ï¼Ÿ</li>\n<li>Linear Attentionæ˜¯å¦é€‚åˆæ‰€æœ‰é•¿åºåˆ—ä»»åŠ¡ï¼Œæ˜¯å¦å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Ÿ</li>\n<li>æ ¸å‡½æ•°å½¢å¼çš„Attentionèƒ½å¦åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸè¿›ä¸€æ­¥æ¨å¹¿ï¼Ÿ</li>\n</ol>\n<hr>\n<h2 id=\"ä½œè€…è§‚ç‚¹-vs-ä¸ªäººè§‚ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ä½œè€…è§‚ç‚¹-vs-ä¸ªäººè§‚ç‚¹\"><span>ä½œè€…è§‚ç‚¹ vs ä¸ªäººè§‚ç‚¹</span></a></h2>\n<table>\n<thead>\n<tr>\n<th><strong>ä½œè€…è§‚ç‚¹</strong></th>\n<th><strong>ä¸ªäººè§‚ç‚¹</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Sparse Attentioné€‚åˆå±€éƒ¨ç›¸å…³æ€§ä»»åŠ¡</td>\n<td>åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸæ˜¯æœªæ¥ç ”ç©¶æ–¹å‘</td>\n</tr>\n<tr>\n<td>Linear Attentionæ˜¾è‘—é™ä½è®¡ç®—å¤æ‚åº¦</td>\n<td>æ ¸å‡½æ•°å½¢å¼å€¼å¾—æ¢ç´¢æ›´å¹¿æ³›åº”ç”¨åœºæ™¯</td>\n</tr>\n<tr>\n<td>å®ç°éœ€ä¼˜åŒ–çŸ©é˜µè¿ç®—ä»¥æå‡æ•ˆç‡</td>\n<td>é«˜æ•ˆå®ç°æ˜¯æŠ€æœ¯æ¨å¹¿çš„å…³é”®</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ol>\n<li>âœ… æ·±å…¥ç ”ç©¶Sparse Attentionçš„åŠ¨æ€ä¼˜åŒ–æ–¹æ³•ã€‚</li>\n<li>âš ï¸ æµ‹è¯•Linear Attentionåœ¨ä¸åŒä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚</li>\n<li>â—ï¸ æ¢ç´¢æ ¸å‡½æ•°å½¢å¼åœ¨å…¶ä»–é¢†åŸŸï¼ˆå¦‚è¯­éŸ³å¤„ç†ï¼‰çš„åº”ç”¨ã€‚</li>\n</ol>\n<hr>\n<h2 id=\"æ•°æ®è¡¨æ ¼\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è¡¨æ ¼\"><span>æ•°æ®è¡¨æ ¼</span></a></h2>\n<table>\n<thead>\n<tr>\n<th>æŠ€æœ¯åç§°</th>\n<th>å¤æ‚åº¦ä¼˜åŒ–</th>\n<th>ä¼˜ç¼ºç‚¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Self Attention</td>\n<td>(O(N^2))</td>\n<td>é«˜æˆæœ¬ï¼Œä½†æ•ˆæœå¼º</td>\n</tr>\n<tr>\n<td>Sparse Attention</td>\n<td>é™ä½éƒ¨åˆ†åŒºåŸŸè®¡ç®—</td>\n<td>é«˜æ•ˆä½†éœ€äººå·¥é€‰æ‹©ä¿ç•™åŒºåŸŸ</td>\n</tr>\n<tr>\n<td>Linear Attention</td>\n<td>(O(Nd^2))</td>\n<td>æ¥è¿‘çº¿æ€§ï¼Œé€‚åˆé•¿åºåˆ—ä»»åŠ¡</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’\"><span>åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’</span></a></h2>\n<ol>\n<li><strong>Sparse Attentionæ™ºèƒ½åŒ–</strong>ï¼šå¼€å‘åŠ¨æ€è°ƒæ•´æ³¨æ„åŠ›åŒºåŸŸçš„ç®—æ³•ï¼Œå‡å°‘äººå·¥å¹²é¢„ã€‚</li>\n<li><strong>Linear Attentionæ‰©å±•</strong>ï¼šæµ‹è¯•æ ¸å‡½æ•°å½¢å¼åœ¨å…¶ä»–é¢†åŸŸï¼ˆå¦‚å›¾åƒåˆ†å‰²ã€è¯­éŸ³è¯†åˆ«ï¼‰çš„è¡¨ç°ã€‚</li>\n<li><strong>æ··åˆæ¨¡å‹æ¢ç´¢</strong>ï¼šç»“åˆSparseå’ŒLinear Attentionï¼Œè®¾è®¡æ›´é«˜æ•ˆçš„æ··åˆæ¨¡å‹ã€‚</li>\n</ol>\n<hr>\n<blockquote>\n<p>æ¥æºï¼šæœ¬æ–‡å†…å®¹æ”¹ç¼–è‡ªåŸå§‹æŠ€æœ¯æ¢è®¨ï¼Œå®Œæ•´ä»£ç ä¸å®ç°å¯å‚è€ƒ <a href=\"https://github.com/lucidrains/linear-attention-transformer\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub</a>ã€‚</p>\n</blockquote>\n</template>","contentStripped":"<h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<ul>\n<li><strong>åˆ†ç±»</strong>ï¼šæ·±åº¦å­¦ä¹ /Transformerä¼˜åŒ–</li>\n<li><strong>æ ‡ç­¾</strong>ï¼šAttentionæœºåˆ¶ã€è®¡ç®—å¤æ‚åº¦ã€Sparse Attentionã€Linear Attention</li>\n<li><strong>æ—¥æœŸ</strong>ï¼š2024å¹´10æœˆ2æ—¥</li>\n</ul>\n<hr>\n<h2 id=\"å†…å®¹æ¦‚è¿°\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å†…å®¹æ¦‚è¿°\"><span>å†…å®¹æ¦‚è¿°</span></a></h2>\n<p>æœ¬æ–‡æ¢è®¨äº†ä¼˜åŒ–Attentionè®¡ç®—å¤æ‚åº¦çš„å‡ ç§æŠ€æœ¯ï¼ŒåŒ…æ‹¬Sparse Attentionå’ŒLinear Attentionã€‚æ ¸å¿ƒç›®æ ‡æ˜¯é™ä½ä¼ ç»ŸSelf Attentionçš„è®¡ç®—å¤æ‚åº¦ï¼ŒåŒæ—¶ä¿ç•™å…¶åœ¨åºåˆ—æ•°æ®å¤„ç†ä¸­çš„å¼ºå¤§åŠŸèƒ½ã€‚</p>\n<hr>\n<h2 id=\"æ ¸å¿ƒå†…å®¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒå†…å®¹\"><span>æ ¸å¿ƒå†…å®¹</span></a></h2>\n<h3 id=\"self-attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#self-attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜\"><span>Self Attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜</span></a></h3>\n<p>ä¼ ç»ŸSelf Attentionçš„è®¡ç®—å¤æ‚åº¦ä¸º (O(N^2))ï¼Œéœ€è¦å¯¹åºåˆ—ä¸­çš„ä»»æ„ä¸¤ä¸ªå‘é‡è®¡ç®—ç›¸å…³æ€§ï¼Œç”Ÿæˆä¸€ä¸ª (N \\times N) çš„ç›¸å…³åº¦çŸ©é˜µã€‚è¿™ç§æ–¹æ³•åœ¨å¤„ç†é•¿åºåˆ—æ—¶ä¼šå¯¼è‡´è®¡ç®—æˆæœ¬è¿‡é«˜ã€‚</p>\n<h3 id=\"sparse-attention-å±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#sparse-attention-å±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³\"><span>Sparse Attentionï¼šå±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³</span></a></h3>\n<p>Sparse Attentioné€šè¿‡é™åˆ¶æ³¨æ„åŠ›çŸ©é˜µä¸­éƒ¨åˆ†åŒºåŸŸçš„è®¡ç®—æ¥é™ä½å¤æ‚åº¦ï¼š</p>\n<ul>\n<li><strong>ä¸»è¦åŸç†</strong>ï¼šç»“åˆç©ºæ´Attentionå’Œå±€éƒ¨Attentionï¼Œè®¾ç½®ç›¸å¯¹è·ç¦»è¶…è¿‡kæˆ–ä¸ºkçš„å€æ•°çš„æ³¨æ„åŠ›ä¸º0ã€‚</li>\n<li><strong>ä¼˜ç‚¹</strong>ï¼šæå‡æ•ˆç‡ï¼Œé€‚åˆå¤§å¤šæ•°åªéœ€å±€éƒ¨ç´§å¯†ç›¸å…³æ€§çš„ä»»åŠ¡ã€‚</li>\n<li><strong>ä¸è¶³</strong>ï¼š\n<ol>\n<li>ä¿ç•™åŒºåŸŸéœ€äººå·¥é€‰æ‹©ï¼Œç¼ºä¹çµæ´»æ€§ã€‚</li>\n<li>å®ç°éœ€è¦ç‰¹å®šä¼˜åŒ–è®¾è®¡ï¼Œä¸æ˜“æ¨å¹¿ã€‚</li>\n</ol>\n</li>\n</ul>\n<p>ğŸ“ˆ<strong>è¶‹åŠ¿é¢„æµ‹</strong>ï¼šSparse Attentionå¯èƒ½æˆä¸ºç‰¹å®šä»»åŠ¡çš„æœ‰æ•ˆè§£å†³æ–¹æ¡ˆï¼Œä½†éœ€è¿›ä¸€æ­¥ç ”ç©¶å¦‚ä½•åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸã€‚</p>\n<h3 id=\"linear-attention-ä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#linear-attention-ä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦\"><span>Linear Attentionï¼šä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦</span></a></h3>\n<p>Linear Attentioné€šè¿‡ç§»é™¤Softmaxæ“ä½œï¼Œå°†è®¡ç®—å¤æ‚åº¦ä» (O(N^2d)) é™è‡³ (O(Nd^2))ï¼š</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå…ˆè®¡ç®— (K^T \\cdot V)ï¼Œå†ç»“åˆæ ¸å‡½æ•°å½¢å¼å¤„ç† (Q \\cdot K^T)ï¼Œä»¥éè´Ÿæ¿€æ´»å‡½æ•°æ›¿ä»£Softmaxã€‚</li>\n<li><strong>å®ç°æ–¹å¼</strong>ï¼š<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> linear_attn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> k</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> v</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> kv_mask</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">None</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">shape</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> exists</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">kv_mask</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        mask_value </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> max_neg_value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        mask </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> kv_mask</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[:,</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> None</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> :,</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> None</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        k </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> k</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">masked_fill</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mask </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mask_value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    kv </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">einsum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bnd,bne->bde</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> k</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> v</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    q </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">einsum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bnd,bde->bne</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> q</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> kv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n</ul>\n<p>ğŸ’¡<strong>å¯å‘ç‚¹</strong>ï¼šæ ¸å‡½æ•°å½¢å¼çš„Attentionæœºåˆ¶åœ¨CVé¢†åŸŸå·²æœ‰åº”ç”¨ï¼Œæœªæ¥å¯ä»¥æ¢ç´¢æ›´å¤šåœºæ™¯é€‚é…ã€‚</p>\n<hr>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<p>âš ï¸ <strong>è¯¯åŒºè­¦å‘Š</strong>ï¼š</p>\n<ol>\n<li><strong>å¿½è§†ä»»åŠ¡éœ€æ±‚</strong>ï¼šå¹¶éæ‰€æœ‰ä»»åŠ¡éƒ½é€‚åˆç¨€ç–æˆ–çº¿æ€§Attentionï¼Œéœ€ç»“åˆå…·ä½“åœºæ™¯é€‰æ‹©ã€‚</li>\n<li><strong>å®ç°ä»£ç æ•ˆç‡ä½ä¸‹</strong>ï¼šæœªä¼˜åŒ–çŸ©é˜µè¿ç®—å¯èƒ½å¯¼è‡´æ€§èƒ½åè€Œä¸‹é™ã€‚</li>\n</ol>\n<hr>\n<h2 id=\"æ€è€ƒä¸å»¶ä¼¸é—®é¢˜\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ€è€ƒä¸å»¶ä¼¸é—®é¢˜\"><span>æ€è€ƒä¸å»¶ä¼¸é—®é¢˜</span></a></h2>\n<p>[æ€è€ƒ]</p>\n<ol>\n<li>å¦‚ä½•è®¾è®¡åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸçš„æœºåˆ¶ï¼Œä½¿Sparse Attentionæ›´æ™ºèƒ½åŒ–ï¼Ÿ</li>\n<li>Linear Attentionæ˜¯å¦é€‚åˆæ‰€æœ‰é•¿åºåˆ—ä»»åŠ¡ï¼Œæ˜¯å¦å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Ÿ</li>\n<li>æ ¸å‡½æ•°å½¢å¼çš„Attentionèƒ½å¦åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸè¿›ä¸€æ­¥æ¨å¹¿ï¼Ÿ</li>\n</ol>\n<hr>\n<h2 id=\"ä½œè€…è§‚ç‚¹-vs-ä¸ªäººè§‚ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ä½œè€…è§‚ç‚¹-vs-ä¸ªäººè§‚ç‚¹\"><span>ä½œè€…è§‚ç‚¹ vs ä¸ªäººè§‚ç‚¹</span></a></h2>\n<table>\n<thead>\n<tr>\n<th><strong>ä½œè€…è§‚ç‚¹</strong></th>\n<th><strong>ä¸ªäººè§‚ç‚¹</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Sparse Attentioné€‚åˆå±€éƒ¨ç›¸å…³æ€§ä»»åŠ¡</td>\n<td>åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸæ˜¯æœªæ¥ç ”ç©¶æ–¹å‘</td>\n</tr>\n<tr>\n<td>Linear Attentionæ˜¾è‘—é™ä½è®¡ç®—å¤æ‚åº¦</td>\n<td>æ ¸å‡½æ•°å½¢å¼å€¼å¾—æ¢ç´¢æ›´å¹¿æ³›åº”ç”¨åœºæ™¯</td>\n</tr>\n<tr>\n<td>å®ç°éœ€ä¼˜åŒ–çŸ©é˜µè¿ç®—ä»¥æå‡æ•ˆç‡</td>\n<td>é«˜æ•ˆå®ç°æ˜¯æŠ€æœ¯æ¨å¹¿çš„å…³é”®</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ol>\n<li>âœ… æ·±å…¥ç ”ç©¶Sparse Attentionçš„åŠ¨æ€ä¼˜åŒ–æ–¹æ³•ã€‚</li>\n<li>âš ï¸ æµ‹è¯•Linear Attentionåœ¨ä¸åŒä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚</li>\n<li>â—ï¸ æ¢ç´¢æ ¸å‡½æ•°å½¢å¼åœ¨å…¶ä»–é¢†åŸŸï¼ˆå¦‚è¯­éŸ³å¤„ç†ï¼‰çš„åº”ç”¨ã€‚</li>\n</ol>\n<hr>\n<h2 id=\"æ•°æ®è¡¨æ ¼\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è¡¨æ ¼\"><span>æ•°æ®è¡¨æ ¼</span></a></h2>\n<table>\n<thead>\n<tr>\n<th>æŠ€æœ¯åç§°</th>\n<th>å¤æ‚åº¦ä¼˜åŒ–</th>\n<th>ä¼˜ç¼ºç‚¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Self Attention</td>\n<td>(O(N^2))</td>\n<td>é«˜æˆæœ¬ï¼Œä½†æ•ˆæœå¼º</td>\n</tr>\n<tr>\n<td>Sparse Attention</td>\n<td>é™ä½éƒ¨åˆ†åŒºåŸŸè®¡ç®—</td>\n<td>é«˜æ•ˆä½†éœ€äººå·¥é€‰æ‹©ä¿ç•™åŒºåŸŸ</td>\n</tr>\n<tr>\n<td>Linear Attention</td>\n<td>(O(Nd^2))</td>\n<td>æ¥è¿‘çº¿æ€§ï¼Œé€‚åˆé•¿åºåˆ—ä»»åŠ¡</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’\"><span>åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’</span></a></h2>\n<ol>\n<li><strong>Sparse Attentionæ™ºèƒ½åŒ–</strong>ï¼šå¼€å‘åŠ¨æ€è°ƒæ•´æ³¨æ„åŠ›åŒºåŸŸçš„ç®—æ³•ï¼Œå‡å°‘äººå·¥å¹²é¢„ã€‚</li>\n<li><strong>Linear Attentionæ‰©å±•</strong>ï¼šæµ‹è¯•æ ¸å‡½æ•°å½¢å¼åœ¨å…¶ä»–é¢†åŸŸï¼ˆå¦‚å›¾åƒåˆ†å‰²ã€è¯­éŸ³è¯†åˆ«ï¼‰çš„è¡¨ç°ã€‚</li>\n<li><strong>æ··åˆæ¨¡å‹æ¢ç´¢</strong>ï¼šç»“åˆSparseå’ŒLinear Attentionï¼Œè®¾è®¡æ›´é«˜æ•ˆçš„æ··åˆæ¨¡å‹ã€‚</li>\n</ol>\n<hr>\n<blockquote>\n<p>æ¥æºï¼šæœ¬æ–‡å†…å®¹æ”¹ç¼–è‡ªåŸå§‹æŠ€æœ¯æ¢è®¨ï¼Œå®Œæ•´ä»£ç ä¸å®ç°å¯å‚è€ƒ <a href=\"https://github.com/lucidrains/linear-attention-transformer\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub</a>ã€‚</p>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"## å…ƒæ•°æ®\n- **åˆ†ç±»**ï¼šæ·±åº¦å­¦ä¹ /Transformerä¼˜åŒ–\n- **æ ‡ç­¾**ï¼šAttentionæœºåˆ¶ã€è®¡ç®—å¤æ‚åº¦ã€Sparse Attentionã€Linear Attention\n- **æ—¥æœŸ**ï¼š2024å¹´10æœˆ2æ—¥  \n\n---\n\n\n\n## å†…å®¹æ¦‚è¿°\næœ¬æ–‡æ¢è®¨äº†ä¼˜åŒ–Attentionè®¡ç®—å¤æ‚åº¦çš„å‡ ç§æŠ€æœ¯ï¼ŒåŒ…æ‹¬Sparse Attentionå’ŒLinear Attentionã€‚æ ¸å¿ƒç›®æ ‡æ˜¯é™ä½ä¼ ç»ŸSelf Attentionçš„è®¡ç®—å¤æ‚åº¦ï¼ŒåŒæ—¶ä¿ç•™å…¶åœ¨åºåˆ—æ•°æ®å¤„ç†ä¸­çš„å¼ºå¤§åŠŸèƒ½ã€‚\n\n---\n\n\n\n## æ ¸å¿ƒå†…å®¹\n\n### Self Attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜\nä¼ ç»ŸSelf Attentionçš„è®¡ç®—å¤æ‚åº¦ä¸º \\(O(N^2)\\)ï¼Œéœ€è¦å¯¹åºåˆ—ä¸­çš„ä»»æ„ä¸¤ä¸ªå‘é‡è®¡ç®—ç›¸å…³æ€§ï¼Œç”Ÿæˆä¸€ä¸ª \\(N \\times N\\) çš„ç›¸å…³åº¦çŸ©é˜µã€‚è¿™ç§æ–¹æ³•åœ¨å¤„ç†é•¿åºåˆ—æ—¶ä¼šå¯¼è‡´è®¡ç®—æˆæœ¬è¿‡é«˜ã€‚\n\n\n### Sparse Attentionï¼šå±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³\nSparse Attentioné€šè¿‡é™åˆ¶æ³¨æ„åŠ›çŸ©é˜µä¸­éƒ¨åˆ†åŒºåŸŸçš„è®¡ç®—æ¥é™ä½å¤æ‚åº¦ï¼š\n- **ä¸»è¦åŸç†**ï¼šç»“åˆç©ºæ´Attentionå’Œå±€éƒ¨Attentionï¼Œè®¾ç½®ç›¸å¯¹è·ç¦»è¶…è¿‡kæˆ–ä¸ºkçš„å€æ•°çš„æ³¨æ„åŠ›ä¸º0ã€‚\n- **ä¼˜ç‚¹**ï¼šæå‡æ•ˆç‡ï¼Œé€‚åˆå¤§å¤šæ•°åªéœ€å±€éƒ¨ç´§å¯†ç›¸å…³æ€§çš„ä»»åŠ¡ã€‚\n- **ä¸è¶³**ï¼š\n  1. ä¿ç•™åŒºåŸŸéœ€äººå·¥é€‰æ‹©ï¼Œç¼ºä¹çµæ´»æ€§ã€‚\n  2. å®ç°éœ€è¦ç‰¹å®šä¼˜åŒ–è®¾è®¡ï¼Œä¸æ˜“æ¨å¹¿ã€‚\n\nğŸ“ˆ**è¶‹åŠ¿é¢„æµ‹**ï¼šSparse Attentionå¯èƒ½æˆä¸ºç‰¹å®šä»»åŠ¡çš„æœ‰æ•ˆè§£å†³æ–¹æ¡ˆï¼Œä½†éœ€è¿›ä¸€æ­¥ç ”ç©¶å¦‚ä½•åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸã€‚\n\n\n### Linear Attentionï¼šä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦\nLinear Attentioné€šè¿‡ç§»é™¤Softmaxæ“ä½œï¼Œå°†è®¡ç®—å¤æ‚åº¦ä» \\(O(N^2d)\\) é™è‡³ \\(O(Nd^2)\\)ï¼š\n- **æ ¸å¿ƒæ€æƒ³**ï¼šå…ˆè®¡ç®— \\(K^T \\cdot V\\)ï¼Œå†ç»“åˆæ ¸å‡½æ•°å½¢å¼å¤„ç† \\(Q \\cdot K^T\\)ï¼Œä»¥éè´Ÿæ¿€æ´»å‡½æ•°æ›¿ä»£Softmaxã€‚\n- **å®ç°æ–¹å¼**ï¼š\n  ```python\n  def linear_attn(q, k, v, kv_mask=None):\n      dim = q.shape[-1]\n      if exists(kv_mask):\n          mask_value = max_neg_value(q)\n          mask = kv_mask[:, None, :, None]\n          k = k.masked_fill(mask == 0, mask_value)\n      kv = torch.einsum('bnd,bne->bde', k, v)\n      q = torch.softmax(q, dim=-1)\n      return torch.einsum('bnd,bde->bne', q, kv)\n  ```\n\nğŸ’¡**å¯å‘ç‚¹**ï¼šæ ¸å‡½æ•°å½¢å¼çš„Attentionæœºåˆ¶åœ¨CVé¢†åŸŸå·²æœ‰åº”ç”¨ï¼Œæœªæ¥å¯ä»¥æ¢ç´¢æ›´å¤šåœºæ™¯é€‚é…ã€‚\n\n---\n\n\n\n## å¸¸è§é”™è¯¯\nâš ï¸ **è¯¯åŒºè­¦å‘Š**ï¼š\n1. **å¿½è§†ä»»åŠ¡éœ€æ±‚**ï¼šå¹¶éæ‰€æœ‰ä»»åŠ¡éƒ½é€‚åˆç¨€ç–æˆ–çº¿æ€§Attentionï¼Œéœ€ç»“åˆå…·ä½“åœºæ™¯é€‰æ‹©ã€‚\n2. **å®ç°ä»£ç æ•ˆç‡ä½ä¸‹**ï¼šæœªä¼˜åŒ–çŸ©é˜µè¿ç®—å¯èƒ½å¯¼è‡´æ€§èƒ½åè€Œä¸‹é™ã€‚\n\n---\n\n\n\n## æ€è€ƒä¸å»¶ä¼¸é—®é¢˜\n[æ€è€ƒ]  \n1. å¦‚ä½•è®¾è®¡åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸçš„æœºåˆ¶ï¼Œä½¿Sparse Attentionæ›´æ™ºèƒ½åŒ–ï¼Ÿ\n2. Linear Attentionæ˜¯å¦é€‚åˆæ‰€æœ‰é•¿åºåˆ—ä»»åŠ¡ï¼Œæ˜¯å¦å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Ÿ\n3. æ ¸å‡½æ•°å½¢å¼çš„Attentionèƒ½å¦åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸè¿›ä¸€æ­¥æ¨å¹¿ï¼Ÿ\n\n---\n\n\n\n## ä½œè€…è§‚ç‚¹ vs ä¸ªäººè§‚ç‚¹\n| **ä½œè€…è§‚ç‚¹**                          | **ä¸ªäººè§‚ç‚¹**                           |\n|---------------------------------------|----------------------------------------|\n| Sparse Attentioné€‚åˆå±€éƒ¨ç›¸å…³æ€§ä»»åŠ¡    | åŠ¨æ€é€‰æ‹©æ³¨æ„åŠ›åŒºåŸŸæ˜¯æœªæ¥ç ”ç©¶æ–¹å‘       |\n| Linear Attentionæ˜¾è‘—é™ä½è®¡ç®—å¤æ‚åº¦    | æ ¸å‡½æ•°å½¢å¼å€¼å¾—æ¢ç´¢æ›´å¹¿æ³›åº”ç”¨åœºæ™¯       |\n| å®ç°éœ€ä¼˜åŒ–çŸ©é˜µè¿ç®—ä»¥æå‡æ•ˆç‡          | é«˜æ•ˆå®ç°æ˜¯æŠ€æœ¯æ¨å¹¿çš„å…³é”®               |\n\n---\n\n\n\n## è¡ŒåŠ¨æ¸…å•\n1. âœ… æ·±å…¥ç ”ç©¶Sparse Attentionçš„åŠ¨æ€ä¼˜åŒ–æ–¹æ³•ã€‚\n2. âš ï¸ æµ‹è¯•Linear Attentionåœ¨ä¸åŒä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚\n3. â—ï¸ æ¢ç´¢æ ¸å‡½æ•°å½¢å¼åœ¨å…¶ä»–é¢†åŸŸï¼ˆå¦‚è¯­éŸ³å¤„ç†ï¼‰çš„åº”ç”¨ã€‚\n\n---\n\n\n\n## æ•°æ®è¡¨æ ¼\n| æŠ€æœ¯åç§°         | å¤æ‚åº¦ä¼˜åŒ–       | ä¼˜ç¼ºç‚¹                          |\n|------------------|------------------|---------------------------------|\n| Self Attention   | \\(O(N^2)\\)       | é«˜æˆæœ¬ï¼Œä½†æ•ˆæœå¼º                |\n| Sparse Attention | é™ä½éƒ¨åˆ†åŒºåŸŸè®¡ç®— | é«˜æ•ˆä½†éœ€äººå·¥é€‰æ‹©ä¿ç•™åŒºåŸŸ         |\n| Linear Attention | \\(O(Nd^2)\\)      | æ¥è¿‘çº¿æ€§ï¼Œé€‚åˆé•¿åºåˆ—ä»»åŠ¡         |\n\n---\n\n\n\n## åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’\n1. **Sparse Attentionæ™ºèƒ½åŒ–**ï¼šå¼€å‘åŠ¨æ€è°ƒæ•´æ³¨æ„åŠ›åŒºåŸŸçš„ç®—æ³•ï¼Œå‡å°‘äººå·¥å¹²é¢„ã€‚\n2. **Linear Attentionæ‰©å±•**ï¼šæµ‹è¯•æ ¸å‡½æ•°å½¢å¼åœ¨å…¶ä»–é¢†åŸŸï¼ˆå¦‚å›¾åƒåˆ†å‰²ã€è¯­éŸ³è¯†åˆ«ï¼‰çš„è¡¨ç°ã€‚\n3. **æ··åˆæ¨¡å‹æ¢ç´¢**ï¼šç»“åˆSparseå’ŒLinear Attentionï¼Œè®¾è®¡æ›´é«˜æ•ˆçš„æ··åˆæ¨¡å‹ã€‚\n\n---\n\n> æ¥æºï¼šæœ¬æ–‡å†…å®¹æ”¹ç¼–è‡ªåŸå§‹æŠ€æœ¯æ¢è®¨ï¼Œå®Œæ•´ä»£ç ä¸å®ç°å¯å‚è€ƒ [GitHub](https://github.com/lucidrains/linear-attention-transformer)ã€‚","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":2,"title":"å…ƒæ•°æ®","slug":"å…ƒæ•°æ®","link":"#å…ƒæ•°æ®","children":[]},{"level":2,"title":"å†…å®¹æ¦‚è¿°","slug":"å†…å®¹æ¦‚è¿°","link":"#å†…å®¹æ¦‚è¿°","children":[]},{"level":2,"title":"æ ¸å¿ƒå†…å®¹","slug":"æ ¸å¿ƒå†…å®¹","link":"#æ ¸å¿ƒå†…å®¹","children":[{"level":3,"title":"Self Attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜","slug":"self-attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜","link":"#self-attentionçš„è®¡ç®—å¤æ‚åº¦é—®é¢˜","children":[]},{"level":3,"title":"Sparse Attentionï¼šå±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³","slug":"sparse-attention-å±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³","link":"#sparse-attention-å±€éƒ¨ä¸è¿œç¨‹ç¨€ç–ç›¸å…³","children":[]},{"level":3,"title":"Linear Attentionï¼šä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦","slug":"linear-attention-ä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦","link":"#linear-attention-ä»å¹³æ–¹å¤æ‚åº¦åˆ°çº¿æ€§å¤æ‚åº¦","children":[]}]},{"level":2,"title":"å¸¸è§é”™è¯¯","slug":"å¸¸è§é”™è¯¯","link":"#å¸¸è§é”™è¯¯","children":[]},{"level":2,"title":"æ€è€ƒä¸å»¶ä¼¸é—®é¢˜","slug":"æ€è€ƒä¸å»¶ä¼¸é—®é¢˜","link":"#æ€è€ƒä¸å»¶ä¼¸é—®é¢˜","children":[]},{"level":2,"title":"ä½œè€…è§‚ç‚¹ vs ä¸ªäººè§‚ç‚¹","slug":"ä½œè€…è§‚ç‚¹-vs-ä¸ªäººè§‚ç‚¹","link":"#ä½œè€…è§‚ç‚¹-vs-ä¸ªäººè§‚ç‚¹","children":[]},{"level":2,"title":"è¡ŒåŠ¨æ¸…å•","slug":"è¡ŒåŠ¨æ¸…å•","link":"#è¡ŒåŠ¨æ¸…å•","children":[]},{"level":2,"title":"æ•°æ®è¡¨æ ¼","slug":"æ•°æ®è¡¨æ ¼","link":"#æ•°æ®è¡¨æ ¼","children":[]},{"level":2,"title":"åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’","slug":"åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’","link":"#åç»­è¿½è¸ªç ”ç©¶è®¡åˆ’","children":[]}]}}
