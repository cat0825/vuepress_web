---
dg-publish: true
dg-permalink: /å¤§è¯­è¨€æ¨¡åž‹å­¦ä¹ /Pre-training-é¢„è®­ç»ƒ/ç»§ç»­é¢„è®­ç»ƒ
dg-home: false
dg-description: åœ¨æ­¤è¾“å…¥ç¬”è®°çš„æè¿°
dg-hide: false
dg-hide-title: false
dg-show-backlinks: true
dg-show-local-graph: true
dg-show-inline-title: true
dg-pinned: false
dg-passphrase: åœ¨æ­¤è¾“å…¥è®¿é—®å¯†ç 
dg-enable-mathjax: false
dg-enable-mermaid: false
dg-enable-uml: false
dg-note-icon: 0
dg-enable-dataview: false
tags:
  - NLP
permalink: /å¤§è¯­è¨€æ¨¡åž‹å­¦ä¹ /Pre-training-é¢„è®­ç»ƒ/ç»§ç»­é¢„è®­ç»ƒ/
dgShowBacklinks: true
dgShowLocalGraph: true
dgShowInlineTitle: true
dgPassFrontmatter: true
noteIcon: 0
created: 2025-04-10T17:54:40.000+08:00
updated: 2025-04-13T13:06:02.000+08:00
title: ç»§ç»­é¢„è®­ç»ƒ
createTime: 2025/05/13 17:33:53
---



# é•¿æ–‡æœ¬ç»§ç»­é¢„è®­ç»ƒï¼šä¼˜åŒ–å¤§æ¨¡åž‹çš„ä¸Šä¸‹æ–‡æ‰©å±•èƒ½åŠ›
**åˆ†ç±»**ï¼šæœºå™¨å­¦ä¹   
**æ ‡ç­¾**ï¼šç»§ç»­é¢„è®­ç»ƒã€é•¿æ–‡æœ¬ã€RoPEã€æ¨¡åž‹ä¼˜åŒ–  
**æ—¥æœŸ**ï¼š2023å¹´10æœˆ24æ—¥  

---

## æ ¸å¿ƒè§‚ç‚¹æ€»ç»“
é•¿æ–‡æœ¬ç»§ç»­é¢„è®­ç»ƒæ˜¯å¯¹åŸºç¡€å¤§è¯­è¨€æ¨¡åž‹è¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–çš„ä¸€ç§æ–¹æ³•ï¼Œæ—¨åœ¨é€šè¿‡æ‰©å±•ä¸Šä¸‹æ–‡é•¿åº¦å’Œå¢žå¼ºè¿œç¨‹æ³¨æ„åŠ›èƒ½åŠ›ï¼Œæå‡æ¨¡åž‹å¤„ç†é•¿åºåˆ—æ–‡æœ¬çš„è¡¨çŽ°ã€‚æœ¬æ–‡ä»¥CodeLlamaä¸ºå‚è€ƒï¼ŒæŽ¢è®¨äº†å¦‚ä½•é€šè¿‡è°ƒæ•´æ¨¡åž‹å‚æ•°å’Œå·¥ç¨‹ä¼˜åŒ–æ‰‹æ®µï¼Œå®žçŽ°æ›´é«˜æ•ˆçš„é•¿æ–‡æœ¬é¢„è®­ç»ƒã€‚

---


## é‡ç‚¹å†…å®¹

### 1. ä»€ä¹ˆæ˜¯ç»§ç»­é¢„è®­ç»ƒï¼Ÿ
ç»§ç»­é¢„è®­ç»ƒï¼ˆContinue Pre-trainï¼‰æ˜¯åŸºäºŽçŽ°æœ‰åŸºç¡€æ¨¡åž‹ï¼Œæ³¨å…¥ç‰¹å®šé¢†åŸŸçŸ¥è¯†æˆ–é’ˆå¯¹é•¿æ–‡æœ¬è¿›è¡Œä¼˜åŒ–çš„è¿‡ç¨‹ã€‚å…¶æ ¸å¿ƒåœ¨äºŽï¼š
- **é¢†åŸŸç»§ç»­é¢„è®­ç»ƒ**ï¼šé€šè¿‡åŠ å…¥ç‰¹å®šé¢†åŸŸçš„æ•°æ®ï¼ˆå¦‚ä»£ç ã€æ³•å¾‹ç­‰ï¼‰ï¼Œè°ƒæ•´æ•°æ®æ¯”ä¾‹ï¼ˆå¦‚7:2:1çš„é€šç”¨è¯­æ–™ã€é¢†åŸŸè¯­æ–™å’ŒæŒ‡ä»¤æ•°æ®ï¼‰ï¼Œå®žçŽ°çŸ¥è¯†æ³¨å…¥ã€‚
- **é•¿æ–‡æœ¬ç»§ç»­é¢„è®­ç»ƒ**ï¼šæ‰©å±•æ¨¡åž‹çš„ä¸Šä¸‹æ–‡é•¿åº¦ï¼ˆå¦‚ä»Ž4096æ‰©å±•è‡³16384ï¼‰ï¼Œä¼˜åŒ–æ¨¡åž‹åœ¨é•¿è·ç¦»ä¾èµ–ä¸Šçš„è¡¨çŽ°ã€‚

---


### 2. é•¿æ–‡æœ¬é¢„è®­ç»ƒçš„æŠ€æœ¯ç»†èŠ‚
- **å‚æ•°è°ƒæ•´**ï¼š
  - ä½¿ç”¨RoPEï¼ˆæ—‹è½¬ä½ç½®ç¼–ç ï¼‰æŠ€æœ¯ï¼Œå°†å…¬å¼ä¸­çš„å‚æ•° $$\theta$$ ä»Ž10000è°ƒæ•´åˆ°1000000ï¼Œå‡å¼±è¿œè·ç¦»tokençš„è¡°å‡æ•ˆåº”ã€‚
  - ä¼˜åŒ–æ³¨æ„åŠ›æœºåˆ¶ï¼Œä½¿æ¨¡åž‹æ›´å…³æ³¨é•¿ç¨‹ä¾èµ–ã€‚
  
- **å·¥ç¨‹ä¼˜åŒ–**ï¼š
  - å¼•å…¥ **context parallel** å¹¶è¡Œè®­ç»ƒæœºåˆ¶ï¼Œå¯¹è¾“å…¥åºåˆ—é•¿åº¦è¿›è¡Œåˆ‡åˆ†ï¼Œç±»ä¼¼äºŽ ring attention å’Œ flash attention çš„åŽŸç†ã€‚
  - æ˜¾è‘—æå‡32k/128ké•¿åº¦è®­ç»ƒçš„åžåé‡ï¼Œæ•ˆçŽ‡å¢žåŠ 50%ä»¥ä¸Šã€‚

---


### 3. æ•°æ®ä¸Žé‡‡æ ·
- æ•°æ®é‡ï¼š20Bè§„æ¨¡æ•°æ®ã€‚
- æ•°æ®ç»„æˆï¼šä¸­æ–‡è¯­æ–™ä¸Žé•¿æ–‡æœ¬è¯­æ–™ç›¸ç»“åˆã€‚
- æ–¹æ³•ï¼šé‡‡ç”¨CodeLlamaä¸­çš„NTK-Awareå¤–æŽ¨æ–¹æ³•ï¼Œæå‡é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›ã€‚

---


### 4. ä¸»è¦æ­¥éª¤
1. âœ… **æ•°æ®å‡†å¤‡**ï¼š
   - æ”¶é›†å¹¶æ¸…æ´—é€šç”¨è¯­æ–™ã€é¢†åŸŸè¯­æ–™åŠæŒ‡ä»¤æ•°æ®ã€‚
   - ç¡®ä¿æ•°æ®æ¯”ä¾‹åˆç†ï¼ˆå¦‚7:2:1ï¼‰ã€‚
2. âš  **å‚æ•°è°ƒæ•´**ï¼š
   - è°ƒæ•´RoPEå‚æ•°ä»¥å‡å°‘è¿œè·ç¦»tokenè¡°å‡ã€‚
   - æ‰©å±•ä¸Šä¸‹æ–‡é•¿åº¦è‡³ç›®æ ‡å€¼ï¼ˆå¦‚16384ï¼‰ã€‚
3. â— **å·¥ç¨‹ä¼˜åŒ–**ï¼š
   - å®žçŽ°context parallelæœºåˆ¶ï¼Œæå‡è®­ç»ƒæ•ˆçŽ‡ã€‚
   - é’ˆå¯¹é•¿æ–‡æœ¬è¾“å…¥åˆ‡åˆ†åºåˆ—ï¼Œå‡å°‘è®¡ç®—åŽ‹åŠ›ã€‚

---


## å¸¸è§é”™è¯¯
> **è­¦å‘Š**ï¼š  
> - æ•°æ®é…æ¯”ä¸åˆç†å¯èƒ½å¯¼è‡´é¢†åŸŸçŸ¥è¯†æ³¨å…¥ä¸è¶³æˆ–æ¨¡åž‹æ³›åŒ–èƒ½åŠ›ä¸‹é™ã€‚  
> - å‚æ•°è°ƒæ•´è¿‡äºŽæ¿€è¿›å¯èƒ½å¼•å‘æ¨¡åž‹ä¸ç¨³å®šæ€§ã€‚

---


## ðŸ’¡å¯å‘ç‚¹
- è°ƒæ•´RoPEå‚æ•°å¯¹è¿œç¨‹æ³¨æ„åŠ›çš„å½±å“ä¸ºæ¨¡åž‹ä¼˜åŒ–æä¾›äº†æ–°æ€è·¯ã€‚
- ä½¿ç”¨ context parallel æå‡è®­ç»ƒæ•ˆçŽ‡ï¼Œä¸ºå¤§è§„æ¨¡é•¿æ–‡æœ¬é¢„è®­ç»ƒæä¾›äº†å·¥ç¨‹ä¸Šçš„å¯è¡Œæ€§ã€‚

---


## è¡ŒåŠ¨æ¸…å•
1. æ”¶é›†æ›´å¤šé¢†åŸŸæ•°æ®ï¼Œå°è¯•ä¸åŒé¢†åŸŸçš„ç»§ç»­é¢„è®­ç»ƒã€‚
2. å®žéªŒä¸åŒRoPEå‚æ•°å€¼å¯¹é•¿æ–‡æœ¬å¤„ç†æ•ˆæžœçš„å½±å“ã€‚
3. æŽ¢ç´¢å…¶ä»–å¹¶è¡Œè®­ç»ƒæœºåˆ¶ä»¥è¿›ä¸€æ­¥æå‡æ•ˆçŽ‡ã€‚

---


## ðŸ“ˆè¶‹åŠ¿é¢„æµ‹
- é•¿æ–‡æœ¬é¢„è®­ç»ƒå°†æˆä¸ºå¤§è¯­è¨€æ¨¡åž‹ä¼˜åŒ–çš„é‡è¦æ–¹å‘ï¼Œå°¤å…¶åœ¨éœ€è¦å¤„ç†å¤æ‚ä¸Šä¸‹æ–‡çš„åº”ç”¨åœºæ™¯ä¸­ï¼ˆå¦‚æ³•å¾‹åˆ†æžã€ä»£ç ç”Ÿæˆï¼‰ã€‚
- ç±»ä¼¼context parallelçš„å¹¶è¡Œä¼˜åŒ–æŠ€æœ¯æœ‰æœ›åœ¨æœªæ¥è¿›ä¸€æ­¥æŽ¨å¹¿åˆ°å…¶ä»–é¢†åŸŸã€‚

---


## åŽç»­è¿½è¸ª
1. è°ƒç ”å…¶ä»–å¢žå¼ºé•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›çš„æ–¹æ³•ï¼Œå¦‚æ··åˆæ³¨æ„åŠ›æœºåˆ¶ã€‚
2. æŽ¢ç´¢RoPEä¸Žå…¶ä»–ä½ç½®ç¼–ç æ–¹æ³•çš„èžåˆæ•ˆæžœã€‚
3. è·Ÿè¿›CodeLlamaçš„æœ€æ–°æˆæžœåŠå…¶åœ¨å®žé™…åº”ç”¨ä¸­çš„è¡¨çŽ°ã€‚

---

[æ€è€ƒ]  
1. å¦‚ä½•å¹³è¡¡é•¿æ–‡æœ¬å¤„ç†èƒ½åŠ›ä¸Žè®¡ç®—èµ„æºæ¶ˆè€—ï¼Ÿ  
2. åœ¨ä¸åŒé¢†åŸŸä¸­ï¼Œæ•°æ®æ¯”ä¾‹å¦‚ä½•å½±å“ç»§ç»­é¢„è®­ç»ƒçš„æ•ˆæžœï¼Ÿ  
3. é™¤äº†RoPEï¼Œè¿˜æœ‰å“ªäº›ä½ç½®ç¼–ç æ–¹æ³•é€‚åˆé•¿æ–‡æœ¬ä¼˜åŒ–ï¼Ÿ

---

> åŽŸå§‹å‡ºå¤„ï¼šCodeLlama, Effective Long-Context Scaling of Foundation Models, YaRN: Efficient Context Window Extension of Large Language Models
