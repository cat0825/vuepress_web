---
{"dg-publish":true,"dg-permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Attentionæ³¨æ„åŠ›æœºåˆ¶/æ·±åº¦å­¦ä¹ ä¸­çš„æ³¨æ„åŠ›æœºåˆ¶ä¼˜åŒ–ï¼šä»MHAåˆ°MLA","dg-home":false,"dg-description":"åœ¨æ­¤è¾“å…¥ç¬”è®°çš„æè¿°","dg-hide":false,"dg-hide-title":false,"dg-show-backlinks":true,"dg-show-local-graph":true,"dg-show-inline-title":true,"dg-pinned":false,"dg-passphrase":"åœ¨æ­¤è¾“å…¥è®¿é—®å¯†ç ","dg-enable-mathjax":false,"dg-enable-mermaid":false,"dg-enable-uml":false,"dg-note-icon":0,"dg-enable-dataview":false,"tags":["NLP"],"permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Attentionæ³¨æ„åŠ›æœºåˆ¶/æ·±åº¦å­¦ä¹ ä¸­çš„æ³¨æ„åŠ›æœºåˆ¶ä¼˜åŒ–ï¼šä»MHAåˆ°MLA/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true,"dgPassFrontmatter":true,"noteIcon":0,"created":"2025-04-04T11:14:22.000+08:00","updated":"2025-04-13T13:06:02.000+08:00"}
---



## å…ƒæ•°æ®
- **åˆ†ç±»**: æ·±åº¦å­¦ä¹ , è‡ªç„¶è¯­è¨€å¤„ç†
- **æ ‡ç­¾**: æ³¨æ„åŠ›æœºåˆ¶, Transformerä¼˜åŒ–, KVç¼“å­˜, æ·±åº¦å­¦ä¹ 
- **æ—¥æœŸ**: 2024å¹´10æœˆ2æ—¥  

---



## ç®€ä»‹
ç°ä»£æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­ï¼Œæ³¨æ„åŠ›æœºåˆ¶æ˜¯æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚éšç€Transformeræ¶æ„çš„æ™®åŠï¼Œç»å…¸çš„å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-head Attention, MHAï¼‰é€æ¸æš´éœ²å‡ºåœ¨æ¨ç†é˜¶æ®µæ˜¾å­˜éœ€æ±‚è¿‡é«˜çš„é—®é¢˜ã€‚æœ¬æ–‡æ¢è®¨äº†ä»MHAæ¼”å˜åˆ°MLAçš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ä¸­é—´çš„ä¼˜åŒ–æ–¹æ³•å¦‚MQAï¼ˆMulti-query Attentionï¼‰å’ŒGQAï¼ˆGrouped-query Attentionï¼‰ï¼Œä»¥åŠDeepSeekV2æå‡ºçš„MLAï¼ˆMulti-head Latent Attentionï¼‰è§£å†³æ–¹æ¡ˆã€‚

---



## æ ¸å¿ƒè§‚ç‚¹æ€»ç»“

### âœ… MHAï¼ˆMulti-head Attentionï¼‰
- **ç‰¹ç‚¹**: MHAå°†è¾“å…¥çš„åµŒå…¥å‘é‡åˆ†æˆå¤šä¸ªå­ç©ºé—´ï¼Œæ¯ä¸ªå­ç©ºé—´é€šè¿‡ä¸åŒçš„æ³¨æ„åŠ›å¤´å…³æ³¨ä¸åŒçš„ä¿¡æ¯ã€‚
- **è®¡ç®—ç“¶é¢ˆ**: æ¨ç†è¿‡ç¨‹ä¸­éœ€è¦ç¼“å­˜å¤§é‡çš„Keyå’ŒValueï¼ˆKVï¼‰ï¼Œå¯¼è‡´æ˜¾å­˜éœ€æ±‚é«˜ï¼Œé™åˆ¶äº†æ¨¡å‹çš„æœ€å¤§åºåˆ—é•¿åº¦å’Œæ‰¹é‡å¤§å°ã€‚


### âš ï¸ MQAï¼ˆMulti-query Attentionï¼‰
- **ä¼˜åŒ–ç‚¹**: æ‰€æœ‰Queryå…±äº«åŒä¸€ç»„KVï¼Œå‡å°‘KVç¼“å­˜çš„å­˜å‚¨éœ€æ±‚ã€‚
- **ç¼ºç‚¹**: å¯¹KVçš„å‹ç¼©è¿‡äºæ¿€è¿›ï¼Œå¯èƒ½å¯¼è‡´æ¨¡å‹å­¦ä¹ æ•ˆç‡ä¸‹é™ï¼Œæœ€ç»ˆå½±å“æ•ˆæœã€‚


### â—ï¸ GQAï¼ˆGrouped-query Attentionï¼‰
- **ä¼˜åŒ–ç‚¹**: å°†Queryåˆ†ç»„ï¼Œæ¯ç»„å…±äº«ä¸€ç»„KVï¼Œå¹³è¡¡äº†ç¼“å­˜éœ€æ±‚ä¸æ¨¡å‹æ€§èƒ½ã€‚
- **é€‚ç”¨åœºæ™¯**: åœ¨éœ€è¦ä¸­ç­‰ç¨‹åº¦ä¼˜åŒ–ä½†ä¸å¸Œæœ›æŸå¤±å¤ªå¤šæ€§èƒ½æ—¶ä½¿ç”¨ã€‚


### ğŸ“ˆ MLAï¼ˆMulti-head Latent Attentionï¼‰
- **æå‡ºæœºæ„**: DeepSeekV2
- **æ ¸å¿ƒè§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ä½ç§©KVå‹ç¼©ï¼Œé€šè¿‡é™é‡‡æ ·å’Œä¸ŠæŠ•å½±çŸ©é˜µå‡å°‘ç¼“å­˜éœ€æ±‚ã€‚
- **ä¼˜åŠ¿**: æ˜¾è‘—é™ä½æ¨ç†é˜¶æ®µçš„æ˜¾å­˜éœ€æ±‚ï¼ŒåŒæ—¶ä¿æŒè¾ƒé«˜çš„æ¨¡å‹æ€§èƒ½ã€‚

---



## æ•°æ®ä¸å…¬å¼è§£è¯»

### KVç¼“å­˜éœ€æ±‚å¯¹æ¯”
| æ–¹æ³•       | ç¼“å­˜éœ€æ±‚ (å…ƒç´ æ•°é‡)    | æ€§èƒ½å½±å“     |
|------------|------------------------|--------------|
| MHA        | \( 2 \times n_h \times d_h \times l \) | é«˜æ€§èƒ½      |
| MQA        | \( 2 \times d_h \times l \)          | æ€§èƒ½ä¸‹é™    |
| MLA        | \( d_c \times l \)                  | æ€§èƒ½å¹³è¡¡    |

> \( n_h \): æ³¨æ„åŠ›å¤´æ•°é‡  
> \( d_h \): æ¯ä¸ªå¤´çš„ç»´åº¦  
> \( d_c \): å‹ç¼©åçš„ç»´åº¦  
> \( l \): å±‚æ•°


### MLAæ ¸å¿ƒå…¬å¼
1. **ä½ç§©KVå‹ç¼©**:
   \[
   c_t^{KV} = W_{DKV} h_t
   \]
   - \( W_{DKV} \): é™é‡‡æ ·çŸ©é˜µ
   - \( h_t \): éšå±‚å‘é‡

2. **ä¸ŠæŠ•å½±çŸ©é˜µ**:
   \[
   k_t^C = W_{UK} c_t^{KV}, \quad v_t^C = W_{UV} c_t^{KV}
   \]
   - \( W_{UK}, W_{UV} \): ä¸ŠæŠ•å½±çŸ©é˜µ


### ğŸ“ˆ è¶‹åŠ¿é¢„æµ‹
éšç€æ¨¡å‹è§„æ¨¡ä¸æ–­æ‰©å¤§ï¼Œç±»ä¼¼MLAçš„æ˜¾å­˜ä¼˜åŒ–æŠ€æœ¯å°†æˆä¸ºå¤§æ¨¡å‹éƒ¨ç½²çš„å…³é”®æ–¹å‘ã€‚

---



## è¡ŒåŠ¨æ¸…å•

### âœ… å·¥ç¨‹å®è·µå»ºè®®
1. å®ç°MHAä¼˜åŒ–æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨GQAæˆ–MLAã€‚
2. åœ¨æ¨ç†é˜¶æ®µï¼Œè¯„ä¼°æ˜¾å­˜ä½¿ç”¨æƒ…å†µï¼Œé€‰æ‹©é€‚åˆçš„KVå‹ç¼©æ–¹å¼ã€‚
3. é˜…è¯»DeepSeekV2è®ºæ–‡äº†è§£æ›´å¤šæŠ€æœ¯ç»†èŠ‚ï¼š[è®ºæ–‡é“¾æ¥](https://arxiv.org/pdf/2405.04434)ã€‚


### âš ï¸ å¸¸è§é”™è¯¯
1. å¿½ç•¥KVå‹ç¼©å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚
2. åœ¨ä½æ˜¾å­˜è®¾å¤‡ä¸Šéƒ¨ç½²æœªä¼˜åŒ–çš„MHAæ¨¡å‹ã€‚
3. æœªæ ¹æ®å…·ä½“ä»»åŠ¡é€‰æ‹©é€‚åˆçš„æ³¨æ„åŠ›æœºåˆ¶ä¼˜åŒ–æ–¹æ³•ã€‚

---



## ğŸ’¡ å¯å‘ç‚¹
1. å¦‚ä½•è¿›ä¸€æ­¥ä¼˜åŒ–KVå‹ç¼©æ–¹æ³•ä»¥é€‚åº”æ›´é•¿åºåˆ—é•¿åº¦ï¼Ÿ
2. æ˜¯å¦å¯ä»¥ç»“åˆåŠ¨æ€åˆ†ç»„ç­–ç•¥è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Ÿ
3. MLAæ˜¯å¦é€‚åˆéTransformeræ¶æ„ï¼Ÿ

---



## [æ€è€ƒ]æ¿å—
1. MLAåœ¨å¤šæ¨¡æ€ä»»åŠ¡ä¸­æ˜¯å¦æœ‰ç±»ä¼¼çš„è¡¨ç°ï¼Ÿæ˜¯å¦å¯ä»¥æ‰©å±•åˆ°å›¾åƒå¤„ç†ä»»åŠ¡ï¼Ÿ
2. éšç€ç¡¬ä»¶æŠ€æœ¯è¿›æ­¥ï¼ˆå¦‚æ˜¾å­˜å®¹é‡å¢åŠ ï¼‰ï¼Œè¿™äº›ä¼˜åŒ–æ˜¯å¦ä¼šå˜å¾—ä¸å†å¿…è¦ï¼Ÿ
3. å¦‚ä½•åœ¨å®é™…å·¥ç¨‹ä¸­é€‰æ‹©åˆé€‚çš„æ³¨æ„åŠ›æœºåˆ¶ä¼˜åŒ–æ–¹æ³•ï¼Ÿ

---

> **æ¥æº**  
> - DeepSeekV2è®ºæ–‡è§£æï¼š[CSDNåšå®¢](https://blog.csdn.net/)  
> - è®ºæ–‡åŸæ–‡ï¼š[arXiv](https://arxiv.org/pdf/2405.04434)  
> - å®ç°å‚è€ƒï¼š[çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/714761319)
