{"content":"<h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<ul>\n<li>åˆ†ç±»ï¼šäººå·¥æ™ºèƒ½</li>\n<li>æ ‡ç­¾ï¼šSwitch Transformer, è´Ÿè½½å‡è¡¡, MoEæ¨¡å‹, æ·±åº¦å­¦ä¹ </li>\n<li>æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥</li>\n</ul>\n<h2 id=\"æ¨¡å‹ç‰¹ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ¨¡å‹ç‰¹ç‚¹\"><span>æ¨¡å‹ç‰¹ç‚¹</span></a></h2>\n<p>Switch Transformeræ˜¯ä¸€ç§åŸºäºT5å¼€å‘çš„encoder-decoderç»“æ„æ¨¡å‹ï¼Œæ‹¥æœ‰1.6ä¸‡äº¿å‚æ•°å’Œ2048ä¸ªä¸“å®¶ï¼ˆexpertsï¼‰ã€‚è¯¥æ¨¡å‹çš„æ ¸å¿ƒç‰¹æ€§åœ¨äºå…¶å‚æ•°é‡å¯ä»¥ç‹¬ç«‹äºè®¡ç®—é‡è¿›è¡Œè°ƒæ•´ï¼Œä»è€Œåœ¨ä¸å¢åŠ è®­ç»ƒå’Œæ¨ç†è®¡ç®—é‡çš„æƒ…å†µä¸‹æå‡æ•ˆæœã€‚</p>\n<p>ğŸ’¡å¯å‘ç‚¹ï¼šé€šè¿‡æ”¹å˜å‚æ•°é‡è€Œä¸å¢åŠ è®¡ç®—è´Ÿæ‹…ï¼ŒSwitch Transformerå®ç°äº†æ€§èƒ½æå‡ã€‚</p>\n<h2 id=\"åˆ›æ–°ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åˆ›æ–°ç‚¹\"><span>åˆ›æ–°ç‚¹</span></a></h2>\n<ul>\n<li><strong>MoE to dense</strong>ï¼šå°†æ•ˆæœè¾ƒå¥½çš„MoEæ¨¡å‹è’¸é¦åˆ°denseæ¨¡å‹ï¼Œå‹ç¼©99%çš„å‚æ•°ï¼Œæ•ˆæœä»ä¼˜äºç›´æ¥è®­ç»ƒçš„denseæ¨¡å‹ã€‚</li>\n<li><strong>å¤šè¯­è¨€è®­ç»ƒ</strong>ï¼šåœ¨å¤šè¯­è¨€æ•°æ®é›†ä¸Šè®­ç»ƒï¼Œå‘ç°101ç§è¯­è¨€æ•ˆæœæ™®éæå‡ã€‚</li>\n</ul>\n<h2 id=\"æ¨¡å‹ç»“æ„è®¾è®¡\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ¨¡å‹ç»“æ„è®¾è®¡\"><span>æ¨¡å‹ç»“æ„è®¾è®¡</span></a></h2>\n<p>Switch Transformeré€šè¿‡å°†transformeræ¯å±‚çš„FFNæ›¿æ¢ä¸ºMoEå±‚ï¼Œå¹¶ç®€åŒ–gatingä¸ºåªé€‰æ‹©ä¸€ä¸ªexpertï¼ˆå³k=1ï¼‰ï¼Œå½¢æˆSwitch layerã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250427222619.png\" alt=\"Pasted image 20250427222619.png\"></p>\n<h2 id=\"è´Ÿè½½å‡è¡¡\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è´Ÿè½½å‡è¡¡\"><span>è´Ÿè½½å‡è¡¡</span></a></h2>\n<h3 id=\"å…¬å¼ä¸è®¾å®š\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…¬å¼ä¸è®¾å®š\"><span>å…¬å¼ä¸è®¾å®š</span></a></h3>\n<p>ä¸“å®¶å®¹é‡é€šè¿‡å®¹é‡ç³»æ•°ï¼ˆcapacity factorï¼‰æ§åˆ¶ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>expertÂ capacity</mtext><mo>=</mo><mrow><mo fence=\"true\">(</mo><mfrac><mtext>numberÂ ofÂ experts</mtext><mtext>tokensÂ perÂ batch</mtext></mfrac><mo fence=\"true\">)</mo></mrow><mo>Ã—</mo><mtext>capacityÂ factor</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{expert capacity} = \\left( \\frac{\\text{number of experts}}{\\text{tokens per batch}} \\right) \\times \\text{capacity factor}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8623em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">expertÂ capacity</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">(</span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">tokensÂ perÂ batch</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">numberÂ ofÂ experts</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">)</span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">capacityÂ factor</span></span></span></span></span></span></p>\n<p>ğŸ’¡å¯å‘ç‚¹ï¼šå®¹é‡ç³»æ•°å½±å“ä¸“å®¶å¤„ç†tokençš„èƒ½åŠ›ï¼Œéœ€æƒè¡¡è®¡ç®—å’Œé€šè®¯å‹åŠ›ã€‚</p>\n<h3 id=\"è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡\"><span>è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡</span></a></h3>\n<p>ç»™å®š <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> ä¸ªä¸“å®¶å’ŒåŒ…å« <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span> ä¸ªtokençš„batch <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span>ï¼Œè´Ÿè½½å‡è¡¡æŸå¤±è®¡ç®—å¦‚ä¸‹ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>loss</mtext><mo>=</mo><mi>Î±</mi><mo>â‹…</mo><mi>N</mi><mo>â‹…</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>f</mi><mi>i</mi></msub><mo>â‹…</mo><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\text{loss} = \\alpha \\cdot N \\cdot \\sum_{i=1}^{N} f_i \\cdot P_i\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">loss</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">Î±</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.106em;vertical-align:-1.2777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8283em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span></p>\n<ul>\n<li><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºè¢«åˆ†é…åˆ°ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„tokenæ•°ã€‚</li>\n<li><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">P_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºæ•´ä¸ªbatchæ¯ä¸ªtokenåˆ†é…ç»™ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„æ¦‚ç‡æ€»å’Œã€‚</li>\n</ul>\n<h3 id=\"æ•°æ®è¡¨æ ¼\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è¡¨æ ¼\"><span>æ•°æ®è¡¨æ ¼</span></a></h3>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span></td>\n<td>ä¸“å®¶æ•°é‡</td>\n</tr>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span></td>\n<td>tokenæ•°é‡</td>\n</tr>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n<td>åˆ†é…åˆ°ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„tokenæ•°</td>\n</tr>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">P_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n<td>æ¯ä¸ªtokenåˆ†é…ç»™ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„æ¦‚ç‡æ€»å’Œ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<blockquote>\n<p>âš  æ³¨æ„ï¼šå®¹é‡ç³»æ•°è¿‡å¤§å¯èƒ½å¯¼è‡´è®¡ç®—å’Œé€šè®¯å‹åŠ›å¢å¤§ï¼Œéœ€è°¨æ…è®¾ç½®ã€‚</p>\n</blockquote>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ul>\n<li>æ¢ç´¢Switch Transformeråœ¨ä¸åŒä»»åŠ¡ä¸­çš„åº”ç”¨æ•ˆæœã€‚</li>\n<li>ç ”ç©¶è´Ÿè½½å‡è¡¡æŸå¤±å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚</li>\n<li>å®éªŒä¸åŒå®¹é‡ç³»æ•°è®¾ç½®å¯¹overflowæƒ…å†µçš„å½±å“ã€‚</li>\n</ul>\n<blockquote>\n<p>æ¥æºï¼šåŸå§‹å†…å®¹æ¥è‡ªSwitch Transformeræ–‡æ¡£ã€‚</p>\n</blockquote>\n","env":{"base":"/","filePath":"/Users/qianyuhe/Desktop/my-project/docs/notes_bak/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Common Modelså¸¸è§æ¨¡å‹/MOEç³»åˆ—/Switch Transformer.md","filePathRelative":"notes_bak/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Common Modelså¸¸è§æ¨¡å‹/MOEç³»åˆ—/Switch Transformer.md","frontmatter":{"dg-publish":true,"dg-permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Common-Modelså¸¸è§æ¨¡å‹/MOEç³»åˆ—/Switch-Transformer","dg-home":false,"dg-description":"åœ¨æ­¤è¾“å…¥ç¬”è®°çš„æè¿°","dg-hide":false,"dg-hide-title":false,"dg-show-backlinks":true,"dg-show-local-graph":true,"dg-show-inline-title":true,"dg-pinned":false,"dg-passphrase":"åœ¨æ­¤è¾“å…¥è®¿é—®å¯†ç ","dg-enable-mathjax":false,"dg-enable-mermaid":false,"dg-enable-uml":false,"dg-note-icon":0,"dg-enable-dataview":false,"tags":["NLP"],"permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Common-Modelså¸¸è§æ¨¡å‹/MOEç³»åˆ—/Switch-Transformer/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true,"dgPassFrontmatter":true,"noteIcon":0,"created":"2025-04-27T14:25:40.483Z","updated":"2025-04-27T14:26:21.560Z","title":"Switch Transformer","createTime":"2025/05/13 17:33:53"},"sfcBlocks":{"template":{"type":"template","content":"<template><h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<ul>\n<li>åˆ†ç±»ï¼šäººå·¥æ™ºèƒ½</li>\n<li>æ ‡ç­¾ï¼šSwitch Transformer, è´Ÿè½½å‡è¡¡, MoEæ¨¡å‹, æ·±åº¦å­¦ä¹ </li>\n<li>æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥</li>\n</ul>\n<h2 id=\"æ¨¡å‹ç‰¹ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ¨¡å‹ç‰¹ç‚¹\"><span>æ¨¡å‹ç‰¹ç‚¹</span></a></h2>\n<p>Switch Transformeræ˜¯ä¸€ç§åŸºäºT5å¼€å‘çš„encoder-decoderç»“æ„æ¨¡å‹ï¼Œæ‹¥æœ‰1.6ä¸‡äº¿å‚æ•°å’Œ2048ä¸ªä¸“å®¶ï¼ˆexpertsï¼‰ã€‚è¯¥æ¨¡å‹çš„æ ¸å¿ƒç‰¹æ€§åœ¨äºå…¶å‚æ•°é‡å¯ä»¥ç‹¬ç«‹äºè®¡ç®—é‡è¿›è¡Œè°ƒæ•´ï¼Œä»è€Œåœ¨ä¸å¢åŠ è®­ç»ƒå’Œæ¨ç†è®¡ç®—é‡çš„æƒ…å†µä¸‹æå‡æ•ˆæœã€‚</p>\n<p>ğŸ’¡å¯å‘ç‚¹ï¼šé€šè¿‡æ”¹å˜å‚æ•°é‡è€Œä¸å¢åŠ è®¡ç®—è´Ÿæ‹…ï¼ŒSwitch Transformerå®ç°äº†æ€§èƒ½æå‡ã€‚</p>\n<h2 id=\"åˆ›æ–°ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åˆ›æ–°ç‚¹\"><span>åˆ›æ–°ç‚¹</span></a></h2>\n<ul>\n<li><strong>MoE to dense</strong>ï¼šå°†æ•ˆæœè¾ƒå¥½çš„MoEæ¨¡å‹è’¸é¦åˆ°denseæ¨¡å‹ï¼Œå‹ç¼©99%çš„å‚æ•°ï¼Œæ•ˆæœä»ä¼˜äºç›´æ¥è®­ç»ƒçš„denseæ¨¡å‹ã€‚</li>\n<li><strong>å¤šè¯­è¨€è®­ç»ƒ</strong>ï¼šåœ¨å¤šè¯­è¨€æ•°æ®é›†ä¸Šè®­ç»ƒï¼Œå‘ç°101ç§è¯­è¨€æ•ˆæœæ™®éæå‡ã€‚</li>\n</ul>\n<h2 id=\"æ¨¡å‹ç»“æ„è®¾è®¡\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ¨¡å‹ç»“æ„è®¾è®¡\"><span>æ¨¡å‹ç»“æ„è®¾è®¡</span></a></h2>\n<p>Switch Transformeré€šè¿‡å°†transformeræ¯å±‚çš„FFNæ›¿æ¢ä¸ºMoEå±‚ï¼Œå¹¶ç®€åŒ–gatingä¸ºåªé€‰æ‹©ä¸€ä¸ªexpertï¼ˆå³k=1ï¼‰ï¼Œå½¢æˆSwitch layerã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250427222619.png\" alt=\"Pasted image 20250427222619.png\"></p>\n<h2 id=\"è´Ÿè½½å‡è¡¡\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è´Ÿè½½å‡è¡¡\"><span>è´Ÿè½½å‡è¡¡</span></a></h2>\n<h3 id=\"å…¬å¼ä¸è®¾å®š\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…¬å¼ä¸è®¾å®š\"><span>å…¬å¼ä¸è®¾å®š</span></a></h3>\n<p>ä¸“å®¶å®¹é‡é€šè¿‡å®¹é‡ç³»æ•°ï¼ˆcapacity factorï¼‰æ§åˆ¶ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>expertÂ capacity</mtext><mo>=</mo><mrow><mo fence=\"true\">(</mo><mfrac><mtext>numberÂ ofÂ experts</mtext><mtext>tokensÂ perÂ batch</mtext></mfrac><mo fence=\"true\">)</mo></mrow><mo>Ã—</mo><mtext>capacityÂ factor</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{expert capacity} = \\left( \\frac{\\text{number of experts}}{\\text{tokens per batch}} \\right) \\times \\text{capacity factor}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8623em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">expertÂ capacity</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">(</span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">tokensÂ perÂ batch</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">numberÂ ofÂ experts</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">)</span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">capacityÂ factor</span></span></span></span></span></span></p>\n<p>ğŸ’¡å¯å‘ç‚¹ï¼šå®¹é‡ç³»æ•°å½±å“ä¸“å®¶å¤„ç†tokençš„èƒ½åŠ›ï¼Œéœ€æƒè¡¡è®¡ç®—å’Œé€šè®¯å‹åŠ›ã€‚</p>\n<h3 id=\"è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡\"><span>è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡</span></a></h3>\n<p>ç»™å®š <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> ä¸ªä¸“å®¶å’ŒåŒ…å« <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span> ä¸ªtokençš„batch <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span>ï¼Œè´Ÿè½½å‡è¡¡æŸå¤±è®¡ç®—å¦‚ä¸‹ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>loss</mtext><mo>=</mo><mi>Î±</mi><mo>â‹…</mo><mi>N</mi><mo>â‹…</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>f</mi><mi>i</mi></msub><mo>â‹…</mo><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\text{loss} = \\alpha \\cdot N \\cdot \\sum_{i=1}^{N} f_i \\cdot P_i\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">loss</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">Î±</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.106em;vertical-align:-1.2777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8283em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span></p>\n<ul>\n<li><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºè¢«åˆ†é…åˆ°ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„tokenæ•°ã€‚</li>\n<li><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">P_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºæ•´ä¸ªbatchæ¯ä¸ªtokenåˆ†é…ç»™ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„æ¦‚ç‡æ€»å’Œã€‚</li>\n</ul>\n<h3 id=\"æ•°æ®è¡¨æ ¼\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è¡¨æ ¼\"><span>æ•°æ®è¡¨æ ¼</span></a></h3>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span></td>\n<td>ä¸“å®¶æ•°é‡</td>\n</tr>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span></td>\n<td>tokenæ•°é‡</td>\n</tr>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n<td>åˆ†é…åˆ°ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„tokenæ•°</td>\n</tr>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">P_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n<td>æ¯ä¸ªtokenåˆ†é…ç»™ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„æ¦‚ç‡æ€»å’Œ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<blockquote>\n<p>âš  æ³¨æ„ï¼šå®¹é‡ç³»æ•°è¿‡å¤§å¯èƒ½å¯¼è‡´è®¡ç®—å’Œé€šè®¯å‹åŠ›å¢å¤§ï¼Œéœ€è°¨æ…è®¾ç½®ã€‚</p>\n</blockquote>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ul>\n<li>æ¢ç´¢Switch Transformeråœ¨ä¸åŒä»»åŠ¡ä¸­çš„åº”ç”¨æ•ˆæœã€‚</li>\n<li>ç ”ç©¶è´Ÿè½½å‡è¡¡æŸå¤±å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚</li>\n<li>å®éªŒä¸åŒå®¹é‡ç³»æ•°è®¾ç½®å¯¹overflowæƒ…å†µçš„å½±å“ã€‚</li>\n</ul>\n<blockquote>\n<p>æ¥æºï¼šåŸå§‹å†…å®¹æ¥è‡ªSwitch Transformeræ–‡æ¡£ã€‚</p>\n</blockquote>\n</template>","contentStripped":"<h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<ul>\n<li>åˆ†ç±»ï¼šäººå·¥æ™ºèƒ½</li>\n<li>æ ‡ç­¾ï¼šSwitch Transformer, è´Ÿè½½å‡è¡¡, MoEæ¨¡å‹, æ·±åº¦å­¦ä¹ </li>\n<li>æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥</li>\n</ul>\n<h2 id=\"æ¨¡å‹ç‰¹ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ¨¡å‹ç‰¹ç‚¹\"><span>æ¨¡å‹ç‰¹ç‚¹</span></a></h2>\n<p>Switch Transformeræ˜¯ä¸€ç§åŸºäºT5å¼€å‘çš„encoder-decoderç»“æ„æ¨¡å‹ï¼Œæ‹¥æœ‰1.6ä¸‡äº¿å‚æ•°å’Œ2048ä¸ªä¸“å®¶ï¼ˆexpertsï¼‰ã€‚è¯¥æ¨¡å‹çš„æ ¸å¿ƒç‰¹æ€§åœ¨äºå…¶å‚æ•°é‡å¯ä»¥ç‹¬ç«‹äºè®¡ç®—é‡è¿›è¡Œè°ƒæ•´ï¼Œä»è€Œåœ¨ä¸å¢åŠ è®­ç»ƒå’Œæ¨ç†è®¡ç®—é‡çš„æƒ…å†µä¸‹æå‡æ•ˆæœã€‚</p>\n<p>ğŸ’¡å¯å‘ç‚¹ï¼šé€šè¿‡æ”¹å˜å‚æ•°é‡è€Œä¸å¢åŠ è®¡ç®—è´Ÿæ‹…ï¼ŒSwitch Transformerå®ç°äº†æ€§èƒ½æå‡ã€‚</p>\n<h2 id=\"åˆ›æ–°ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åˆ›æ–°ç‚¹\"><span>åˆ›æ–°ç‚¹</span></a></h2>\n<ul>\n<li><strong>MoE to dense</strong>ï¼šå°†æ•ˆæœè¾ƒå¥½çš„MoEæ¨¡å‹è’¸é¦åˆ°denseæ¨¡å‹ï¼Œå‹ç¼©99%çš„å‚æ•°ï¼Œæ•ˆæœä»ä¼˜äºç›´æ¥è®­ç»ƒçš„denseæ¨¡å‹ã€‚</li>\n<li><strong>å¤šè¯­è¨€è®­ç»ƒ</strong>ï¼šåœ¨å¤šè¯­è¨€æ•°æ®é›†ä¸Šè®­ç»ƒï¼Œå‘ç°101ç§è¯­è¨€æ•ˆæœæ™®éæå‡ã€‚</li>\n</ul>\n<h2 id=\"æ¨¡å‹ç»“æ„è®¾è®¡\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ¨¡å‹ç»“æ„è®¾è®¡\"><span>æ¨¡å‹ç»“æ„è®¾è®¡</span></a></h2>\n<p>Switch Transformeré€šè¿‡å°†transformeræ¯å±‚çš„FFNæ›¿æ¢ä¸ºMoEå±‚ï¼Œå¹¶ç®€åŒ–gatingä¸ºåªé€‰æ‹©ä¸€ä¸ªexpertï¼ˆå³k=1ï¼‰ï¼Œå½¢æˆSwitch layerã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250427222619.png\" alt=\"Pasted image 20250427222619.png\"></p>\n<h2 id=\"è´Ÿè½½å‡è¡¡\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è´Ÿè½½å‡è¡¡\"><span>è´Ÿè½½å‡è¡¡</span></a></h2>\n<h3 id=\"å…¬å¼ä¸è®¾å®š\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…¬å¼ä¸è®¾å®š\"><span>å…¬å¼ä¸è®¾å®š</span></a></h3>\n<p>ä¸“å®¶å®¹é‡é€šè¿‡å®¹é‡ç³»æ•°ï¼ˆcapacity factorï¼‰æ§åˆ¶ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>expertÂ capacity</mtext><mo>=</mo><mrow><mo fence=\"true\">(</mo><mfrac><mtext>numberÂ ofÂ experts</mtext><mtext>tokensÂ perÂ batch</mtext></mfrac><mo fence=\"true\">)</mo></mrow><mo>Ã—</mo><mtext>capacityÂ factor</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{expert capacity} = \\left( \\frac{\\text{number of experts}}{\\text{tokens per batch}} \\right) \\times \\text{capacity factor}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8623em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">expertÂ capacity</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">(</span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">tokensÂ perÂ batch</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">numberÂ ofÂ experts</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8804em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">)</span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">capacityÂ factor</span></span></span></span></span></span></p>\n<p>ğŸ’¡å¯å‘ç‚¹ï¼šå®¹é‡ç³»æ•°å½±å“ä¸“å®¶å¤„ç†tokençš„èƒ½åŠ›ï¼Œéœ€æƒè¡¡è®¡ç®—å’Œé€šè®¯å‹åŠ›ã€‚</p>\n<h3 id=\"è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡\"><span>è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡</span></a></h3>\n<p>ç»™å®š <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> ä¸ªä¸“å®¶å’ŒåŒ…å« <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span> ä¸ªtokençš„batch <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span>ï¼Œè´Ÿè½½å‡è¡¡æŸå¤±è®¡ç®—å¦‚ä¸‹ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>loss</mtext><mo>=</mo><mi>Î±</mi><mo>â‹…</mo><mi>N</mi><mo>â‹…</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>f</mi><mi>i</mi></msub><mo>â‹…</mo><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\text{loss} = \\alpha \\cdot N \\cdot \\sum_{i=1}^{N} f_i \\cdot P_i\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">loss</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">Î±</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.106em;vertical-align:-1.2777em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8283em;\"><span style=\"top:-1.8723em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span><span style=\"top:-4.3em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2777em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span></p>\n<ul>\n<li><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºè¢«åˆ†é…åˆ°ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„tokenæ•°ã€‚</li>\n<li><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">P_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºæ•´ä¸ªbatchæ¯ä¸ªtokenåˆ†é…ç»™ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„æ¦‚ç‡æ€»å’Œã€‚</li>\n</ul>\n<h3 id=\"æ•°æ®è¡¨æ ¼\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è¡¨æ ¼\"><span>æ•°æ®è¡¨æ ¼</span></a></h3>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span></td>\n<td>ä¸“å®¶æ•°é‡</td>\n</tr>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi></mrow><annotation encoding=\"application/x-tex\">T</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span></span></span></span></td>\n<td>tokenæ•°é‡</td>\n</tr>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n<td>åˆ†é…åˆ°ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„tokenæ•°</td>\n</tr>\n<tr>\n<td><span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">P_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n<td>æ¯ä¸ªtokenåˆ†é…ç»™ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> ä¸ªä¸“å®¶çš„æ¦‚ç‡æ€»å’Œ</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<blockquote>\n<p>âš  æ³¨æ„ï¼šå®¹é‡ç³»æ•°è¿‡å¤§å¯èƒ½å¯¼è‡´è®¡ç®—å’Œé€šè®¯å‹åŠ›å¢å¤§ï¼Œéœ€è°¨æ…è®¾ç½®ã€‚</p>\n</blockquote>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ul>\n<li>æ¢ç´¢Switch Transformeråœ¨ä¸åŒä»»åŠ¡ä¸­çš„åº”ç”¨æ•ˆæœã€‚</li>\n<li>ç ”ç©¶è´Ÿè½½å‡è¡¡æŸå¤±å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚</li>\n<li>å®éªŒä¸åŒå®¹é‡ç³»æ•°è®¾ç½®å¯¹overflowæƒ…å†µçš„å½±å“ã€‚</li>\n</ul>\n<blockquote>\n<p>æ¥æºï¼šåŸå§‹å†…å®¹æ¥è‡ªSwitch Transformeræ–‡æ¡£ã€‚</p>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"\n## å…ƒæ•°æ®\n- åˆ†ç±»ï¼šäººå·¥æ™ºèƒ½\n- æ ‡ç­¾ï¼šSwitch Transformer, è´Ÿè½½å‡è¡¡, MoEæ¨¡å‹, æ·±åº¦å­¦ä¹ \n- æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥\n\n\n## æ¨¡å‹ç‰¹ç‚¹\nSwitch Transformeræ˜¯ä¸€ç§åŸºäºT5å¼€å‘çš„encoder-decoderç»“æ„æ¨¡å‹ï¼Œæ‹¥æœ‰1.6ä¸‡äº¿å‚æ•°å’Œ2048ä¸ªä¸“å®¶ï¼ˆexpertsï¼‰ã€‚è¯¥æ¨¡å‹çš„æ ¸å¿ƒç‰¹æ€§åœ¨äºå…¶å‚æ•°é‡å¯ä»¥ç‹¬ç«‹äºè®¡ç®—é‡è¿›è¡Œè°ƒæ•´ï¼Œä»è€Œåœ¨ä¸å¢åŠ è®­ç»ƒå’Œæ¨ç†è®¡ç®—é‡çš„æƒ…å†µä¸‹æå‡æ•ˆæœã€‚\n\nğŸ’¡å¯å‘ç‚¹ï¼šé€šè¿‡æ”¹å˜å‚æ•°é‡è€Œä¸å¢åŠ è®¡ç®—è´Ÿæ‹…ï¼ŒSwitch Transformerå®ç°äº†æ€§èƒ½æå‡ã€‚\n\n\n## åˆ›æ–°ç‚¹\n- **MoE to dense**ï¼šå°†æ•ˆæœè¾ƒå¥½çš„MoEæ¨¡å‹è’¸é¦åˆ°denseæ¨¡å‹ï¼Œå‹ç¼©99%çš„å‚æ•°ï¼Œæ•ˆæœä»ä¼˜äºç›´æ¥è®­ç»ƒçš„denseæ¨¡å‹ã€‚\n- **å¤šè¯­è¨€è®­ç»ƒ**ï¼šåœ¨å¤šè¯­è¨€æ•°æ®é›†ä¸Šè®­ç»ƒï¼Œå‘ç°101ç§è¯­è¨€æ•ˆæœæ™®éæå‡ã€‚\n\n\n## æ¨¡å‹ç»“æ„è®¾è®¡\nSwitch Transformeré€šè¿‡å°†transformeræ¯å±‚çš„FFNæ›¿æ¢ä¸ºMoEå±‚ï¼Œå¹¶ç®€åŒ–gatingä¸ºåªé€‰æ‹©ä¸€ä¸ªexpertï¼ˆå³k=1ï¼‰ï¼Œå½¢æˆSwitch layerã€‚\n![Pasted image 20250427222619.png](/img/user/%E9%99%84%E4%BB%B6/Pasted%20image%2020250427222619.png)\n\n\n## è´Ÿè½½å‡è¡¡\n\n### å…¬å¼ä¸è®¾å®š\nä¸“å®¶å®¹é‡é€šè¿‡å®¹é‡ç³»æ•°ï¼ˆcapacity factorï¼‰æ§åˆ¶ï¼Œå…¬å¼å¦‚ä¸‹ï¼š\n$$\n\\text{expert capacity} = \\left( \\frac{\\text{number of experts}}{\\text{tokens per batch}} \\right) \\times \\text{capacity factor}\n$$\n\nğŸ’¡å¯å‘ç‚¹ï¼šå®¹é‡ç³»æ•°å½±å“ä¸“å®¶å¤„ç†tokençš„èƒ½åŠ›ï¼Œéœ€æƒè¡¡è®¡ç®—å’Œé€šè®¯å‹åŠ›ã€‚\n\n\n### è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡\nç»™å®š $N$ ä¸ªä¸“å®¶å’ŒåŒ…å« $T$ ä¸ªtokençš„batch $B$ï¼Œè´Ÿè½½å‡è¡¡æŸå¤±è®¡ç®—å¦‚ä¸‹ï¼š\n$$\n\\text{loss} = \\alpha \\cdot N \\cdot \\sum_{i=1}^{N} f_i \\cdot P_i\n$$\n- $f_i$ è¡¨ç¤ºè¢«åˆ†é…åˆ°ç¬¬ $i$ ä¸ªä¸“å®¶çš„tokenæ•°ã€‚\n- $P_i$ è¡¨ç¤ºæ•´ä¸ªbatchæ¯ä¸ªtokenåˆ†é…ç»™ç¬¬ $i$ ä¸ªä¸“å®¶çš„æ¦‚ç‡æ€»å’Œã€‚\n\n\n### æ•°æ®è¡¨æ ¼\n| å‚æ•° | æè¿° |\n|------|------|\n| $N$ | ä¸“å®¶æ•°é‡ |\n| $T$ | tokenæ•°é‡ |\n| $f_i$ | åˆ†é…åˆ°ç¬¬ $i$ ä¸ªä¸“å®¶çš„tokenæ•° |\n| $P_i$ | æ¯ä¸ªtokenåˆ†é…ç»™ç¬¬ $i$ ä¸ªä¸“å®¶çš„æ¦‚ç‡æ€»å’Œ |\n\n\n## å¸¸è§é”™è¯¯\n> âš  æ³¨æ„ï¼šå®¹é‡ç³»æ•°è¿‡å¤§å¯èƒ½å¯¼è‡´è®¡ç®—å’Œé€šè®¯å‹åŠ›å¢å¤§ï¼Œéœ€è°¨æ…è®¾ç½®ã€‚\n\n\n## è¡ŒåŠ¨æ¸…å•\n- æ¢ç´¢Switch Transformeråœ¨ä¸åŒä»»åŠ¡ä¸­çš„åº”ç”¨æ•ˆæœã€‚\n- ç ”ç©¶è´Ÿè½½å‡è¡¡æŸå¤±å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚\n- å®éªŒä¸åŒå®¹é‡ç³»æ•°è®¾ç½®å¯¹overflowæƒ…å†µçš„å½±å“ã€‚\n\n> æ¥æºï¼šåŸå§‹å†…å®¹æ¥è‡ªSwitch Transformeræ–‡æ¡£ã€‚","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":2,"title":"å…ƒæ•°æ®","slug":"å…ƒæ•°æ®","link":"#å…ƒæ•°æ®","children":[]},{"level":2,"title":"æ¨¡å‹ç‰¹ç‚¹","slug":"æ¨¡å‹ç‰¹ç‚¹","link":"#æ¨¡å‹ç‰¹ç‚¹","children":[]},{"level":2,"title":"åˆ›æ–°ç‚¹","slug":"åˆ›æ–°ç‚¹","link":"#åˆ›æ–°ç‚¹","children":[]},{"level":2,"title":"æ¨¡å‹ç»“æ„è®¾è®¡","slug":"æ¨¡å‹ç»“æ„è®¾è®¡","link":"#æ¨¡å‹ç»“æ„è®¾è®¡","children":[]},{"level":2,"title":"è´Ÿè½½å‡è¡¡","slug":"è´Ÿè½½å‡è¡¡","link":"#è´Ÿè½½å‡è¡¡","children":[{"level":3,"title":"å…¬å¼ä¸è®¾å®š","slug":"å…¬å¼ä¸è®¾å®š","link":"#å…¬å¼ä¸è®¾å®š","children":[]},{"level":3,"title":"è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡","slug":"è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡","link":"#è´Ÿè½½å‡è¡¡æŸå¤±è®¾è®¡","children":[]},{"level":3,"title":"æ•°æ®è¡¨æ ¼","slug":"æ•°æ®è¡¨æ ¼","link":"#æ•°æ®è¡¨æ ¼","children":[]}]},{"level":2,"title":"å¸¸è§é”™è¯¯","slug":"å¸¸è§é”™è¯¯","link":"#å¸¸è§é”™è¯¯","children":[]},{"level":2,"title":"è¡ŒåŠ¨æ¸…å•","slug":"è¡ŒåŠ¨æ¸…å•","link":"#è¡ŒåŠ¨æ¸…å•","children":[]}]}}
