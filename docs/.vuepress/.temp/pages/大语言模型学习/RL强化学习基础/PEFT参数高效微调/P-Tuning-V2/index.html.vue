<template><div><p>å…ƒæ•°æ®ï¼š</p>
<p>åˆ†ç±»ï¼šè‡ªç„¶è¯­è¨€å¤„ç†</p>
<p>æ ‡ç­¾ï¼šP-Tuning V2, è‡ªç„¶è¯­è¨€ç†è§£, æç¤ºä¼˜åŒ–</p>
<p>æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥</p>
<h2 id="æ ¸å¿ƒè§‚ç‚¹æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒè§‚ç‚¹æ€»ç»“"><span>æ ¸å¿ƒè§‚ç‚¹æ€»ç»“</span></a></h2>
<p>P-Tuning V2 æ˜¯ä¸€ç§æ”¹è¿›çš„æç¤ºä¼˜åŒ–æŠ€æœ¯ï¼Œæ—¨åœ¨è§£å†³ä¹‹å‰æ–¹æ³•ä¸­å­˜åœ¨çš„æ¨¡å‹å‚æ•°è§„æ¨¡å’Œä»»åŠ¡é€šç”¨æ€§é—®é¢˜ã€‚é€šè¿‡åœ¨æ¯ä¸€å±‚åŠ å…¥æç¤ºï¼ˆPromptsï¼‰è€Œä¸ä»…ä»…æ˜¯è¾“å…¥å±‚ï¼ŒP-Tuning V2 æä¾›äº†æ›´å¤šå¯å­¦ä¹ çš„å‚æ•°ï¼Œå¹¶èƒ½æ›´ç›´æ¥å½±å“æ¨¡å‹é¢„æµ‹ã€‚ğŸ’¡è¿™ä½¿å¾—æç¤ºä¼˜åŒ–åœ¨è¾ƒå°æ¨¡å‹å’Œå¤šä»»åŠ¡å­¦ä¹ ä¸­è¡¨ç°æ›´ä¸ºä¼˜å¼‚ã€‚</p>
<h2 id="é‡ç‚¹æ®µè½" tabindex="-1"><a class="header-anchor" href="#é‡ç‚¹æ®µè½"><span>é‡ç‚¹æ®µè½</span></a></h2>
<ol>
<li>
<p><strong>ç¼ºä¹æ¨¡å‹å‚æ•°è§„æ¨¡å’Œä»»åŠ¡é€šç”¨æ€§</strong><br>
ä¹‹å‰çš„æç¤ºä¼˜åŒ–æ–¹æ³•åœ¨å¤§è§„æ¨¡æ¨¡å‹ä¸­è¡¨ç°è‰¯å¥½ï¼Œä½†åœ¨è¾ƒå°æ¨¡å‹ï¼ˆ100Måˆ°1Bå‚æ•°ï¼‰ä¸Šä¸å…¨é‡å¾®è°ƒå·®å¼‚æ˜¾è‘—ï¼Œé™åˆ¶äº†å…¶é€‚ç”¨æ€§ã€‚</p>
</li>
<li>
<p><strong>æ·±åº¦æç¤ºä¼˜åŒ–çš„å¼•å…¥</strong><br>
åœ¨æ¯ä¸€å±‚åŠ å…¥æç¤ºä»¤å¯å­¦ä¹ å‚æ•°å¢åŠ ï¼Œä»è€Œæå‡äº†å‚æ•°æ•ˆç‡å’Œæ¨¡å‹é¢„æµ‹çš„ç›´æ¥å½±å“ã€‚</p>
</li>
<li>
<p><strong>å¤šä»»åŠ¡å­¦ä¹ å’Œæç¤ºé•¿åº¦ä¼˜åŒ–</strong><br>
é’ˆå¯¹ä¸åŒä»»åŠ¡é‡‡ç”¨ä¸åŒæç¤ºé•¿åº¦ï¼Œå¹¶é€šè¿‡å¤šä»»åŠ¡å­¦ä¹ è¿›è¡Œé¢„è®­ç»ƒï¼Œä»¥ç¼“è§£ä¼˜åŒ–å›°éš¾ã€‚</p>
</li>
</ol>
<h2 id="æŠ€æœ¯æœ¯è¯­é€šä¿—è½¬è¿°" tabindex="-1"><a class="header-anchor" href="#æŠ€æœ¯æœ¯è¯­é€šä¿—è½¬è¿°"><span>æŠ€æœ¯æœ¯è¯­é€šä¿—è½¬è¿°</span></a></h2>
<ul>
<li><strong>æç¤ºä¼˜åŒ–ï¼ˆPrompt Tuningï¼‰</strong>ï¼šä¸€ç§é€šè¿‡åœ¨è¾“å…¥ä¸­æ’å…¥ç‰¹æ®Šæç¤ºæ¥å¼•å¯¼æ¨¡å‹å­¦ä¹ çš„æŠ€æœ¯ã€‚</li>
<li><strong>å…¨é‡å¾®è°ƒ</strong>ï¼šå¯¹æ•´ä¸ªæ¨¡å‹è¿›è¡Œå‚æ•°è°ƒæ•´ä»¥æé«˜æ€§èƒ½çš„æ–¹æ³•ã€‚</li>
<li><strong>å¤šä»»åŠ¡å­¦ä¹ </strong>ï¼šåŒæ—¶å­¦ä¹ å¤šä¸ªç›¸å…³ä»»åŠ¡ï¼Œä»¥æé«˜æ¨¡å‹åœ¨å„ä¸ªä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚</li>
</ul>
<h2 id="å®æ–½æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#å®æ–½æ­¥éª¤"><span>å®æ–½æ­¥éª¤</span></a></h2>
<ol>
<li>âœ… åœ¨æ¯ä¸€å±‚åŠ å…¥ Prompts tokens ä½œä¸ºè¾“å…¥ã€‚</li>
<li>âš  ç§»é™¤é‡å‚æ•°åŒ–çš„ç¼–ç å™¨ä»¥æé«˜è®­ç»ƒé€Ÿåº¦å’Œé²æ£’æ€§ã€‚</li>
<li>â— é’ˆå¯¹ä¸åŒä»»åŠ¡é€‰æ‹©åˆé€‚çš„æç¤ºé•¿åº¦ã€‚</li>
<li>âœ… å¼•å…¥å¤šä»»åŠ¡å­¦ä¹ è¿›è¡Œé¢„è®­ç»ƒã€‚
<img src="/img/user/é™„ä»¶/Pasted image 20250424105959.png" alt="Pasted image 20250424105959.png"></li>
</ol>
<h2 id="ä»£ç å®ç°" tabindex="-1"><a class="header-anchor" href="#ä»£ç å®ç°"><span>ä»£ç å®ç°</span></a></h2>
<div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">#è®¾ç½®virtual_tokençš„æ•°é‡åŠpast_key_valuesç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">prompt_tokens </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> prompt_tokens</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[:,</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> :</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> peft_config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_virtual_tokens</span><span style="--shiki-light:#999999;--shiki-dark:#666666">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">past_key_values </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> past_key_values</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">view</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">batch_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">peft_config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_virtual_tokens</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">peft_config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_layers </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> ,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">peft_config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_attention_heads</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">peft_config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">token_dim </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">//</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> peft_config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_attention_heads</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"># prefix encoderç±»çš„å®šä¹‰</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994"> PrefixEncoder</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> (</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">Module</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">"""</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">The torch.nn model to encode the prefix Input shape: (batch-size, prefix-length) Output shape: (batch-size, prefix-length, 2*layers*hidden) </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">"""</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> __init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> ChatGLMConfig </span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965">super</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> ().</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965">__init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">prefix_projection </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">prefix_projection</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"># self.prefix_projection=True-->prefix tuning</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"># self.prefix_projection=False-->p-tuning v2</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">if</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">prefix_projection</span><span style="--shiki-light:#999999;--shiki-dark:#666666">:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"># Use a two-layer MLP to encode the prefix</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">kv_size </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_layers </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">kv_channels </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">multi_query_group_num </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91"> 2</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">embedding </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Embedding</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">pre_seq_len</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> kv_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">trans </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Sequential</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">kv_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">hidden_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666">),</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Tanh</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(),</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">hidden_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> kv_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">else</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> :</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">embedding </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Embedding</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">pre_seq_len</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_layers </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">kv_channels </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> config</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">multi_query_group_num </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> )</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665"> forward</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Tensor </span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">if</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">prefix_projection</span><span style="--shiki-light:#999999;--shiki-dark:#666666">:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">prefix_tokens </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">embedding</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">past_key_values </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">trans</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">prefix_tokens</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">else</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> :</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">past_key_values </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">embedding</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">return</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> past_key_values</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¸¸è§é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#å¸¸è§é”™è¯¯"><span>å¸¸è§é”™è¯¯</span></a></h2>
<blockquote>
<p>âš  ä½¿ç”¨ä¸åˆé€‚çš„æç¤ºé•¿åº¦å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ç¡®ä¿æ ¹æ®å…·ä½“ä»»åŠ¡è°ƒæ•´æç¤ºé•¿åº¦ã€‚</p>
</blockquote>
<h2 id="è¡ŒåŠ¨æ¸…å•" tabindex="-1"><a class="header-anchor" href="#è¡ŒåŠ¨æ¸…å•"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>
<ul>
<li>ç ”ç©¶å¦‚ä½•åœ¨ç°æœ‰é¡¹ç›®ä¸­é›†æˆ P-Tuning V2ã€‚</li>
<li>é’ˆå¯¹ç‰¹å®šä»»åŠ¡æµ‹è¯•ä¸åŒçš„æç¤ºé•¿åº¦ã€‚</li>
<li>æ¢ç´¢å¤šä»»åŠ¡å­¦ä¹ åœ¨å…¶ä»–é¢†åŸŸçš„åº”ç”¨æ½œåŠ›ã€‚</li>
</ul>
<blockquote>
<p>æ¥æºï¼šæœ¬æ–‡å†…å®¹æ¥æºäºå¯¹ P-Tuning V2 æŠ€æœ¯çš„æ€»ç»“ä¸åˆ†æã€‚</p>
</blockquote>
</div></template>


