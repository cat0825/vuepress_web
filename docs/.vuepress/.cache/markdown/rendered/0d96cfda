{"content":"<h2 id=\"元数据\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#元数据\"><span>元数据</span></a></h2>\n<p><strong>分类</strong>：机器学习/自然语言处理<br>\n<strong>标签</strong>：数据清洗、预训练、语言模型、数据质量<br>\n<strong>日期</strong>：2023年10月25日</p>\n<hr>\n<h2 id=\"核心观点总结\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#核心观点总结\"><span>核心观点总结</span></a></h2>\n<p>数据清洗是预训练模型构建过程中最重要的环节之一，数据的质量和多样性直接影响模型的通用能力与性能。本篇内容详细介绍了数据清洗的关键步骤，包括URL过滤、内容提取、语言识别及低质内容过滤，并分享了相关技术实现与注意事项。</p>\n<hr>\n<h2 id=\"重点内容提取\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#重点内容提取\"><span>重点内容提取</span></a></h2>\n<h3 id=\"url-过滤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#url-过滤\"><span>URL 过滤</span></a></h3>\n<p>通过制定URL黑名单（如成人网站）和计算URL分数来筛选内容。此外，为了避免模型过于依赖某些特定数据源，像Arxiv和WikiPedia等精心构建的数据集内容也会被过滤。</p>\n<p>💡 <strong>启发点</strong>：避免模型对单一来源的过度依赖，可以提升模型的泛化能力。</p>\n<hr>\n<h3 id=\"内容提取\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#内容提取\"><span>内容提取</span></a></h3>\n<p>在获取到已过滤的URL后，需进一步提取有效文本信息，去除目录、标题、广告等无关内容。<br>\n推荐工具：<code v-pre>trafilatura</code>库，用于高效抓取网页内容。</p>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 示例代码：使用trafilatura抓取网页内容</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> trafilatura</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">url </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">https://example.com</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">downloaded </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> trafilatura</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fetch_url</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">url</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> trafilatura</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">extract</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">downloaded</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>⚠ <strong>注意</strong>：确保抓取内容时合法合规，避免侵犯版权。</p>\n<hr>\n<h3 id=\"语言识别\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#语言识别\"><span>语言识别</span></a></h3>\n<p>使用<code v-pre>FastText</code>或<code v-pre>langid</code>工具进行语言检测，将语言阈值分数低于0.65的文章剔除，以确保数据集中语言一致性。</p>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 核心代码示例：基于FastText的语言识别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> compute_stats_single</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    text </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text_key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lower</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">replace</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\n</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    ft_model </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> get_model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">model_key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ft_model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">predict</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    lang_id </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">replace</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">__label__</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    lang_score </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Fields</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">StatsKeys</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lang</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lang_id</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Fields</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">StatsKeys</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lang_score</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lang_score</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sample</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><hr>\n<h3 id=\"低质内容过滤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#低质内容过滤\"><span>低质内容过滤</span></a></h3>\n<ol>\n<li>\n<p><strong>篇章级别过滤</strong></p>\n<ul>\n<li>去除重复段落或包含错误信息（如抓取超时）的文章。</li>\n<li>根据文章长度、标点符号比例等标准筛选不正规文章。</li>\n</ul>\n</li>\n<li>\n<p><strong>句子级别过滤</strong></p>\n<ul>\n<li>删除由纯大写字符或纯数字组成的句子。</li>\n<li>丢弃命中特定关键词（如“关注”“转发”“点赞”）的句子。</li>\n<li>过滤掉长度小于10且符合特定模板（如以“登录”开头或以“展开”结尾）的句子。</li>\n</ul>\n</li>\n</ol>\n<p>💡 <strong>启发点</strong>：利用启发式规则进行数据清洗，可以显著提升数据质量。</p>\n<hr>\n<h2 id=\"常见错误警告\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误警告\"><span>常见错误警告</span></a></h2>\n<blockquote>\n<p><strong>⚠ 数据清洗易犯错误：</strong></p>\n<ol>\n<li>过度过滤导致数据量不足，影响模型训练效果。</li>\n<li>未充分考虑多语言数据的多样性，可能导致模型表现偏向某些语言。</li>\n<li>忽略版权或数据合法性问题，可能引发法律风险。</li>\n</ol>\n</blockquote>\n<hr>\n<h2 id=\"行动清单\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#行动清单\"><span>行动清单</span></a></h2>\n<ol>\n<li>熟悉并实践<code v-pre>trafilatura</code>库的网页内容抓取功能。</li>\n<li>学习FastText和langid工具的语言识别实现。</li>\n<li>根据本指南设计并优化自己的数据清洗Pipeline。</li>\n</ol>\n<hr>\n<h2 id=\"📈-趋势预测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#📈-趋势预测\"><span>📈 趋势预测</span></a></h2>\n<p>随着大规模语言模型的普及，数据清洗技术将更加关注以下方向：</p>\n<ul>\n<li>更智能的自动化过滤工具，如结合深度学习的内容分类器。</li>\n<li>跨领域数据质量标准化，确保多样性与公平性。</li>\n<li>更高效的多语言支持，特别是低资源语言的数据增强。</li>\n</ul>\n<hr>\n<h2 id=\"思考-板块\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#思考-板块\"><span>[思考]板块</span></a></h2>\n<ol>\n<li>数据清洗中如何平衡“数据量”和“数据质量”之间的矛盾？</li>\n<li>是否可以通过生成式AI辅助生成高质量数据以弥补清洗后的数据缺失？</li>\n<li>对于低资源语言，是否需要不同于主流语言的数据清洗策略？</li>\n</ol>\n<hr>\n<blockquote>\n<p><strong>原始出处</strong>：深度学习技术报告及相关文档（如DeepSeek-Math技术报告）\n[[大语言模型学习/Pre-training 预训练/模型打分与数据去重|模型打分与数据去重]]</p>\n</blockquote>\n","env":{"base":"/","filePath":"/Users/qianyuhe/Desktop/my-project/docs/notes_bak/大语言模型学习/Pre-training 预训练/数据清洗 2.md","filePathRelative":"notes_bak/大语言模型学习/Pre-training 预训练/数据清洗 2.md","frontmatter":{"dg-publish":true,"dg-permalink":"/大语言模型学习/Pre-training-预训练/数据清洗","dg-home":false,"dg-description":"在此输入笔记的描述","dg-hide":false,"dg-hide-title":false,"dg-show-backlinks":true,"dg-show-local-graph":true,"dg-show-inline-title":true,"dg-pinned":false,"dg-passphrase":"在此输入访问密码","dg-enable-mathjax":false,"dg-enable-mermaid":false,"dg-enable-uml":false,"dg-note-icon":0,"dg-enable-dataview":false,"tags":["NLP"],"permalink":"/大语言模型学习/Pre-training-预训练/数据清洗/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true,"dgPassFrontmatter":true,"noteIcon":0,"created":"2025-04-08T04:10:33.000Z","updated":"2025-04-13T05:06:02.000Z","title":"数据清洗","createTime":"2025/05/13 17:33:53"},"sfcBlocks":{"template":{"type":"template","content":"<template><h2 id=\"元数据\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#元数据\"><span>元数据</span></a></h2>\n<p><strong>分类</strong>：机器学习/自然语言处理<br>\n<strong>标签</strong>：数据清洗、预训练、语言模型、数据质量<br>\n<strong>日期</strong>：2023年10月25日</p>\n<hr>\n<h2 id=\"核心观点总结\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#核心观点总结\"><span>核心观点总结</span></a></h2>\n<p>数据清洗是预训练模型构建过程中最重要的环节之一，数据的质量和多样性直接影响模型的通用能力与性能。本篇内容详细介绍了数据清洗的关键步骤，包括URL过滤、内容提取、语言识别及低质内容过滤，并分享了相关技术实现与注意事项。</p>\n<hr>\n<h2 id=\"重点内容提取\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#重点内容提取\"><span>重点内容提取</span></a></h2>\n<h3 id=\"url-过滤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#url-过滤\"><span>URL 过滤</span></a></h3>\n<p>通过制定URL黑名单（如成人网站）和计算URL分数来筛选内容。此外，为了避免模型过于依赖某些特定数据源，像Arxiv和WikiPedia等精心构建的数据集内容也会被过滤。</p>\n<p>💡 <strong>启发点</strong>：避免模型对单一来源的过度依赖，可以提升模型的泛化能力。</p>\n<hr>\n<h3 id=\"内容提取\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#内容提取\"><span>内容提取</span></a></h3>\n<p>在获取到已过滤的URL后，需进一步提取有效文本信息，去除目录、标题、广告等无关内容。<br>\n推荐工具：<code v-pre>trafilatura</code>库，用于高效抓取网页内容。</p>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 示例代码：使用trafilatura抓取网页内容</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> trafilatura</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">url </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">https://example.com</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">downloaded </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> trafilatura</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fetch_url</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">url</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> trafilatura</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">extract</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">downloaded</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>⚠ <strong>注意</strong>：确保抓取内容时合法合规，避免侵犯版权。</p>\n<hr>\n<h3 id=\"语言识别\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#语言识别\"><span>语言识别</span></a></h3>\n<p>使用<code v-pre>FastText</code>或<code v-pre>langid</code>工具进行语言检测，将语言阈值分数低于0.65的文章剔除，以确保数据集中语言一致性。</p>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 核心代码示例：基于FastText的语言识别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> compute_stats_single</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    text </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text_key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lower</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">replace</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\n</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    ft_model </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> get_model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">model_key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ft_model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">predict</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    lang_id </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">replace</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">__label__</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    lang_score </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Fields</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">StatsKeys</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lang</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lang_id</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Fields</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">StatsKeys</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lang_score</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lang_score</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sample</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><hr>\n<h3 id=\"低质内容过滤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#低质内容过滤\"><span>低质内容过滤</span></a></h3>\n<ol>\n<li>\n<p><strong>篇章级别过滤</strong></p>\n<ul>\n<li>去除重复段落或包含错误信息（如抓取超时）的文章。</li>\n<li>根据文章长度、标点符号比例等标准筛选不正规文章。</li>\n</ul>\n</li>\n<li>\n<p><strong>句子级别过滤</strong></p>\n<ul>\n<li>删除由纯大写字符或纯数字组成的句子。</li>\n<li>丢弃命中特定关键词（如“关注”“转发”“点赞”）的句子。</li>\n<li>过滤掉长度小于10且符合特定模板（如以“登录”开头或以“展开”结尾）的句子。</li>\n</ul>\n</li>\n</ol>\n<p>💡 <strong>启发点</strong>：利用启发式规则进行数据清洗，可以显著提升数据质量。</p>\n<hr>\n<h2 id=\"常见错误警告\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误警告\"><span>常见错误警告</span></a></h2>\n<blockquote>\n<p><strong>⚠ 数据清洗易犯错误：</strong></p>\n<ol>\n<li>过度过滤导致数据量不足，影响模型训练效果。</li>\n<li>未充分考虑多语言数据的多样性，可能导致模型表现偏向某些语言。</li>\n<li>忽略版权或数据合法性问题，可能引发法律风险。</li>\n</ol>\n</blockquote>\n<hr>\n<h2 id=\"行动清单\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#行动清单\"><span>行动清单</span></a></h2>\n<ol>\n<li>熟悉并实践<code v-pre>trafilatura</code>库的网页内容抓取功能。</li>\n<li>学习FastText和langid工具的语言识别实现。</li>\n<li>根据本指南设计并优化自己的数据清洗Pipeline。</li>\n</ol>\n<hr>\n<h2 id=\"📈-趋势预测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#📈-趋势预测\"><span>📈 趋势预测</span></a></h2>\n<p>随着大规模语言模型的普及，数据清洗技术将更加关注以下方向：</p>\n<ul>\n<li>更智能的自动化过滤工具，如结合深度学习的内容分类器。</li>\n<li>跨领域数据质量标准化，确保多样性与公平性。</li>\n<li>更高效的多语言支持，特别是低资源语言的数据增强。</li>\n</ul>\n<hr>\n<h2 id=\"思考-板块\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#思考-板块\"><span>[思考]板块</span></a></h2>\n<ol>\n<li>数据清洗中如何平衡“数据量”和“数据质量”之间的矛盾？</li>\n<li>是否可以通过生成式AI辅助生成高质量数据以弥补清洗后的数据缺失？</li>\n<li>对于低资源语言，是否需要不同于主流语言的数据清洗策略？</li>\n</ol>\n<hr>\n<blockquote>\n<p><strong>原始出处</strong>：深度学习技术报告及相关文档（如DeepSeek-Math技术报告）\n[[大语言模型学习/Pre-training 预训练/模型打分与数据去重|模型打分与数据去重]]</p>\n</blockquote>\n</template>","contentStripped":"<h2 id=\"元数据\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#元数据\"><span>元数据</span></a></h2>\n<p><strong>分类</strong>：机器学习/自然语言处理<br>\n<strong>标签</strong>：数据清洗、预训练、语言模型、数据质量<br>\n<strong>日期</strong>：2023年10月25日</p>\n<hr>\n<h2 id=\"核心观点总结\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#核心观点总结\"><span>核心观点总结</span></a></h2>\n<p>数据清洗是预训练模型构建过程中最重要的环节之一，数据的质量和多样性直接影响模型的通用能力与性能。本篇内容详细介绍了数据清洗的关键步骤，包括URL过滤、内容提取、语言识别及低质内容过滤，并分享了相关技术实现与注意事项。</p>\n<hr>\n<h2 id=\"重点内容提取\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#重点内容提取\"><span>重点内容提取</span></a></h2>\n<h3 id=\"url-过滤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#url-过滤\"><span>URL 过滤</span></a></h3>\n<p>通过制定URL黑名单（如成人网站）和计算URL分数来筛选内容。此外，为了避免模型过于依赖某些特定数据源，像Arxiv和WikiPedia等精心构建的数据集内容也会被过滤。</p>\n<p>💡 <strong>启发点</strong>：避免模型对单一来源的过度依赖，可以提升模型的泛化能力。</p>\n<hr>\n<h3 id=\"内容提取\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#内容提取\"><span>内容提取</span></a></h3>\n<p>在获取到已过滤的URL后，需进一步提取有效文本信息，去除目录、标题、广告等无关内容。<br>\n推荐工具：<code v-pre>trafilatura</code>库，用于高效抓取网页内容。</p>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 示例代码：使用trafilatura抓取网页内容</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> trafilatura</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">url </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">https://example.com</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">downloaded </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> trafilatura</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fetch_url</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">url</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> trafilatura</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">extract</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">downloaded</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>⚠ <strong>注意</strong>：确保抓取内容时合法合规，避免侵犯版权。</p>\n<hr>\n<h3 id=\"语言识别\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#语言识别\"><span>语言识别</span></a></h3>\n<p>使用<code v-pre>FastText</code>或<code v-pre>langid</code>工具进行语言检测，将语言阈值分数低于0.65的文章剔除，以确保数据集中语言一致性。</p>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 核心代码示例：基于FastText的语言识别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> compute_stats_single</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    text </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text_key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lower</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">replace</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">\\n</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    ft_model </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> get_model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">model_key</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ft_model</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">predict</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">text</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    lang_id </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">replace</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">__label__</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    lang_score </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Fields</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">StatsKeys</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lang</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lang_id</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Fields</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">][</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">StatsKeys</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lang_score</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lang_score</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sample</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><hr>\n<h3 id=\"低质内容过滤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#低质内容过滤\"><span>低质内容过滤</span></a></h3>\n<ol>\n<li>\n<p><strong>篇章级别过滤</strong></p>\n<ul>\n<li>去除重复段落或包含错误信息（如抓取超时）的文章。</li>\n<li>根据文章长度、标点符号比例等标准筛选不正规文章。</li>\n</ul>\n</li>\n<li>\n<p><strong>句子级别过滤</strong></p>\n<ul>\n<li>删除由纯大写字符或纯数字组成的句子。</li>\n<li>丢弃命中特定关键词（如“关注”“转发”“点赞”）的句子。</li>\n<li>过滤掉长度小于10且符合特定模板（如以“登录”开头或以“展开”结尾）的句子。</li>\n</ul>\n</li>\n</ol>\n<p>💡 <strong>启发点</strong>：利用启发式规则进行数据清洗，可以显著提升数据质量。</p>\n<hr>\n<h2 id=\"常见错误警告\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误警告\"><span>常见错误警告</span></a></h2>\n<blockquote>\n<p><strong>⚠ 数据清洗易犯错误：</strong></p>\n<ol>\n<li>过度过滤导致数据量不足，影响模型训练效果。</li>\n<li>未充分考虑多语言数据的多样性，可能导致模型表现偏向某些语言。</li>\n<li>忽略版权或数据合法性问题，可能引发法律风险。</li>\n</ol>\n</blockquote>\n<hr>\n<h2 id=\"行动清单\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#行动清单\"><span>行动清单</span></a></h2>\n<ol>\n<li>熟悉并实践<code v-pre>trafilatura</code>库的网页内容抓取功能。</li>\n<li>学习FastText和langid工具的语言识别实现。</li>\n<li>根据本指南设计并优化自己的数据清洗Pipeline。</li>\n</ol>\n<hr>\n<h2 id=\"📈-趋势预测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#📈-趋势预测\"><span>📈 趋势预测</span></a></h2>\n<p>随着大规模语言模型的普及，数据清洗技术将更加关注以下方向：</p>\n<ul>\n<li>更智能的自动化过滤工具，如结合深度学习的内容分类器。</li>\n<li>跨领域数据质量标准化，确保多样性与公平性。</li>\n<li>更高效的多语言支持，特别是低资源语言的数据增强。</li>\n</ul>\n<hr>\n<h2 id=\"思考-板块\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#思考-板块\"><span>[思考]板块</span></a></h2>\n<ol>\n<li>数据清洗中如何平衡“数据量”和“数据质量”之间的矛盾？</li>\n<li>是否可以通过生成式AI辅助生成高质量数据以弥补清洗后的数据缺失？</li>\n<li>对于低资源语言，是否需要不同于主流语言的数据清洗策略？</li>\n</ol>\n<hr>\n<blockquote>\n<p><strong>原始出处</strong>：深度学习技术报告及相关文档（如DeepSeek-Math技术报告）\n[[大语言模型学习/Pre-training 预训练/模型打分与数据去重|模型打分与数据去重]]</p>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"## 元数据\n**分类**：机器学习/自然语言处理  \n**标签**：数据清洗、预训练、语言模型、数据质量  \n**日期**：2023年10月25日  \n\n---\n\n\n\n## 核心观点总结\n数据清洗是预训练模型构建过程中最重要的环节之一，数据的质量和多样性直接影响模型的通用能力与性能。本篇内容详细介绍了数据清洗的关键步骤，包括URL过滤、内容提取、语言识别及低质内容过滤，并分享了相关技术实现与注意事项。\n\n---\n\n\n\n## 重点内容提取\n\n### URL 过滤\n通过制定URL黑名单（如成人网站）和计算URL分数来筛选内容。此外，为了避免模型过于依赖某些特定数据源，像Arxiv和WikiPedia等精心构建的数据集内容也会被过滤。\n\n💡 **启发点**：避免模型对单一来源的过度依赖，可以提升模型的泛化能力。\n\n---\n\n\n### 内容提取\n在获取到已过滤的URL后，需进一步提取有效文本信息，去除目录、标题、广告等无关内容。  \n推荐工具：`trafilatura`库，用于高效抓取网页内容。\n\n```python\n# 示例代码：使用trafilatura抓取网页内容\nimport trafilatura\n\nurl = 'https://example.com'\ndownloaded = trafilatura.fetch_url(url)\ntext = trafilatura.extract(downloaded)\nprint(text)\n```\n\n⚠ **注意**：确保抓取内容时合法合规，避免侵犯版权。\n\n---\n\n\n### 语言识别\n使用`FastText`或`langid`工具进行语言检测，将语言阈值分数低于0.65的文章剔除，以确保数据集中语言一致性。\n\n```python\n# 核心代码示例：基于FastText的语言识别\ndef compute_stats_single(self, sample):\n    text = sample[self.text_key].lower().replace('\\n', ' ')\n    ft_model = get_model(self.model_key)\n    pred = ft_model.predict(text)\n    lang_id = pred[0][0].replace('__label__', '')\n    lang_score = pred[1][0]\n    sample[Fields.stats][StatsKeys.lang] = lang_id\n    sample[Fields.stats][StatsKeys.lang_score] = lang_score\n    return sample\n```\n\n---\n\n\n### 低质内容过滤\n1. **篇章级别过滤**  \n   - 去除重复段落或包含错误信息（如抓取超时）的文章。  \n   - 根据文章长度、标点符号比例等标准筛选不正规文章。  \n\n2. **句子级别过滤**  \n   - 删除由纯大写字符或纯数字组成的句子。  \n   - 丢弃命中特定关键词（如“关注”“转发”“点赞”）的句子。  \n   - 过滤掉长度小于10且符合特定模板（如以“登录”开头或以“展开”结尾）的句子。  \n\n💡 **启发点**：利用启发式规则进行数据清洗，可以显著提升数据质量。\n\n---\n\n\n\n## 常见错误警告\n> **⚠ 数据清洗易犯错误：**\n> 1. 过度过滤导致数据量不足，影响模型训练效果。\n> 2. 未充分考虑多语言数据的多样性，可能导致模型表现偏向某些语言。\n> 3. 忽略版权或数据合法性问题，可能引发法律风险。\n\n---\n\n\n\n## 行动清单\n1. 熟悉并实践`trafilatura`库的网页内容抓取功能。\n2. 学习FastText和langid工具的语言识别实现。\n3. 根据本指南设计并优化自己的数据清洗Pipeline。\n\n---\n\n\n\n## 📈 趋势预测\n随着大规模语言模型的普及，数据清洗技术将更加关注以下方向：\n- 更智能的自动化过滤工具，如结合深度学习的内容分类器。\n- 跨领域数据质量标准化，确保多样性与公平性。\n- 更高效的多语言支持，特别是低资源语言的数据增强。\n\n---\n\n\n\n## [思考]板块\n1. 数据清洗中如何平衡“数据量”和“数据质量”之间的矛盾？  \n2. 是否可以通过生成式AI辅助生成高质量数据以弥补清洗后的数据缺失？  \n3. 对于低资源语言，是否需要不同于主流语言的数据清洗策略？\n\n---\n\n> **原始出处**：深度学习技术报告及相关文档（如DeepSeek-Math技术报告）\n>[[大语言模型学习/Pre-training 预训练/模型打分与数据去重\\|模型打分与数据去重]]","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":2,"title":"元数据","slug":"元数据","link":"#元数据","children":[]},{"level":2,"title":"核心观点总结","slug":"核心观点总结","link":"#核心观点总结","children":[]},{"level":2,"title":"重点内容提取","slug":"重点内容提取","link":"#重点内容提取","children":[{"level":3,"title":"URL 过滤","slug":"url-过滤","link":"#url-过滤","children":[]},{"level":3,"title":"内容提取","slug":"内容提取","link":"#内容提取","children":[]},{"level":3,"title":"语言识别","slug":"语言识别","link":"#语言识别","children":[]},{"level":3,"title":"低质内容过滤","slug":"低质内容过滤","link":"#低质内容过滤","children":[]}]},{"level":2,"title":"常见错误警告","slug":"常见错误警告","link":"#常见错误警告","children":[]},{"level":2,"title":"行动清单","slug":"行动清单","link":"#行动清单","children":[]},{"level":2,"title":"📈 趋势预测","slug":"📈-趋势预测","link":"#📈-趋势预测","children":[]},{"level":2,"title":"[思考]板块","slug":"思考-板块","link":"#思考-板块","children":[]}]}}
