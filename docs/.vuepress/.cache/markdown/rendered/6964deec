{"content":"<p><strong>åˆ†ç±»</strong>ï¼šè‡ªç„¶è¯­è¨€å¤„ç†<br>\n<strong>æ ‡ç­¾</strong>ï¼šè§£ç ç­–ç•¥ã€å¤§æ¨¡å‹ç”Ÿæˆã€Beam Search<br>\n<strong>æ—¥æœŸ</strong>ï¼š2025å¹´4æœˆ1æ—¥</p>\n<hr>\n<h2 id=\"æ ¸å¿ƒè§‚ç‚¹æ€»ç»“\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒè§‚ç‚¹æ€»ç»“\"><span>æ ¸å¿ƒè§‚ç‚¹æ€»ç»“</span></a></h2>\n<p>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸï¼Œå¤§æ¨¡å‹ç”Ÿæˆæ–‡æœ¬æ—¶éœ€è¦é€‰æ‹©è§£ç ç­–ç•¥ä»¥ç¡®ä¿ç”Ÿæˆçš„è´¨é‡å’Œå¤šæ ·æ€§ã€‚æœ¬æ–‡ä¸»è¦æ¢è®¨äº†ä¸¤ç§ä¸»æµè§£ç ç­–ç•¥â€”â€”Greedy Searchå’ŒBeam Searchï¼Œå¹¶é€šè¿‡ä»£ç ç¤ºä¾‹å±•ç¤ºäº†Beam Searchçš„å…·ä½“å®ç°ç»†èŠ‚ã€‚</p>\n<ul>\n<li><strong>Greedy Search</strong>ï¼šæ¯æ¬¡é€‰æ‹©æ¦‚ç‡æœ€å¤§çš„è¯ï¼Œç®€å•ä½†å¯èƒ½å¯¼è‡´ç”Ÿæˆç»“æœå•è°ƒé‡å¤ã€‚</li>\n<li><strong>Beam Search</strong>ï¼šç»´æŠ¤å¤šä¸ªå€™é€‰åºåˆ—ï¼Œé€šè¿‡æ¦‚ç‡å¹³è¡¡è´¨é‡ä¸å¤šæ ·æ€§ï¼Œä½†å¯èƒ½æ˜¾å¾—ä¿å®ˆã€‚</li>\n</ul>\n<hr>\n<h2 id=\"è§£ç ç­–ç•¥è¯¦è§£\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è§£ç ç­–ç•¥è¯¦è§£\"><span>è§£ç ç­–ç•¥è¯¦è§£</span></a></h2>\n<h3 id=\"greedy-search\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#greedy-search\"><span>Greedy Search</span></a></h3>\n<ul>\n<li><strong>ç‰¹ç‚¹</strong>ï¼š<br>\nâœ… æ¯æ¬¡é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„è¯<br>\nâš  ç®€å•é«˜æ•ˆï¼Œä½†å¯èƒ½ç”Ÿæˆå•è°ƒã€é‡å¤çš„æ–‡æœ¬</li>\n</ul>\n<p>ğŸ’¡ <strong>å¯å‘ç‚¹</strong>ï¼šé€‚åˆç®€å•ä»»åŠ¡ï¼Œä½†å¯¹å¤æ‚ç”Ÿæˆä»»åŠ¡æ•ˆæœæ¬ ä½³ã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250407180111.png\" alt=\"Pasted image 20250407180111.png\"></p>\n<hr>\n<h3 id=\"beam-search\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#beam-search\"><span>Beam Search</span></a></h3>\n<ul>\n<li>\n<p><strong>æ ¸å¿ƒæœºåˆ¶</strong>ï¼š\nâœ… ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º $$k$$ çš„å€™é€‰åºåˆ—é›†åˆ<br>\nâœ… æ¯ä¸€æ­¥ä»æ¯ä¸ªå€™é€‰åºåˆ—çš„æ¦‚ç‡åˆ†å¸ƒä¸­é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„ $$k$$ ä¸ªè¯<br>\nâœ… ä¿ç•™æ€»æ¦‚ç‡æœ€é«˜çš„ $$k$$ ä¸ªå€™é€‰åºåˆ—</p>\n</li>\n<li>\n<p><strong>ä»£ç å®ç°</strong>ï¼š</p>\n</li>\n</ul>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> process</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    batch_size </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    group_size </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    next_beam_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    next_beam_tokens </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    next_beam_indices </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> batch_idx </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        beam_idx </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_token_rank</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_token</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_score</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_index</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> enumerate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">            zip</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            batch_beam_idx </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> batch_idx </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_index</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            next_beam_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_score</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            next_beam_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_token</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            next_beam_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> batch_beam_idx</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            beam_idx </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">+=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_beam_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">view</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_beam_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">view</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_beam_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">view</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ç¤ºä¾‹è°ƒç”¨</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randint</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_search</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> max_length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>ğŸ’¡ <strong>å¯å‘ç‚¹</strong>ï¼šé€šè¿‡ç»´æŠ¤å¤šä¸ªå€™é€‰åºåˆ—ï¼ŒBeam Searchèƒ½æœ‰æ•ˆæå‡ç”Ÿæˆè´¨é‡ï¼Œä½†ä»£ä»·æ˜¯è®¡ç®—å¤æ‚åº¦æ›´é«˜ã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250407180124.png\" alt=\"Pasted image 20250407180124.png\"></p>\n<hr>\n<h2 id=\"å¸¸è§é”™è¯¯è­¦å‘Š\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯è­¦å‘Š\"><span>å¸¸è§é”™è¯¯è­¦å‘Š</span></a></h2>\n<p>âš  <strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>\n<ol>\n<li>Beamå¤§å°ï¼ˆ$$k$$ï¼‰è¿‡å°å¯èƒ½å¯¼è‡´ç”Ÿæˆç»“æœè´¨é‡ä¸‹é™ï¼›è¿‡å¤§åˆ™å¢åŠ è®¡ç®—æˆæœ¬ã€‚</li>\n<li>Beam Searchå¯èƒ½è¿‡äºä¿å®ˆï¼Œå¯¼è‡´ç¼ºä¹åˆ›é€ æ€§ç”Ÿæˆã€‚</li>\n</ol>\n<hr>\n<h2 id=\"æ•°æ®ä¸å…¬å¼\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®ä¸å…¬å¼\"><span>æ•°æ®ä¸å…¬å¼</span></a></h2>\n<h3 id=\"æ•°æ®è¡¨æ ¼ç¤ºä¾‹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è¡¨æ ¼ç¤ºä¾‹\"><span>æ•°æ®è¡¨æ ¼ç¤ºä¾‹</span></a></h3>\n<table>\n<thead>\n<tr>\n<th>è§£ç ç­–ç•¥</th>\n<th>ä¼˜åŠ¿</th>\n<th>åŠ£åŠ¿</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Greedy Search</td>\n<td>ç®€å•é«˜æ•ˆ</td>\n<td>å•è°ƒã€é‡å¤</td>\n</tr>\n<tr>\n<td>Beam Search</td>\n<td>å¹³è¡¡è´¨é‡ä¸å¤šæ ·æ€§</td>\n<td>ä¿å®ˆã€ä¸è‡ªç„¶</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å…¬å¼ç¤ºä¾‹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…¬å¼ç¤ºä¾‹\"><span>å…¬å¼ç¤ºä¾‹</span></a></h3>\n<p>Beam Searchæ ¸å¿ƒå…¬å¼ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>Next_Token_Scores</mtext><mo>=</mo><msub><mtext>Top</mtext><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mtext>ProbabilityÂ Distribution</mtext><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\text{Next\\_Token\\_Scores} = \\text{Top}_k(\\text{Probability Distribution})\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0044em;vertical-align:-0.31em;\"></span><span class=\"mord text\"><span class=\"mord\">Next_Token_Scores</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Top</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.242em;\"><span style=\"top:-2.4559em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2441em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord\">ProbabilityÂ Distribution</span></span><span class=\"mclose\">)</span></span></span></span></span></p>\n<hr>\n<h2 id=\"æ€è€ƒ-å»¶ä¼¸é—®é¢˜\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ€è€ƒ-å»¶ä¼¸é—®é¢˜\"><span>[æ€è€ƒ] å»¶ä¼¸é—®é¢˜</span></a></h2>\n<ol>\n<li>å¦‚ä½•ç»“åˆä¸¤ç§è§£ç ç­–ç•¥ï¼Œè®¾è®¡å‡ºæ—¢é«˜æ•ˆåˆå¤šæ ·åŒ–çš„ç”Ÿæˆç®—æ³•ï¼Ÿ</li>\n<li>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ˜¯å¦å¯ä»¥åŠ¨æ€è°ƒæ•´Beamå¤§å°ä»¥é€‚é…ä¸åŒä»»åŠ¡ï¼Ÿ</li>\n<li>æ˜¯å¦æœ‰æ›´å…ˆè¿›çš„è§£ç ç­–ç•¥èƒ½è§£å†³Beam Searchçš„ä¿å®ˆé—®é¢˜ï¼Ÿ</li>\n</ol>\n<hr>\n<blockquote>\n<p><strong>æ¥æº</strong>ï¼šæ•´ç†è‡ªè‡ªç„¶è¯­è¨€å¤„ç†ç›¸å…³æŠ€æœ¯æ–‡æ¡£ä¸ä»£ç ç¤ºä¾‹ã€‚</p>\n</blockquote>\n<hr>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ol>\n<li>å®ç°Greedy Searchå’ŒBeam Searchçš„ä»£ç å¹¶æµ‹è¯•ä¸åŒå‚æ•°å¯¹ç”Ÿæˆæ•ˆæœçš„å½±å“ã€‚</li>\n<li>é˜…è¯»ç›¸å…³è®ºæ–‡ï¼Œæ¢ç´¢æ”¹è¿›Beam Searchçš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¾‹å¦‚Top-pæˆ–Top-ké‡‡æ ·ã€‚</li>\n<li>åº”ç”¨ä¸Šè¿°è§£ç ç­–ç•¥äºå®é™…é¡¹ç›®ï¼Œè¯„ä¼°å…¶æ€§èƒ½å’Œç”Ÿæˆè´¨é‡ã€‚</li>\n</ol>\n<hr>\n<p>ğŸ“ˆ <strong>è¶‹åŠ¿é¢„æµ‹</strong><br>\næœªæ¥è§£ç ç­–ç•¥å°†æ›´æ³¨é‡ç»“åˆæ¦‚ç‡åˆ†å¸ƒä¸ä¸Šä¸‹æ–‡è¯­ä¹‰ï¼Œåˆ©ç”¨åŠ¨æ€è°ƒæ•´æœºåˆ¶æå‡ç”Ÿæˆæ•ˆæœï¼ŒåŒæ—¶å‡å°‘è®¡ç®—å¼€é”€ã€‚</p>\n<hr>\n<h2 id=\"åç»­è¿½è¸ª\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åç»­è¿½è¸ª\"><span>åç»­è¿½è¸ª</span></a></h2>\n<ul>\n<li>ç ”ç©¶Top-pé‡‡æ ·å’Œæ¸©åº¦è°ƒèŠ‚å¯¹ç”Ÿæˆè´¨é‡çš„å½±å“ã€‚</li>\n<li>æ¢ç´¢åŸºäºå¼ºåŒ–å­¦ä¹ ä¼˜åŒ–è§£ç ç­–ç•¥çš„æ–°æ–¹æ³•ã€‚</li>\n</ul>\n","env":{"base":"/","filePath":"/Users/qianyuhe/Desktop/my-project/docs/notes_bak/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Structure & Decoding Policy ç»“æ„å’Œè§£ç ç­–ç•¥/è§£ç é‡‡æ ·ç­–ç•¥ï¼šGreedy Searchä¸Beam Searchçš„å®ç°ä¸ä¼˜åŒ–.md","filePathRelative":"notes_bak/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Structure & Decoding Policy ç»“æ„å’Œè§£ç ç­–ç•¥/è§£ç é‡‡æ ·ç­–ç•¥ï¼šGreedy Searchä¸Beam Searchçš„å®ç°ä¸ä¼˜åŒ–.md","frontmatter":{"dg-publish":true,"dg-permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Structure-&-Decoding-Policy-ç»“æ„å’Œè§£ç ç­–ç•¥/è§£ç é‡‡æ ·ç­–ç•¥ï¼šGreedy-Searchä¸Beam-Searchçš„å®ç°ä¸ä¼˜åŒ–","dg-home":false,"dg-description":"åœ¨æ­¤è¾“å…¥ç¬”è®°çš„æè¿°","dg-hide":false,"dg-hide-title":false,"dg-show-backlinks":true,"dg-show-local-graph":true,"dg-show-inline-title":true,"dg-pinned":false,"dg-passphrase":"åœ¨æ­¤è¾“å…¥è®¿é—®å¯†ç ","dg-enable-mathjax":false,"dg-enable-mermaid":false,"dg-enable-uml":false,"dg-note-icon":0,"dg-enable-dataview":false,"tags":["NLP"],"permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Structure-&-Decoding-Policy-ç»“æ„å’Œè§£ç ç­–ç•¥/è§£ç é‡‡æ ·ç­–ç•¥ï¼šGreedy-Searchä¸Beam-Searchçš„å®ç°ä¸ä¼˜åŒ–/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true,"dgPassFrontmatter":true,"noteIcon":0,"created":"2025-04-07T10:00:51.000Z","updated":"2025-04-13T05:06:02.000Z","title":"è§£ç é‡‡æ ·ç­–ç•¥ï¼šGreedy Searchä¸Beam Searchçš„å®ç°ä¸ä¼˜åŒ–","createTime":"2025/05/13 17:33:52"},"sfcBlocks":{"template":{"type":"template","content":"<template><p><strong>åˆ†ç±»</strong>ï¼šè‡ªç„¶è¯­è¨€å¤„ç†<br>\n<strong>æ ‡ç­¾</strong>ï¼šè§£ç ç­–ç•¥ã€å¤§æ¨¡å‹ç”Ÿæˆã€Beam Search<br>\n<strong>æ—¥æœŸ</strong>ï¼š2025å¹´4æœˆ1æ—¥</p>\n<hr>\n<h2 id=\"æ ¸å¿ƒè§‚ç‚¹æ€»ç»“\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒè§‚ç‚¹æ€»ç»“\"><span>æ ¸å¿ƒè§‚ç‚¹æ€»ç»“</span></a></h2>\n<p>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸï¼Œå¤§æ¨¡å‹ç”Ÿæˆæ–‡æœ¬æ—¶éœ€è¦é€‰æ‹©è§£ç ç­–ç•¥ä»¥ç¡®ä¿ç”Ÿæˆçš„è´¨é‡å’Œå¤šæ ·æ€§ã€‚æœ¬æ–‡ä¸»è¦æ¢è®¨äº†ä¸¤ç§ä¸»æµè§£ç ç­–ç•¥â€”â€”Greedy Searchå’ŒBeam Searchï¼Œå¹¶é€šè¿‡ä»£ç ç¤ºä¾‹å±•ç¤ºäº†Beam Searchçš„å…·ä½“å®ç°ç»†èŠ‚ã€‚</p>\n<ul>\n<li><strong>Greedy Search</strong>ï¼šæ¯æ¬¡é€‰æ‹©æ¦‚ç‡æœ€å¤§çš„è¯ï¼Œç®€å•ä½†å¯èƒ½å¯¼è‡´ç”Ÿæˆç»“æœå•è°ƒé‡å¤ã€‚</li>\n<li><strong>Beam Search</strong>ï¼šç»´æŠ¤å¤šä¸ªå€™é€‰åºåˆ—ï¼Œé€šè¿‡æ¦‚ç‡å¹³è¡¡è´¨é‡ä¸å¤šæ ·æ€§ï¼Œä½†å¯èƒ½æ˜¾å¾—ä¿å®ˆã€‚</li>\n</ul>\n<hr>\n<h2 id=\"è§£ç ç­–ç•¥è¯¦è§£\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è§£ç ç­–ç•¥è¯¦è§£\"><span>è§£ç ç­–ç•¥è¯¦è§£</span></a></h2>\n<h3 id=\"greedy-search\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#greedy-search\"><span>Greedy Search</span></a></h3>\n<ul>\n<li><strong>ç‰¹ç‚¹</strong>ï¼š<br>\nâœ… æ¯æ¬¡é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„è¯<br>\nâš  ç®€å•é«˜æ•ˆï¼Œä½†å¯èƒ½ç”Ÿæˆå•è°ƒã€é‡å¤çš„æ–‡æœ¬</li>\n</ul>\n<p>ğŸ’¡ <strong>å¯å‘ç‚¹</strong>ï¼šé€‚åˆç®€å•ä»»åŠ¡ï¼Œä½†å¯¹å¤æ‚ç”Ÿæˆä»»åŠ¡æ•ˆæœæ¬ ä½³ã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250407180111.png\" alt=\"Pasted image 20250407180111.png\"></p>\n<hr>\n<h3 id=\"beam-search\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#beam-search\"><span>Beam Search</span></a></h3>\n<ul>\n<li>\n<p><strong>æ ¸å¿ƒæœºåˆ¶</strong>ï¼š\nâœ… ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º $$k$$ çš„å€™é€‰åºåˆ—é›†åˆ<br>\nâœ… æ¯ä¸€æ­¥ä»æ¯ä¸ªå€™é€‰åºåˆ—çš„æ¦‚ç‡åˆ†å¸ƒä¸­é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„ $$k$$ ä¸ªè¯<br>\nâœ… ä¿ç•™æ€»æ¦‚ç‡æœ€é«˜çš„ $$k$$ ä¸ªå€™é€‰åºåˆ—</p>\n</li>\n<li>\n<p><strong>ä»£ç å®ç°</strong>ï¼š</p>\n</li>\n</ul>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> process</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    batch_size </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    group_size </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    next_beam_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    next_beam_tokens </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    next_beam_indices </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> batch_idx </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        beam_idx </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_token_rank</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_token</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_score</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_index</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> enumerate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">            zip</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            batch_beam_idx </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> batch_idx </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_index</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            next_beam_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_score</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            next_beam_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_token</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            next_beam_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> batch_beam_idx</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            beam_idx </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">+=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_beam_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">view</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_beam_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">view</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_beam_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">view</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ç¤ºä¾‹è°ƒç”¨</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randint</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_search</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> max_length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>ğŸ’¡ <strong>å¯å‘ç‚¹</strong>ï¼šé€šè¿‡ç»´æŠ¤å¤šä¸ªå€™é€‰åºåˆ—ï¼ŒBeam Searchèƒ½æœ‰æ•ˆæå‡ç”Ÿæˆè´¨é‡ï¼Œä½†ä»£ä»·æ˜¯è®¡ç®—å¤æ‚åº¦æ›´é«˜ã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250407180124.png\" alt=\"Pasted image 20250407180124.png\"></p>\n<hr>\n<h2 id=\"å¸¸è§é”™è¯¯è­¦å‘Š\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯è­¦å‘Š\"><span>å¸¸è§é”™è¯¯è­¦å‘Š</span></a></h2>\n<p>âš  <strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>\n<ol>\n<li>Beamå¤§å°ï¼ˆ$$k$$ï¼‰è¿‡å°å¯èƒ½å¯¼è‡´ç”Ÿæˆç»“æœè´¨é‡ä¸‹é™ï¼›è¿‡å¤§åˆ™å¢åŠ è®¡ç®—æˆæœ¬ã€‚</li>\n<li>Beam Searchå¯èƒ½è¿‡äºä¿å®ˆï¼Œå¯¼è‡´ç¼ºä¹åˆ›é€ æ€§ç”Ÿæˆã€‚</li>\n</ol>\n<hr>\n<h2 id=\"æ•°æ®ä¸å…¬å¼\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®ä¸å…¬å¼\"><span>æ•°æ®ä¸å…¬å¼</span></a></h2>\n<h3 id=\"æ•°æ®è¡¨æ ¼ç¤ºä¾‹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è¡¨æ ¼ç¤ºä¾‹\"><span>æ•°æ®è¡¨æ ¼ç¤ºä¾‹</span></a></h3>\n<table>\n<thead>\n<tr>\n<th>è§£ç ç­–ç•¥</th>\n<th>ä¼˜åŠ¿</th>\n<th>åŠ£åŠ¿</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Greedy Search</td>\n<td>ç®€å•é«˜æ•ˆ</td>\n<td>å•è°ƒã€é‡å¤</td>\n</tr>\n<tr>\n<td>Beam Search</td>\n<td>å¹³è¡¡è´¨é‡ä¸å¤šæ ·æ€§</td>\n<td>ä¿å®ˆã€ä¸è‡ªç„¶</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å…¬å¼ç¤ºä¾‹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…¬å¼ç¤ºä¾‹\"><span>å…¬å¼ç¤ºä¾‹</span></a></h3>\n<p>Beam Searchæ ¸å¿ƒå…¬å¼ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>Next_Token_Scores</mtext><mo>=</mo><msub><mtext>Top</mtext><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mtext>ProbabilityÂ Distribution</mtext><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\text{Next\\_Token\\_Scores} = \\text{Top}_k(\\text{Probability Distribution})\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0044em;vertical-align:-0.31em;\"></span><span class=\"mord text\"><span class=\"mord\">Next_Token_Scores</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Top</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.242em;\"><span style=\"top:-2.4559em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2441em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord\">ProbabilityÂ Distribution</span></span><span class=\"mclose\">)</span></span></span></span></span></p>\n<hr>\n<h2 id=\"æ€è€ƒ-å»¶ä¼¸é—®é¢˜\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ€è€ƒ-å»¶ä¼¸é—®é¢˜\"><span>[æ€è€ƒ] å»¶ä¼¸é—®é¢˜</span></a></h2>\n<ol>\n<li>å¦‚ä½•ç»“åˆä¸¤ç§è§£ç ç­–ç•¥ï¼Œè®¾è®¡å‡ºæ—¢é«˜æ•ˆåˆå¤šæ ·åŒ–çš„ç”Ÿæˆç®—æ³•ï¼Ÿ</li>\n<li>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ˜¯å¦å¯ä»¥åŠ¨æ€è°ƒæ•´Beamå¤§å°ä»¥é€‚é…ä¸åŒä»»åŠ¡ï¼Ÿ</li>\n<li>æ˜¯å¦æœ‰æ›´å…ˆè¿›çš„è§£ç ç­–ç•¥èƒ½è§£å†³Beam Searchçš„ä¿å®ˆé—®é¢˜ï¼Ÿ</li>\n</ol>\n<hr>\n<blockquote>\n<p><strong>æ¥æº</strong>ï¼šæ•´ç†è‡ªè‡ªç„¶è¯­è¨€å¤„ç†ç›¸å…³æŠ€æœ¯æ–‡æ¡£ä¸ä»£ç ç¤ºä¾‹ã€‚</p>\n</blockquote>\n<hr>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ol>\n<li>å®ç°Greedy Searchå’ŒBeam Searchçš„ä»£ç å¹¶æµ‹è¯•ä¸åŒå‚æ•°å¯¹ç”Ÿæˆæ•ˆæœçš„å½±å“ã€‚</li>\n<li>é˜…è¯»ç›¸å…³è®ºæ–‡ï¼Œæ¢ç´¢æ”¹è¿›Beam Searchçš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¾‹å¦‚Top-pæˆ–Top-ké‡‡æ ·ã€‚</li>\n<li>åº”ç”¨ä¸Šè¿°è§£ç ç­–ç•¥äºå®é™…é¡¹ç›®ï¼Œè¯„ä¼°å…¶æ€§èƒ½å’Œç”Ÿæˆè´¨é‡ã€‚</li>\n</ol>\n<hr>\n<p>ğŸ“ˆ <strong>è¶‹åŠ¿é¢„æµ‹</strong><br>\næœªæ¥è§£ç ç­–ç•¥å°†æ›´æ³¨é‡ç»“åˆæ¦‚ç‡åˆ†å¸ƒä¸ä¸Šä¸‹æ–‡è¯­ä¹‰ï¼Œåˆ©ç”¨åŠ¨æ€è°ƒæ•´æœºåˆ¶æå‡ç”Ÿæˆæ•ˆæœï¼ŒåŒæ—¶å‡å°‘è®¡ç®—å¼€é”€ã€‚</p>\n<hr>\n<h2 id=\"åç»­è¿½è¸ª\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åç»­è¿½è¸ª\"><span>åç»­è¿½è¸ª</span></a></h2>\n<ul>\n<li>ç ”ç©¶Top-pé‡‡æ ·å’Œæ¸©åº¦è°ƒèŠ‚å¯¹ç”Ÿæˆè´¨é‡çš„å½±å“ã€‚</li>\n<li>æ¢ç´¢åŸºäºå¼ºåŒ–å­¦ä¹ ä¼˜åŒ–è§£ç ç­–ç•¥çš„æ–°æ–¹æ³•ã€‚</li>\n</ul>\n</template>","contentStripped":"<p><strong>åˆ†ç±»</strong>ï¼šè‡ªç„¶è¯­è¨€å¤„ç†<br>\n<strong>æ ‡ç­¾</strong>ï¼šè§£ç ç­–ç•¥ã€å¤§æ¨¡å‹ç”Ÿæˆã€Beam Search<br>\n<strong>æ—¥æœŸ</strong>ï¼š2025å¹´4æœˆ1æ—¥</p>\n<hr>\n<h2 id=\"æ ¸å¿ƒè§‚ç‚¹æ€»ç»“\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒè§‚ç‚¹æ€»ç»“\"><span>æ ¸å¿ƒè§‚ç‚¹æ€»ç»“</span></a></h2>\n<p>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸï¼Œå¤§æ¨¡å‹ç”Ÿæˆæ–‡æœ¬æ—¶éœ€è¦é€‰æ‹©è§£ç ç­–ç•¥ä»¥ç¡®ä¿ç”Ÿæˆçš„è´¨é‡å’Œå¤šæ ·æ€§ã€‚æœ¬æ–‡ä¸»è¦æ¢è®¨äº†ä¸¤ç§ä¸»æµè§£ç ç­–ç•¥â€”â€”Greedy Searchå’ŒBeam Searchï¼Œå¹¶é€šè¿‡ä»£ç ç¤ºä¾‹å±•ç¤ºäº†Beam Searchçš„å…·ä½“å®ç°ç»†èŠ‚ã€‚</p>\n<ul>\n<li><strong>Greedy Search</strong>ï¼šæ¯æ¬¡é€‰æ‹©æ¦‚ç‡æœ€å¤§çš„è¯ï¼Œç®€å•ä½†å¯èƒ½å¯¼è‡´ç”Ÿæˆç»“æœå•è°ƒé‡å¤ã€‚</li>\n<li><strong>Beam Search</strong>ï¼šç»´æŠ¤å¤šä¸ªå€™é€‰åºåˆ—ï¼Œé€šè¿‡æ¦‚ç‡å¹³è¡¡è´¨é‡ä¸å¤šæ ·æ€§ï¼Œä½†å¯èƒ½æ˜¾å¾—ä¿å®ˆã€‚</li>\n</ul>\n<hr>\n<h2 id=\"è§£ç ç­–ç•¥è¯¦è§£\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è§£ç ç­–ç•¥è¯¦è§£\"><span>è§£ç ç­–ç•¥è¯¦è§£</span></a></h2>\n<h3 id=\"greedy-search\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#greedy-search\"><span>Greedy Search</span></a></h3>\n<ul>\n<li><strong>ç‰¹ç‚¹</strong>ï¼š<br>\nâœ… æ¯æ¬¡é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„è¯<br>\nâš  ç®€å•é«˜æ•ˆï¼Œä½†å¯èƒ½ç”Ÿæˆå•è°ƒã€é‡å¤çš„æ–‡æœ¬</li>\n</ul>\n<p>ğŸ’¡ <strong>å¯å‘ç‚¹</strong>ï¼šé€‚åˆç®€å•ä»»åŠ¡ï¼Œä½†å¯¹å¤æ‚ç”Ÿæˆä»»åŠ¡æ•ˆæœæ¬ ä½³ã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250407180111.png\" alt=\"Pasted image 20250407180111.png\"></p>\n<hr>\n<h3 id=\"beam-search\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#beam-search\"><span>Beam Search</span></a></h3>\n<ul>\n<li>\n<p><strong>æ ¸å¿ƒæœºåˆ¶</strong>ï¼š\nâœ… ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º $$k$$ çš„å€™é€‰åºåˆ—é›†åˆ<br>\nâœ… æ¯ä¸€æ­¥ä»æ¯ä¸ªå€™é€‰åºåˆ—çš„æ¦‚ç‡åˆ†å¸ƒä¸­é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„ $$k$$ ä¸ªè¯<br>\nâœ… ä¿ç•™æ€»æ¦‚ç‡æœ€é«˜çš„ $$k$$ ä¸ªå€™é€‰åºåˆ—</p>\n</li>\n<li>\n<p><strong>ä»£ç å®ç°</strong>ï¼š</p>\n</li>\n</ul>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> process</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    batch_size </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    group_size </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    next_beam_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    next_beam_tokens </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    next_beam_indices </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dtype</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> batch_idx </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        beam_idx </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_token_rank</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_token</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_score</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_index</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> enumerate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">            zip</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">next_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            batch_beam_idx </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> batch_idx </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_beams </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_index</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            next_beam_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_score</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            next_beam_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_token</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            next_beam_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">batch_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_idx</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> batch_beam_idx</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            beam_idx </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">+=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_beam_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">view</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_beam_tokens</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">view</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> next_beam_indices</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">view</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ç¤ºä¾‹è°ƒç”¨</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randint</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 100</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beam_search</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> max_length</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> num_beams</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>ğŸ’¡ <strong>å¯å‘ç‚¹</strong>ï¼šé€šè¿‡ç»´æŠ¤å¤šä¸ªå€™é€‰åºåˆ—ï¼ŒBeam Searchèƒ½æœ‰æ•ˆæå‡ç”Ÿæˆè´¨é‡ï¼Œä½†ä»£ä»·æ˜¯è®¡ç®—å¤æ‚åº¦æ›´é«˜ã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250407180124.png\" alt=\"Pasted image 20250407180124.png\"></p>\n<hr>\n<h2 id=\"å¸¸è§é”™è¯¯è­¦å‘Š\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯è­¦å‘Š\"><span>å¸¸è§é”™è¯¯è­¦å‘Š</span></a></h2>\n<p>âš  <strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>\n<ol>\n<li>Beamå¤§å°ï¼ˆ$$k$$ï¼‰è¿‡å°å¯èƒ½å¯¼è‡´ç”Ÿæˆç»“æœè´¨é‡ä¸‹é™ï¼›è¿‡å¤§åˆ™å¢åŠ è®¡ç®—æˆæœ¬ã€‚</li>\n<li>Beam Searchå¯èƒ½è¿‡äºä¿å®ˆï¼Œå¯¼è‡´ç¼ºä¹åˆ›é€ æ€§ç”Ÿæˆã€‚</li>\n</ol>\n<hr>\n<h2 id=\"æ•°æ®ä¸å…¬å¼\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®ä¸å…¬å¼\"><span>æ•°æ®ä¸å…¬å¼</span></a></h2>\n<h3 id=\"æ•°æ®è¡¨æ ¼ç¤ºä¾‹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è¡¨æ ¼ç¤ºä¾‹\"><span>æ•°æ®è¡¨æ ¼ç¤ºä¾‹</span></a></h3>\n<table>\n<thead>\n<tr>\n<th>è§£ç ç­–ç•¥</th>\n<th>ä¼˜åŠ¿</th>\n<th>åŠ£åŠ¿</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Greedy Search</td>\n<td>ç®€å•é«˜æ•ˆ</td>\n<td>å•è°ƒã€é‡å¤</td>\n</tr>\n<tr>\n<td>Beam Search</td>\n<td>å¹³è¡¡è´¨é‡ä¸å¤šæ ·æ€§</td>\n<td>ä¿å®ˆã€ä¸è‡ªç„¶</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å…¬å¼ç¤ºä¾‹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…¬å¼ç¤ºä¾‹\"><span>å…¬å¼ç¤ºä¾‹</span></a></h3>\n<p>Beam Searchæ ¸å¿ƒå…¬å¼ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>Next_Token_Scores</mtext><mo>=</mo><msub><mtext>Top</mtext><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mtext>ProbabilityÂ Distribution</mtext><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\text{Next\\_Token\\_Scores} = \\text{Top}_k(\\text{Probability Distribution})\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0044em;vertical-align:-0.31em;\"></span><span class=\"mord text\"><span class=\"mord\">Next_Token_Scores</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord text\"><span class=\"mord\">Top</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.242em;\"><span style=\"top:-2.4559em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2441em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord\">ProbabilityÂ Distribution</span></span><span class=\"mclose\">)</span></span></span></span></span></p>\n<hr>\n<h2 id=\"æ€è€ƒ-å»¶ä¼¸é—®é¢˜\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ€è€ƒ-å»¶ä¼¸é—®é¢˜\"><span>[æ€è€ƒ] å»¶ä¼¸é—®é¢˜</span></a></h2>\n<ol>\n<li>å¦‚ä½•ç»“åˆä¸¤ç§è§£ç ç­–ç•¥ï¼Œè®¾è®¡å‡ºæ—¢é«˜æ•ˆåˆå¤šæ ·åŒ–çš„ç”Ÿæˆç®—æ³•ï¼Ÿ</li>\n<li>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ˜¯å¦å¯ä»¥åŠ¨æ€è°ƒæ•´Beamå¤§å°ä»¥é€‚é…ä¸åŒä»»åŠ¡ï¼Ÿ</li>\n<li>æ˜¯å¦æœ‰æ›´å…ˆè¿›çš„è§£ç ç­–ç•¥èƒ½è§£å†³Beam Searchçš„ä¿å®ˆé—®é¢˜ï¼Ÿ</li>\n</ol>\n<hr>\n<blockquote>\n<p><strong>æ¥æº</strong>ï¼šæ•´ç†è‡ªè‡ªç„¶è¯­è¨€å¤„ç†ç›¸å…³æŠ€æœ¯æ–‡æ¡£ä¸ä»£ç ç¤ºä¾‹ã€‚</p>\n</blockquote>\n<hr>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ol>\n<li>å®ç°Greedy Searchå’ŒBeam Searchçš„ä»£ç å¹¶æµ‹è¯•ä¸åŒå‚æ•°å¯¹ç”Ÿæˆæ•ˆæœçš„å½±å“ã€‚</li>\n<li>é˜…è¯»ç›¸å…³è®ºæ–‡ï¼Œæ¢ç´¢æ”¹è¿›Beam Searchçš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¾‹å¦‚Top-pæˆ–Top-ké‡‡æ ·ã€‚</li>\n<li>åº”ç”¨ä¸Šè¿°è§£ç ç­–ç•¥äºå®é™…é¡¹ç›®ï¼Œè¯„ä¼°å…¶æ€§èƒ½å’Œç”Ÿæˆè´¨é‡ã€‚</li>\n</ol>\n<hr>\n<p>ğŸ“ˆ <strong>è¶‹åŠ¿é¢„æµ‹</strong><br>\næœªæ¥è§£ç ç­–ç•¥å°†æ›´æ³¨é‡ç»“åˆæ¦‚ç‡åˆ†å¸ƒä¸ä¸Šä¸‹æ–‡è¯­ä¹‰ï¼Œåˆ©ç”¨åŠ¨æ€è°ƒæ•´æœºåˆ¶æå‡ç”Ÿæˆæ•ˆæœï¼ŒåŒæ—¶å‡å°‘è®¡ç®—å¼€é”€ã€‚</p>\n<hr>\n<h2 id=\"åç»­è¿½è¸ª\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åç»­è¿½è¸ª\"><span>åç»­è¿½è¸ª</span></a></h2>\n<ul>\n<li>ç ”ç©¶Top-pé‡‡æ ·å’Œæ¸©åº¦è°ƒèŠ‚å¯¹ç”Ÿæˆè´¨é‡çš„å½±å“ã€‚</li>\n<li>æ¢ç´¢åŸºäºå¼ºåŒ–å­¦ä¹ ä¼˜åŒ–è§£ç ç­–ç•¥çš„æ–°æ–¹æ³•ã€‚</li>\n</ul>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"**åˆ†ç±»**ï¼šè‡ªç„¶è¯­è¨€å¤„ç†  \n**æ ‡ç­¾**ï¼šè§£ç ç­–ç•¥ã€å¤§æ¨¡å‹ç”Ÿæˆã€Beam Search  \n**æ—¥æœŸ**ï¼š2025å¹´4æœˆ1æ—¥  \n\n---\n\n\n\n## æ ¸å¿ƒè§‚ç‚¹æ€»ç»“\nåœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸï¼Œå¤§æ¨¡å‹ç”Ÿæˆæ–‡æœ¬æ—¶éœ€è¦é€‰æ‹©è§£ç ç­–ç•¥ä»¥ç¡®ä¿ç”Ÿæˆçš„è´¨é‡å’Œå¤šæ ·æ€§ã€‚æœ¬æ–‡ä¸»è¦æ¢è®¨äº†ä¸¤ç§ä¸»æµè§£ç ç­–ç•¥â€”â€”Greedy Searchå’ŒBeam Searchï¼Œå¹¶é€šè¿‡ä»£ç ç¤ºä¾‹å±•ç¤ºäº†Beam Searchçš„å…·ä½“å®ç°ç»†èŠ‚ã€‚\n\n- **Greedy Search**ï¼šæ¯æ¬¡é€‰æ‹©æ¦‚ç‡æœ€å¤§çš„è¯ï¼Œç®€å•ä½†å¯èƒ½å¯¼è‡´ç”Ÿæˆç»“æœå•è°ƒé‡å¤ã€‚  \n- **Beam Search**ï¼šç»´æŠ¤å¤šä¸ªå€™é€‰åºåˆ—ï¼Œé€šè¿‡æ¦‚ç‡å¹³è¡¡è´¨é‡ä¸å¤šæ ·æ€§ï¼Œä½†å¯èƒ½æ˜¾å¾—ä¿å®ˆã€‚\n\n---\n\n\n\n## è§£ç ç­–ç•¥è¯¦è§£\n\n### Greedy Search\n- **ç‰¹ç‚¹**ï¼š  \n  âœ… æ¯æ¬¡é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„è¯  \n  âš  ç®€å•é«˜æ•ˆï¼Œä½†å¯èƒ½ç”Ÿæˆå•è°ƒã€é‡å¤çš„æ–‡æœ¬  \n\nğŸ’¡ **å¯å‘ç‚¹**ï¼šé€‚åˆç®€å•ä»»åŠ¡ï¼Œä½†å¯¹å¤æ‚ç”Ÿæˆä»»åŠ¡æ•ˆæœæ¬ ä½³ã€‚\n![Pasted image 20250407180111.png](/img/user/%E9%99%84%E4%BB%B6/Pasted%20image%2020250407180111.png)\n\n---\n\n\n### Beam Search\n- **æ ¸å¿ƒæœºåˆ¶**ï¼š\n  âœ… ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º $$k$$ çš„å€™é€‰åºåˆ—é›†åˆ  \n  âœ… æ¯ä¸€æ­¥ä»æ¯ä¸ªå€™é€‰åºåˆ—çš„æ¦‚ç‡åˆ†å¸ƒä¸­é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„ $$k$$ ä¸ªè¯  \n  âœ… ä¿ç•™æ€»æ¦‚ç‡æœ€é«˜çš„ $$k$$ ä¸ªå€™é€‰åºåˆ—\n\n- **ä»£ç å®ç°**ï¼š\n\n```python\ndef process(input_ids, next_scores, next_tokens, next_indices):\n    batch_size = 3\n    group_size = 3\n    next_beam_scores = torch.zeros((batch_size, num_beams), dtype=next_scores.dtype)\n    next_beam_tokens = torch.zeros((batch_size, num_beams), dtype=next_tokens.dtype)\n    next_beam_indices = torch.zeros((batch_size, num_beams), dtype=next_indices.dtype)\n\n    for batch_idx in range(batch_size):\n        beam_idx = 0\n        for beam_token_rank, (next_token, next_score, next_index) in enumerate(\n            zip(next_tokens[batch_idx], next_scores[batch_idx], next_indices[batch_idx])\n        ):\n            batch_beam_idx = batch_idx * num_beams + next_index\n\n            next_beam_scores[batch_idx, beam_idx] = next_score\n            next_beam_tokens[batch_idx, beam_idx] = next_token\n            next_beam_indices[batch_idx, beam_idx] = batch_beam_idx\n\n            beam_idx += 1\n\n    return next_beam_scores.view(-1), next_beam_tokens.view(-1), next_beam_indices.view(-1)\n\n# ç¤ºä¾‹è°ƒç”¨\ninput_ids = torch.randint(0, 100, size=(3, 1))\ninput_ids, beam_scores = beam_search(input_ids, max_length=10, num_beams=3)\nprint(input_ids)\n```\n\nğŸ’¡ **å¯å‘ç‚¹**ï¼šé€šè¿‡ç»´æŠ¤å¤šä¸ªå€™é€‰åºåˆ—ï¼ŒBeam Searchèƒ½æœ‰æ•ˆæå‡ç”Ÿæˆè´¨é‡ï¼Œä½†ä»£ä»·æ˜¯è®¡ç®—å¤æ‚åº¦æ›´é«˜ã€‚\n![Pasted image 20250407180124.png](/img/user/%E9%99%84%E4%BB%B6/Pasted%20image%2020250407180124.png)\n\n---\n\n\n\n## å¸¸è§é”™è¯¯è­¦å‘Š\nâš  **æ³¨æ„äº‹é¡¹**ï¼š\n1. Beamå¤§å°ï¼ˆ$$k$$ï¼‰è¿‡å°å¯èƒ½å¯¼è‡´ç”Ÿæˆç»“æœè´¨é‡ä¸‹é™ï¼›è¿‡å¤§åˆ™å¢åŠ è®¡ç®—æˆæœ¬ã€‚\n2. Beam Searchå¯èƒ½è¿‡äºä¿å®ˆï¼Œå¯¼è‡´ç¼ºä¹åˆ›é€ æ€§ç”Ÿæˆã€‚\n\n---\n\n\n\n## æ•°æ®ä¸å…¬å¼\n\n### æ•°æ®è¡¨æ ¼ç¤ºä¾‹\n| è§£ç ç­–ç•¥   | ä¼˜åŠ¿                      | åŠ£åŠ¿               |\n|------------|---------------------------|--------------------|\n| Greedy Search | ç®€å•é«˜æ•ˆ                 | å•è°ƒã€é‡å¤         |\n| Beam Search   | å¹³è¡¡è´¨é‡ä¸å¤šæ ·æ€§         | ä¿å®ˆã€ä¸è‡ªç„¶       |\n\n\n### å…¬å¼ç¤ºä¾‹\nBeam Searchæ ¸å¿ƒå…¬å¼ï¼š\n$$\n\\text{Next\\_Token\\_Scores} = \\text{Top}_k(\\text{Probability Distribution})\n$$\n\n---\n\n\n\n## [æ€è€ƒ] å»¶ä¼¸é—®é¢˜\n1. å¦‚ä½•ç»“åˆä¸¤ç§è§£ç ç­–ç•¥ï¼Œè®¾è®¡å‡ºæ—¢é«˜æ•ˆåˆå¤šæ ·åŒ–çš„ç”Ÿæˆç®—æ³•ï¼Ÿ  \n2. åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ˜¯å¦å¯ä»¥åŠ¨æ€è°ƒæ•´Beamå¤§å°ä»¥é€‚é…ä¸åŒä»»åŠ¡ï¼Ÿ  \n3. æ˜¯å¦æœ‰æ›´å…ˆè¿›çš„è§£ç ç­–ç•¥èƒ½è§£å†³Beam Searchçš„ä¿å®ˆé—®é¢˜ï¼Ÿ\n\n---\n\n> **æ¥æº**ï¼šæ•´ç†è‡ªè‡ªç„¶è¯­è¨€å¤„ç†ç›¸å…³æŠ€æœ¯æ–‡æ¡£ä¸ä»£ç ç¤ºä¾‹ã€‚\n\n---\n\n\n\n## è¡ŒåŠ¨æ¸…å•\n1. å®ç°Greedy Searchå’ŒBeam Searchçš„ä»£ç å¹¶æµ‹è¯•ä¸åŒå‚æ•°å¯¹ç”Ÿæˆæ•ˆæœçš„å½±å“ã€‚  \n2. é˜…è¯»ç›¸å…³è®ºæ–‡ï¼Œæ¢ç´¢æ”¹è¿›Beam Searchçš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¾‹å¦‚Top-pæˆ–Top-ké‡‡æ ·ã€‚  \n3. åº”ç”¨ä¸Šè¿°è§£ç ç­–ç•¥äºå®é™…é¡¹ç›®ï¼Œè¯„ä¼°å…¶æ€§èƒ½å’Œç”Ÿæˆè´¨é‡ã€‚\n\n---\n\nğŸ“ˆ **è¶‹åŠ¿é¢„æµ‹**  \næœªæ¥è§£ç ç­–ç•¥å°†æ›´æ³¨é‡ç»“åˆæ¦‚ç‡åˆ†å¸ƒä¸ä¸Šä¸‹æ–‡è¯­ä¹‰ï¼Œåˆ©ç”¨åŠ¨æ€è°ƒæ•´æœºåˆ¶æå‡ç”Ÿæˆæ•ˆæœï¼ŒåŒæ—¶å‡å°‘è®¡ç®—å¼€é”€ã€‚\n\n---\n\n\n\n## åç»­è¿½è¸ª\n- ç ”ç©¶Top-pé‡‡æ ·å’Œæ¸©åº¦è°ƒèŠ‚å¯¹ç”Ÿæˆè´¨é‡çš„å½±å“ã€‚  \n- æ¢ç´¢åŸºäºå¼ºåŒ–å­¦ä¹ ä¼˜åŒ–è§£ç ç­–ç•¥çš„æ–°æ–¹æ³•ã€‚","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":2,"title":"æ ¸å¿ƒè§‚ç‚¹æ€»ç»“","slug":"æ ¸å¿ƒè§‚ç‚¹æ€»ç»“","link":"#æ ¸å¿ƒè§‚ç‚¹æ€»ç»“","children":[]},{"level":2,"title":"è§£ç ç­–ç•¥è¯¦è§£","slug":"è§£ç ç­–ç•¥è¯¦è§£","link":"#è§£ç ç­–ç•¥è¯¦è§£","children":[{"level":3,"title":"Greedy Search","slug":"greedy-search","link":"#greedy-search","children":[]},{"level":3,"title":"Beam Search","slug":"beam-search","link":"#beam-search","children":[]}]},{"level":2,"title":"å¸¸è§é”™è¯¯è­¦å‘Š","slug":"å¸¸è§é”™è¯¯è­¦å‘Š","link":"#å¸¸è§é”™è¯¯è­¦å‘Š","children":[]},{"level":2,"title":"æ•°æ®ä¸å…¬å¼","slug":"æ•°æ®ä¸å…¬å¼","link":"#æ•°æ®ä¸å…¬å¼","children":[{"level":3,"title":"æ•°æ®è¡¨æ ¼ç¤ºä¾‹","slug":"æ•°æ®è¡¨æ ¼ç¤ºä¾‹","link":"#æ•°æ®è¡¨æ ¼ç¤ºä¾‹","children":[]},{"level":3,"title":"å…¬å¼ç¤ºä¾‹","slug":"å…¬å¼ç¤ºä¾‹","link":"#å…¬å¼ç¤ºä¾‹","children":[]}]},{"level":2,"title":"[æ€è€ƒ] å»¶ä¼¸é—®é¢˜","slug":"æ€è€ƒ-å»¶ä¼¸é—®é¢˜","link":"#æ€è€ƒ-å»¶ä¼¸é—®é¢˜","children":[]},{"level":2,"title":"è¡ŒåŠ¨æ¸…å•","slug":"è¡ŒåŠ¨æ¸…å•","link":"#è¡ŒåŠ¨æ¸…å•","children":[]},{"level":2,"title":"åç»­è¿½è¸ª","slug":"åç»­è¿½è¸ª","link":"#åç»­è¿½è¸ª","children":[]}]}}
