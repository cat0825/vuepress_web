---
{"dg-publish":true,"dg-permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Pre-training-é¢„è®­ç»ƒ/æ¨ç†è€—æ—¶","dg-home":false,"dg-description":"åœ¨æ­¤è¾“å…¥ç¬”è®°çš„æè¿°","dg-hide":false,"dg-hide-title":false,"dg-show-backlinks":true,"dg-show-local-graph":true,"dg-show-inline-title":true,"dg-pinned":false,"dg-passphrase":"åœ¨æ­¤è¾“å…¥è®¿é—®å¯†ç ","dg-enable-mathjax":false,"dg-enable-mermaid":false,"dg-enable-uml":false,"dg-note-icon":0,"dg-enable-dataview":false,"tags":["NLP"],"permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /Pre-training-é¢„è®­ç»ƒ/æ¨ç†è€—æ—¶/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true,"dgPassFrontmatter":true,"noteIcon":0,"created":"2025-04-10T21:47:51.000+08:00","updated":"2025-04-13T13:06:02.000+08:00"}
---



# æ¨ç†è€—æ—¶ä¸æœºåˆ¶åˆ†æï¼šä¼˜åŒ–å¤§æ¨¡å‹ç”Ÿæˆé€Ÿåº¦
åˆ†ç±»ï¼šäººå·¥æ™ºèƒ½ï¼Œæ·±åº¦å­¦ä¹ 

æ ‡ç­¾ï¼šæ¨ç†æœºåˆ¶ï¼ŒçŸ©é˜µè®¡ç®—ï¼Œæ—¶å»¶ä¼˜åŒ–

æ—¥æœŸï¼š2023å¹´10æœˆ25æ—¥

## æ¨ç†æœºåˆ¶æ¦‚è¿°
ä¼ ç»Ÿçš„æ¨ç†æ–¹å¼é‡‡ç”¨é€ä¸ªtokenç”Ÿæˆçš„æ–¹æ³•ï¼Œæ— æ³•å¹¶è¡ŒåŒ–å¤„ç†ã€‚æ¨ç†è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬ï¼š

- **çŸ©é˜µ-å‘é‡ä¹˜æ³•**ï¼šä¸€ä¸ªå¤§çŸ©é˜µï¼ˆå¦‚8192x8192ï¼‰ä¸ä¸€ä¸ªå‘é‡ç›¸ä¹˜ï¼Œå¾—åˆ°å¦ä¸€ä¸ªå‘é‡ã€‚
- **Attentionè®¡ç®—**ï¼šé€šè¿‡KV-cacheè¿›è¡Œæ¨ç†ã€‚

### å…³é”®ç“¶é¢ˆ
- çŸ©é˜µ-å‘é‡ä¹˜æ³•çš„æµ®ç‚¹è¿ç®—ï¼šæ¯ä¸ªçŸ©é˜µå…ƒç´ æ‰§è¡Œä¸€æ¬¡ä¹˜åŠ è¿ç®—ï¼ˆ2 FLOPsï¼‰ã€‚
- Attentionè®¡ç®—éœ€è¦å¯¹æ¯ä¸ªkeyå’Œvalueæ‰§è¡Œä¸€æ¬¡ä¹˜åŠ ã€‚


## æ—¶å»¶è®¡ç®—

### æ•°æ®é‡åˆ†æ
åœ¨æ¨¡å‹ä½¿ç”¨FP16æ ¼å¼æ—¶ï¼Œæ¯ç”Ÿæˆä¸€ä¸ªtokenéœ€è¦åŠ è½½çš„æ•°æ®æ€»é‡ä¸º14.2 GBã€‚è™½ç„¶ä¸‹ä¸€ä¸ªtokenç”Ÿæˆæ—¶å¯ä»¥å¤ç”¨æ¯ä¸ªçŸ©é˜µï¼Œä½†ç”±äºç¡¬ä»¶ç¼“å­˜å¤§å°æœ‰é™ï¼Œé€Ÿåº¦å—é™äºæ˜¾å­˜å¸¦å®½ã€‚


### KV-cacheè¯»å–
å‡è®¾æ˜¯7Bå¤§å°çš„LLMï¼Œæ¯ä¸ªtokenå¯¹åº”çš„KV-cacheæ•°æ®é‡ä¸º130KBã€‚ä¾‹å¦‚ï¼Œç¬¬1000ä¸ªtokenéœ€è¦è¯»å–130MBçš„æ•°æ®ï¼Œä¸æ€»æ•°æ®é‡14.2GBç›¸æ¯”ï¼Œè¿™éƒ¨åˆ†å½±å“å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚


### è®¡ç®—æ—¶å»¶
åœ¨NVIDIA RTX 4090ä¸Šï¼Œè¯»å–14.2GB (FP16)æ•°æ®éœ€è¦çº¦14.1msï¼Œå› æ­¤æ¯ä¸ªä½ç½®é å‰çš„tokenå¤§çº¦éœ€è¦14.1msã€‚ä½¿ç”¨8bitæƒé‡åˆ™éœ€7.0msã€‚è¿™æ˜¯ç”Ÿæˆæ¯ä¸ªtokençš„ç†è®ºæœ€å°æ—¶é—´ã€‚


## å…¬å¼æ€»ç»“
æ¨¡å‹çš„é¢„æµ‹æ—¶é—´å¯ä»¥è¿‘ä¼¼ä¸ºï¼š
$$
y = kx + b
$$
å…¶ä¸­ï¼Œ$$b$$æ˜¯é¦–ä¸ªtokençš„è€—æ—¶ï¼Œ$$k$$æ˜¯åç»­æ¯ä¸ªtokençš„è€—æ—¶ï¼Œ$$x$$æ˜¯ç”Ÿæˆtokençš„æ€»æ•°é‡ã€‚


## å¸¸è§é”™è¯¯
> âš ï¸ åœ¨è¿›è¡Œæ¨ç†æœºåˆ¶ä¼˜åŒ–æ—¶ï¼Œå®¹æ˜“å¿½è§†KV-cacheå¯¹æ•´ä½“é€Ÿåº¦çš„å¾®å°å½±å“ï¼Œå¯¼è‡´é”™è¯¯è¯„ä¼°æ€§èƒ½ç“¶é¢ˆã€‚


## ğŸ’¡å¯å‘ç‚¹
- çŸ©é˜µ-å‘é‡ä¹˜æ³•å’Œattentionè®¡ç®—æ˜¯æ¨ç†è¿‡ç¨‹ä¸­çš„æ ¸å¿ƒæ“ä½œï¼Œä¼˜åŒ–è¿™äº›æ­¥éª¤å¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹æ€§èƒ½ã€‚


## è¡ŒåŠ¨æ¸…å•
- æ¢ç´¢æ›´é«˜æ•ˆçš„çŸ©é˜µè®¡ç®—æ–¹æ³•ã€‚
- ä¼˜åŒ–KV-cacheä½¿ç”¨ç­–ç•¥ä»¥å‡å°‘ä¸å¿…è¦çš„æ•°æ®è¯»å–ã€‚


## ğŸ“ˆè¶‹åŠ¿é¢„æµ‹
æœªæ¥ï¼Œå¤§æ¨¡å‹çš„æ¨ç†é€Ÿåº¦å°†ç»§ç»­æå‡ï¼Œé€šè¿‡ç¡¬ä»¶å’Œç®—æ³•çš„ååŒä¼˜åŒ–å®ç°æ›´å¿«çš„å“åº”æ—¶é—´ã€‚


## åç»­è¿½è¸ª
- ç ”ç©¶æ–°å‹ç¡¬ä»¶æ¶æ„å¯¹æ¨ç†é€Ÿåº¦çš„å½±å“ã€‚
- æ¢ç´¢æ›´é«˜æ•ˆçš„attentionæœºåˆ¶ä»¥è¿›ä¸€æ­¥å‡å°‘æ¨ç†æ—¶å»¶ã€‚

> æ¥æºï¼šã€ŠLLM inference speed of lightã€‹
