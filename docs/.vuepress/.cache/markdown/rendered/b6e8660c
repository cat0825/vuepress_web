{"content":"<h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<p>åˆ†ç±»ï¼šè‡ªåŠ¨æ¨æ–­</p>\n<p>æ ‡ç­¾ï¼šåŠ¨æ€é€‚é…ã€ä½ç§©åˆ†è§£ã€å¥‡å¼‚å€¼ã€æ·±åº¦å­¦ä¹ ã€AdaLoRA</p>\n<p>æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥</p>\n<h2 id=\"æ ¸å¿ƒè§‚ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒè§‚ç‚¹\"><span>æ ¸å¿ƒè§‚ç‚¹</span></a></h2>\n<p>AdaLoRAæ˜¯ä¸€ç§åˆ›æ–°çš„æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œå®ƒé€šè¿‡åŠ¨æ€è°ƒæ•´ä¸åŒå±‚å’Œå‚æ•°ç±»å‹çš„ç§©ï¼Œæ ¹æ®ä¸‹æ¸¸ä»»åŠ¡éœ€æ±‚è¿›è¡Œä¼˜åŒ–ã€‚è¿™ç§æ–¹æ³•é‡‡ç”¨åŸºäºSVDï¼ˆå¥‡å¼‚å€¼åˆ†è§£ï¼‰çš„å‚æ•°åŒ–å½¢å¼ï¼Œå¯ä»¥æœ‰æ•ˆè£å‰ªä¸é‡è¦çš„å¥‡å¼‚å€¼ï¼Œé™ä½è®¡ç®—å¤æ‚åº¦ã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250424111842.png\" alt=\"Pasted image 20250424111842.png\">\nğŸ’¡å¯å‘ç‚¹ï¼šé€šè¿‡åŠ¨æ€åˆ†é…ç§©å’Œä½¿ç”¨SVDå‚æ•°åŒ–ï¼ŒAdaLoRAå®ç°äº†è®¡ç®—æ•ˆç‡ä¸æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡ã€‚</p>\n<h2 id=\"é‡ç‚¹æ®µè½\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#é‡ç‚¹æ®µè½\"><span>é‡ç‚¹æ®µè½</span></a></h2>\n<h3 id=\"åŠ¨æ€ç§©åˆ†é…\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åŠ¨æ€ç§©åˆ†é…\"><span>åŠ¨æ€ç§©åˆ†é…</span></a></h3>\n<p>AdaLoRAä¸ä»…ä¸ºæ¯ä¸ªAdapteråˆ†é…ç›¸åŒçš„ç§©ï¼Œè€Œæ˜¯æ ¹æ®ä»»åŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´å„å±‚å’Œå‚æ•°ç±»å‹çš„ç§©ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆåœ°å¤„ç†ä¸åŒçš„ä»»åŠ¡ã€‚</p>\n<h3 id=\"svdå‚æ•°åŒ–å¢é‡æ›´æ–°\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#svdå‚æ•°åŒ–å¢é‡æ›´æ–°\"><span>SVDå‚æ•°åŒ–å¢é‡æ›´æ–°</span></a></h3>\n<p>é‡‡ç”¨SVDå½¢å¼å‚æ•°åŒ–å¢é‡æ›´æ–°ï¼Œèƒ½å¤Ÿåœ¨è§„é¿å¤æ‚è®¡ç®—çš„åŒæ—¶é«˜æ•ˆè£å‰ªä¸é‡è¦çš„å¥‡å¼‚å€¼ã€‚è¿™ç§æ–¹æ³•å¤§å¤§é™ä½äº†è®¡ç®—é‡ï¼Œå¹¶æé«˜äº†æ¨¡å‹çš„é€‚åº”èƒ½åŠ›ã€‚</p>\n<h3 id=\"æ ¸å¿ƒä»£ç è§£æ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒä»£ç è§£æ\"><span>æ ¸å¿ƒä»£ç è§£æ</span></a></h3>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> AdaLoraLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">LoraLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> update_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_alpha</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_dropout</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> init_lora_weights</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora_A</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Singular values</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora_E</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Left singular vectors</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora_B</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">out_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # The current rank</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ranknum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> requires_grad</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ranknum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fill_</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">float</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ranknum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">requires_grad </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> False</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">scaling</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_alpha </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_alpha </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> float</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"æ“ä½œæ­¥éª¤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ“ä½œæ­¥éª¤\"><span>æ“ä½œæ­¥éª¤</span></a></h2>\n<ol>\n<li>âœ… åˆå§‹åŒ–å‚æ•°çŸ©é˜µå¹¶åˆ†é…ç§©ã€‚</li>\n<li>âš  ä½¿ç”¨SVDè¿›è¡Œå¥‡å¼‚å€¼è£å‰ªã€‚</li>\n<li>â— æ ¹æ®ä»»åŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´é€‚é…å™¨æƒé‡ã€‚</li>\n</ol>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<blockquote>\n<p>âš  åœ¨è°ƒæ•´ç§©æ—¶ï¼Œå¯èƒ½ä¼šå¿½ç•¥ç‰¹å®šä»»åŠ¡å¯¹å‚æ•°çš„ç‰¹æ®Šéœ€æ±‚ï¼Œå¯¼è‡´æ¨¡å‹æ€§èƒ½ä¸‹é™ã€‚</p>\n</blockquote>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ul>\n<li>ç ”ç©¶AdaLoRAåœ¨ä¸åŒä»»åŠ¡ä¸­çš„è¡¨ç°ã€‚</li>\n<li>æ¢ç´¢å…¶ä»–åŸºäºSVDçš„ä¼˜åŒ–æŠ€æœ¯ã€‚</li>\n<li>å®éªŒä¸åŒå‚æ•°è®¾ç½®å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚</li>\n</ul>\n<h2 id=\"æ•°æ®è½¬æ¢\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è½¬æ¢\"><span>æ•°æ®è½¬æ¢</span></a></h2>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>r</td>\n<td>å½“å‰ç§©</td>\n</tr>\n<tr>\n<td>lora_alpha</td>\n<td>è°ƒæ•´å› å­</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å…¬å¼æ˜¾ç¤º\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…¬å¼æ˜¾ç¤º\"><span>å…¬å¼æ˜¾ç¤º</span></a></h2>\n<p>ä½¿ç”¨å…¬å¼è¡¨ç¤ºå¥‡å¼‚å€¼ä¸ç§©å…³ç³»ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>ranknum</mtext><mo>=</mo><mi>Î±</mi><mo>â‹…</mo><mtext>scaling</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{ranknum} = \\alpha \\cdot \\text{scaling} \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">ranknum</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">Î±</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">scaling</span></span></span></span></span></span></p>\n<blockquote>\n<p>åŸå§‹å†…å®¹æ¥è‡ªPEFT/src/peft/tuners/adalora/layer.pyã€‚</p>\n</blockquote>\n","env":{"base":"/","filePath":"/Users/qianyuhe/Desktop/my-project/docs/notes_bak/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /RLå¼ºåŒ–å­¦ä¹ åŸºç¡€/LoRAåŠå…¶å˜ä½“/AdaLoRA.md","filePathRelative":"notes_bak/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /RLå¼ºåŒ–å­¦ä¹ åŸºç¡€/LoRAåŠå…¶å˜ä½“/AdaLoRA.md","frontmatter":{"dg-publish":true,"dg-permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /RLå¼ºåŒ–å­¦ä¹ åŸºç¡€/LoRAåŠå…¶å˜ä½“/AdaLoRA","dg-home":false,"dg-description":"åœ¨æ­¤è¾“å…¥ç¬”è®°çš„æè¿°","dg-hide":false,"dg-hide-title":false,"dg-show-backlinks":true,"dg-show-local-graph":true,"dg-show-inline-title":true,"dg-pinned":false,"dg-passphrase":"åœ¨æ­¤è¾“å…¥è®¿é—®å¯†ç ","dg-enable-mathjax":false,"dg-enable-mermaid":false,"dg-enable-uml":false,"dg-note-icon":0,"dg-enable-dataview":false,"tags":["NLP"],"permalink":"/å¤§è¯­è¨€æ¨¡å‹å­¦ä¹ /RLå¼ºåŒ–å­¦ä¹ åŸºç¡€/LoRAåŠå…¶å˜ä½“/AdaLoRA/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true,"dgPassFrontmatter":true,"noteIcon":0,"created":"2025-04-24T03:18:17.739Z","updated":"2025-04-24T03:18:43.096Z","title":"AdaLoRA","createTime":"2025/05/13 17:33:52"},"sfcBlocks":{"template":{"type":"template","content":"<template><h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<p>åˆ†ç±»ï¼šè‡ªåŠ¨æ¨æ–­</p>\n<p>æ ‡ç­¾ï¼šåŠ¨æ€é€‚é…ã€ä½ç§©åˆ†è§£ã€å¥‡å¼‚å€¼ã€æ·±åº¦å­¦ä¹ ã€AdaLoRA</p>\n<p>æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥</p>\n<h2 id=\"æ ¸å¿ƒè§‚ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒè§‚ç‚¹\"><span>æ ¸å¿ƒè§‚ç‚¹</span></a></h2>\n<p>AdaLoRAæ˜¯ä¸€ç§åˆ›æ–°çš„æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œå®ƒé€šè¿‡åŠ¨æ€è°ƒæ•´ä¸åŒå±‚å’Œå‚æ•°ç±»å‹çš„ç§©ï¼Œæ ¹æ®ä¸‹æ¸¸ä»»åŠ¡éœ€æ±‚è¿›è¡Œä¼˜åŒ–ã€‚è¿™ç§æ–¹æ³•é‡‡ç”¨åŸºäºSVDï¼ˆå¥‡å¼‚å€¼åˆ†è§£ï¼‰çš„å‚æ•°åŒ–å½¢å¼ï¼Œå¯ä»¥æœ‰æ•ˆè£å‰ªä¸é‡è¦çš„å¥‡å¼‚å€¼ï¼Œé™ä½è®¡ç®—å¤æ‚åº¦ã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250424111842.png\" alt=\"Pasted image 20250424111842.png\">\nğŸ’¡å¯å‘ç‚¹ï¼šé€šè¿‡åŠ¨æ€åˆ†é…ç§©å’Œä½¿ç”¨SVDå‚æ•°åŒ–ï¼ŒAdaLoRAå®ç°äº†è®¡ç®—æ•ˆç‡ä¸æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡ã€‚</p>\n<h2 id=\"é‡ç‚¹æ®µè½\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#é‡ç‚¹æ®µè½\"><span>é‡ç‚¹æ®µè½</span></a></h2>\n<h3 id=\"åŠ¨æ€ç§©åˆ†é…\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åŠ¨æ€ç§©åˆ†é…\"><span>åŠ¨æ€ç§©åˆ†é…</span></a></h3>\n<p>AdaLoRAä¸ä»…ä¸ºæ¯ä¸ªAdapteråˆ†é…ç›¸åŒçš„ç§©ï¼Œè€Œæ˜¯æ ¹æ®ä»»åŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´å„å±‚å’Œå‚æ•°ç±»å‹çš„ç§©ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆåœ°å¤„ç†ä¸åŒçš„ä»»åŠ¡ã€‚</p>\n<h3 id=\"svdå‚æ•°åŒ–å¢é‡æ›´æ–°\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#svdå‚æ•°åŒ–å¢é‡æ›´æ–°\"><span>SVDå‚æ•°åŒ–å¢é‡æ›´æ–°</span></a></h3>\n<p>é‡‡ç”¨SVDå½¢å¼å‚æ•°åŒ–å¢é‡æ›´æ–°ï¼Œèƒ½å¤Ÿåœ¨è§„é¿å¤æ‚è®¡ç®—çš„åŒæ—¶é«˜æ•ˆè£å‰ªä¸é‡è¦çš„å¥‡å¼‚å€¼ã€‚è¿™ç§æ–¹æ³•å¤§å¤§é™ä½äº†è®¡ç®—é‡ï¼Œå¹¶æé«˜äº†æ¨¡å‹çš„é€‚åº”èƒ½åŠ›ã€‚</p>\n<h3 id=\"æ ¸å¿ƒä»£ç è§£æ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒä»£ç è§£æ\"><span>æ ¸å¿ƒä»£ç è§£æ</span></a></h3>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> AdaLoraLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">LoraLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> update_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_alpha</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_dropout</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> init_lora_weights</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora_A</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Singular values</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora_E</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Left singular vectors</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora_B</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">out_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # The current rank</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ranknum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> requires_grad</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ranknum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fill_</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">float</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ranknum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">requires_grad </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> False</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">scaling</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_alpha </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_alpha </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> float</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"æ“ä½œæ­¥éª¤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ“ä½œæ­¥éª¤\"><span>æ“ä½œæ­¥éª¤</span></a></h2>\n<ol>\n<li>âœ… åˆå§‹åŒ–å‚æ•°çŸ©é˜µå¹¶åˆ†é…ç§©ã€‚</li>\n<li>âš  ä½¿ç”¨SVDè¿›è¡Œå¥‡å¼‚å€¼è£å‰ªã€‚</li>\n<li>â— æ ¹æ®ä»»åŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´é€‚é…å™¨æƒé‡ã€‚</li>\n</ol>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<blockquote>\n<p>âš  åœ¨è°ƒæ•´ç§©æ—¶ï¼Œå¯èƒ½ä¼šå¿½ç•¥ç‰¹å®šä»»åŠ¡å¯¹å‚æ•°çš„ç‰¹æ®Šéœ€æ±‚ï¼Œå¯¼è‡´æ¨¡å‹æ€§èƒ½ä¸‹é™ã€‚</p>\n</blockquote>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ul>\n<li>ç ”ç©¶AdaLoRAåœ¨ä¸åŒä»»åŠ¡ä¸­çš„è¡¨ç°ã€‚</li>\n<li>æ¢ç´¢å…¶ä»–åŸºäºSVDçš„ä¼˜åŒ–æŠ€æœ¯ã€‚</li>\n<li>å®éªŒä¸åŒå‚æ•°è®¾ç½®å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚</li>\n</ul>\n<h2 id=\"æ•°æ®è½¬æ¢\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è½¬æ¢\"><span>æ•°æ®è½¬æ¢</span></a></h2>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>r</td>\n<td>å½“å‰ç§©</td>\n</tr>\n<tr>\n<td>lora_alpha</td>\n<td>è°ƒæ•´å› å­</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å…¬å¼æ˜¾ç¤º\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…¬å¼æ˜¾ç¤º\"><span>å…¬å¼æ˜¾ç¤º</span></a></h2>\n<p>ä½¿ç”¨å…¬å¼è¡¨ç¤ºå¥‡å¼‚å€¼ä¸ç§©å…³ç³»ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>ranknum</mtext><mo>=</mo><mi>Î±</mi><mo>â‹…</mo><mtext>scaling</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{ranknum} = \\alpha \\cdot \\text{scaling} \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">ranknum</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">Î±</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">scaling</span></span></span></span></span></span></p>\n<blockquote>\n<p>åŸå§‹å†…å®¹æ¥è‡ªPEFT/src/peft/tuners/adalora/layer.pyã€‚</p>\n</blockquote>\n</template>","contentStripped":"<h2 id=\"å…ƒæ•°æ®\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…ƒæ•°æ®\"><span>å…ƒæ•°æ®</span></a></h2>\n<p>åˆ†ç±»ï¼šè‡ªåŠ¨æ¨æ–­</p>\n<p>æ ‡ç­¾ï¼šåŠ¨æ€é€‚é…ã€ä½ç§©åˆ†è§£ã€å¥‡å¼‚å€¼ã€æ·±åº¦å­¦ä¹ ã€AdaLoRA</p>\n<p>æ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥</p>\n<h2 id=\"æ ¸å¿ƒè§‚ç‚¹\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒè§‚ç‚¹\"><span>æ ¸å¿ƒè§‚ç‚¹</span></a></h2>\n<p>AdaLoRAæ˜¯ä¸€ç§åˆ›æ–°çš„æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œå®ƒé€šè¿‡åŠ¨æ€è°ƒæ•´ä¸åŒå±‚å’Œå‚æ•°ç±»å‹çš„ç§©ï¼Œæ ¹æ®ä¸‹æ¸¸ä»»åŠ¡éœ€æ±‚è¿›è¡Œä¼˜åŒ–ã€‚è¿™ç§æ–¹æ³•é‡‡ç”¨åŸºäºSVDï¼ˆå¥‡å¼‚å€¼åˆ†è§£ï¼‰çš„å‚æ•°åŒ–å½¢å¼ï¼Œå¯ä»¥æœ‰æ•ˆè£å‰ªä¸é‡è¦çš„å¥‡å¼‚å€¼ï¼Œé™ä½è®¡ç®—å¤æ‚åº¦ã€‚\n<img src=\"/img/user/é™„ä»¶/Pasted image 20250424111842.png\" alt=\"Pasted image 20250424111842.png\">\nğŸ’¡å¯å‘ç‚¹ï¼šé€šè¿‡åŠ¨æ€åˆ†é…ç§©å’Œä½¿ç”¨SVDå‚æ•°åŒ–ï¼ŒAdaLoRAå®ç°äº†è®¡ç®—æ•ˆç‡ä¸æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡ã€‚</p>\n<h2 id=\"é‡ç‚¹æ®µè½\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#é‡ç‚¹æ®µè½\"><span>é‡ç‚¹æ®µè½</span></a></h2>\n<h3 id=\"åŠ¨æ€ç§©åˆ†é…\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#åŠ¨æ€ç§©åˆ†é…\"><span>åŠ¨æ€ç§©åˆ†é…</span></a></h3>\n<p>AdaLoRAä¸ä»…ä¸ºæ¯ä¸ªAdapteråˆ†é…ç›¸åŒçš„ç§©ï¼Œè€Œæ˜¯æ ¹æ®ä»»åŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´å„å±‚å’Œå‚æ•°ç±»å‹çš„ç§©ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆåœ°å¤„ç†ä¸åŒçš„ä»»åŠ¡ã€‚</p>\n<h3 id=\"svdå‚æ•°åŒ–å¢é‡æ›´æ–°\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#svdå‚æ•°åŒ–å¢é‡æ›´æ–°\"><span>SVDå‚æ•°åŒ–å¢é‡æ›´æ–°</span></a></h3>\n<p>é‡‡ç”¨SVDå½¢å¼å‚æ•°åŒ–å¢é‡æ›´æ–°ï¼Œèƒ½å¤Ÿåœ¨è§„é¿å¤æ‚è®¡ç®—çš„åŒæ—¶é«˜æ•ˆè£å‰ªä¸é‡è¦çš„å¥‡å¼‚å€¼ã€‚è¿™ç§æ–¹æ³•å¤§å¤§é™ä½äº†è®¡ç®—é‡ï¼Œå¹¶æé«˜äº†æ¨¡å‹çš„é€‚åº”èƒ½åŠ›ã€‚</p>\n<h3 id=\"æ ¸å¿ƒä»£ç è§£æ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒä»£ç è§£æ\"><span>æ ¸å¿ƒä»£ç è§£æ</span></a></h3>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> AdaLoraLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">LoraLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> update_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_alpha</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_dropout</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> init_lora_weights</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora_A</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Singular values</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora_E</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Left singular vectors</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">lora_B</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">out_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # The current rank</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ranknum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Parameter</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">randn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> requires_grad</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ranknum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fill_</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">float</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ranknum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">].</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">requires_grad </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> False</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">scaling</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adapter_name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_alpha </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> lora_alpha </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> float</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">r</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"æ“ä½œæ­¥éª¤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ“ä½œæ­¥éª¤\"><span>æ“ä½œæ­¥éª¤</span></a></h2>\n<ol>\n<li>âœ… åˆå§‹åŒ–å‚æ•°çŸ©é˜µå¹¶åˆ†é…ç§©ã€‚</li>\n<li>âš  ä½¿ç”¨SVDè¿›è¡Œå¥‡å¼‚å€¼è£å‰ªã€‚</li>\n<li>â— æ ¹æ®ä»»åŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´é€‚é…å™¨æƒé‡ã€‚</li>\n</ol>\n<h2 id=\"å¸¸è§é”™è¯¯\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¸¸è§é”™è¯¯\"><span>å¸¸è§é”™è¯¯</span></a></h2>\n<blockquote>\n<p>âš  åœ¨è°ƒæ•´ç§©æ—¶ï¼Œå¯èƒ½ä¼šå¿½ç•¥ç‰¹å®šä»»åŠ¡å¯¹å‚æ•°çš„ç‰¹æ®Šéœ€æ±‚ï¼Œå¯¼è‡´æ¨¡å‹æ€§èƒ½ä¸‹é™ã€‚</p>\n</blockquote>\n<h2 id=\"è¡ŒåŠ¨æ¸…å•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#è¡ŒåŠ¨æ¸…å•\"><span>è¡ŒåŠ¨æ¸…å•</span></a></h2>\n<ul>\n<li>ç ”ç©¶AdaLoRAåœ¨ä¸åŒä»»åŠ¡ä¸­çš„è¡¨ç°ã€‚</li>\n<li>æ¢ç´¢å…¶ä»–åŸºäºSVDçš„ä¼˜åŒ–æŠ€æœ¯ã€‚</li>\n<li>å®éªŒä¸åŒå‚æ•°è®¾ç½®å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚</li>\n</ul>\n<h2 id=\"æ•°æ®è½¬æ¢\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ•°æ®è½¬æ¢\"><span>æ•°æ®è½¬æ¢</span></a></h2>\n<table>\n<thead>\n<tr>\n<th>å‚æ•°</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>r</td>\n<td>å½“å‰ç§©</td>\n</tr>\n<tr>\n<td>lora_alpha</td>\n<td>è°ƒæ•´å› å­</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"å…¬å¼æ˜¾ç¤º\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å…¬å¼æ˜¾ç¤º\"><span>å…¬å¼æ˜¾ç¤º</span></a></h2>\n<p>ä½¿ç”¨å…¬å¼è¡¨ç¤ºå¥‡å¼‚å€¼ä¸ç§©å…³ç³»ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>ranknum</mtext><mo>=</mo><mi>Î±</mi><mo>â‹…</mo><mtext>scaling</mtext></mrow><annotation encoding=\"application/x-tex\">\\text{ranknum} = \\alpha \\cdot \\text{scaling} \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">ranknum</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">Î±</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">â‹…</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord text\"><span class=\"mord\">scaling</span></span></span></span></span></span></p>\n<blockquote>\n<p>åŸå§‹å†…å®¹æ¥è‡ªPEFT/src/peft/tuners/adalora/layer.pyã€‚</p>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"\n## å…ƒæ•°æ®\nåˆ†ç±»ï¼šè‡ªåŠ¨æ¨æ–­\n\næ ‡ç­¾ï¼šåŠ¨æ€é€‚é…ã€ä½ç§©åˆ†è§£ã€å¥‡å¼‚å€¼ã€æ·±åº¦å­¦ä¹ ã€AdaLoRA\n\næ—¥æœŸï¼š2025å¹´4æœˆ12æ—¥\n\n\n## æ ¸å¿ƒè§‚ç‚¹\nAdaLoRAæ˜¯ä¸€ç§åˆ›æ–°çš„æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œå®ƒé€šè¿‡åŠ¨æ€è°ƒæ•´ä¸åŒå±‚å’Œå‚æ•°ç±»å‹çš„ç§©ï¼Œæ ¹æ®ä¸‹æ¸¸ä»»åŠ¡éœ€æ±‚è¿›è¡Œä¼˜åŒ–ã€‚è¿™ç§æ–¹æ³•é‡‡ç”¨åŸºäºSVDï¼ˆå¥‡å¼‚å€¼åˆ†è§£ï¼‰çš„å‚æ•°åŒ–å½¢å¼ï¼Œå¯ä»¥æœ‰æ•ˆè£å‰ªä¸é‡è¦çš„å¥‡å¼‚å€¼ï¼Œé™ä½è®¡ç®—å¤æ‚åº¦ã€‚\n![Pasted image 20250424111842.png](/img/user/%E9%99%84%E4%BB%B6/Pasted%20image%2020250424111842.png)\nğŸ’¡å¯å‘ç‚¹ï¼šé€šè¿‡åŠ¨æ€åˆ†é…ç§©å’Œä½¿ç”¨SVDå‚æ•°åŒ–ï¼ŒAdaLoRAå®ç°äº†è®¡ç®—æ•ˆç‡ä¸æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡ã€‚\n\n\n## é‡ç‚¹æ®µè½\n\n### åŠ¨æ€ç§©åˆ†é…\nAdaLoRAä¸ä»…ä¸ºæ¯ä¸ªAdapteråˆ†é…ç›¸åŒçš„ç§©ï¼Œè€Œæ˜¯æ ¹æ®ä»»åŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´å„å±‚å’Œå‚æ•°ç±»å‹çš„ç§©ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆåœ°å¤„ç†ä¸åŒçš„ä»»åŠ¡ã€‚\n\n\n### SVDå‚æ•°åŒ–å¢é‡æ›´æ–°\né‡‡ç”¨SVDå½¢å¼å‚æ•°åŒ–å¢é‡æ›´æ–°ï¼Œèƒ½å¤Ÿåœ¨è§„é¿å¤æ‚è®¡ç®—çš„åŒæ—¶é«˜æ•ˆè£å‰ªä¸é‡è¦çš„å¥‡å¼‚å€¼ã€‚è¿™ç§æ–¹æ³•å¤§å¤§é™ä½äº†è®¡ç®—é‡ï¼Œå¹¶æé«˜äº†æ¨¡å‹çš„é€‚åº”èƒ½åŠ›ã€‚\n\n\n### æ ¸å¿ƒä»£ç è§£æ\n```python\nclass AdaLoraLayer(LoraLayer):\n    def update_layer(self, adapter_name, r, lora_alpha, lora_dropout, init_lora_weights):\n        self.lora_A[adapter_name] = nn.Parameter(torch.randn(r, self.in_features))\n        # Singular values\n        self.lora_E[adapter_name] = nn.Parameter(torch.randn(r, 1))\n        # Left singular vectors\n        self.lora_B[adapter_name] = nn.Parameter(torch.randn(self.out_features, r))\n        # The current rank\n        self.ranknum[adapter_name] = nn.Parameter(torch.randn(1), requires_grad=False)\n        self.ranknum[adapter_name].data.fill_(float(r))\n        self.ranknum[adapter_name].requires_grad = False\n        self.scaling[adapter_name] = lora_alpha if lora_alpha > 0 else float(r)\n```\n\n\n## æ“ä½œæ­¥éª¤\n1. âœ… åˆå§‹åŒ–å‚æ•°çŸ©é˜µå¹¶åˆ†é…ç§©ã€‚\n2. âš  ä½¿ç”¨SVDè¿›è¡Œå¥‡å¼‚å€¼è£å‰ªã€‚\n3. â— æ ¹æ®ä»»åŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´é€‚é…å™¨æƒé‡ã€‚\n\n\n## å¸¸è§é”™è¯¯\n> âš  åœ¨è°ƒæ•´ç§©æ—¶ï¼Œå¯èƒ½ä¼šå¿½ç•¥ç‰¹å®šä»»åŠ¡å¯¹å‚æ•°çš„ç‰¹æ®Šéœ€æ±‚ï¼Œå¯¼è‡´æ¨¡å‹æ€§èƒ½ä¸‹é™ã€‚\n\n\n## è¡ŒåŠ¨æ¸…å•\n- ç ”ç©¶AdaLoRAåœ¨ä¸åŒä»»åŠ¡ä¸­çš„è¡¨ç°ã€‚\n- æ¢ç´¢å…¶ä»–åŸºäºSVDçš„ä¼˜åŒ–æŠ€æœ¯ã€‚\n- å®éªŒä¸åŒå‚æ•°è®¾ç½®å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚\n\n\n## æ•°æ®è½¬æ¢\n| å‚æ•° | æè¿° |\n|------|------|\n| r    | å½“å‰ç§© |\n| lora_alpha | è°ƒæ•´å› å­ |\n\n\n## å…¬å¼æ˜¾ç¤º\nä½¿ç”¨å…¬å¼è¡¨ç¤ºå¥‡å¼‚å€¼ä¸ç§©å…³ç³»ï¼š\n$$ \\text{ranknum} = \\alpha \\cdot \\text{scaling} $$\n\n> åŸå§‹å†…å®¹æ¥è‡ªPEFT/src/peft/tuners/adalora/layer.pyã€‚","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":2,"title":"å…ƒæ•°æ®","slug":"å…ƒæ•°æ®","link":"#å…ƒæ•°æ®","children":[]},{"level":2,"title":"æ ¸å¿ƒè§‚ç‚¹","slug":"æ ¸å¿ƒè§‚ç‚¹","link":"#æ ¸å¿ƒè§‚ç‚¹","children":[]},{"level":2,"title":"é‡ç‚¹æ®µè½","slug":"é‡ç‚¹æ®µè½","link":"#é‡ç‚¹æ®µè½","children":[{"level":3,"title":"åŠ¨æ€ç§©åˆ†é…","slug":"åŠ¨æ€ç§©åˆ†é…","link":"#åŠ¨æ€ç§©åˆ†é…","children":[]},{"level":3,"title":"SVDå‚æ•°åŒ–å¢é‡æ›´æ–°","slug":"svdå‚æ•°åŒ–å¢é‡æ›´æ–°","link":"#svdå‚æ•°åŒ–å¢é‡æ›´æ–°","children":[]},{"level":3,"title":"æ ¸å¿ƒä»£ç è§£æ","slug":"æ ¸å¿ƒä»£ç è§£æ","link":"#æ ¸å¿ƒä»£ç è§£æ","children":[]}]},{"level":2,"title":"æ“ä½œæ­¥éª¤","slug":"æ“ä½œæ­¥éª¤","link":"#æ“ä½œæ­¥éª¤","children":[]},{"level":2,"title":"å¸¸è§é”™è¯¯","slug":"å¸¸è§é”™è¯¯","link":"#å¸¸è§é”™è¯¯","children":[]},{"level":2,"title":"è¡ŒåŠ¨æ¸…å•","slug":"è¡ŒåŠ¨æ¸…å•","link":"#è¡ŒåŠ¨æ¸…å•","children":[]},{"level":2,"title":"æ•°æ®è½¬æ¢","slug":"æ•°æ®è½¬æ¢","link":"#æ•°æ®è½¬æ¢","children":[]},{"level":2,"title":"å…¬å¼æ˜¾ç¤º","slug":"å…¬å¼æ˜¾ç¤º","link":"#å…¬å¼æ˜¾ç¤º","children":[]}]}}
