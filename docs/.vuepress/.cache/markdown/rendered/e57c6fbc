{"content":"<h2 id=\"元数据\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#元数据\"><span>元数据</span></a></h2>\n<ul>\n<li>分类：自然语言处理</li>\n<li>标签：多轮对话、数据构造、模型优化、伪多轮数据</li>\n<li>日期：2023年11月1日</li>\n</ul>\n<h2 id=\"核心观点总结\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#核心观点总结\"><span>核心观点总结</span></a></h2>\n<p>本文讨论了如何通过多轮对话数据的构造和优化来提升对话模型的表现。重点在于如何判断和利用真多轮与伪多轮数据，以及如何通过合成和飞轮机制来增强数据集。此外，还介绍了通过样本拆分和合并来加速计算的策略。</p>\n<h2 id=\"重点段落\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#重点段落\"><span>重点段落</span></a></h2>\n<h3 id=\"多轮对话数据判断\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#多轮对话数据判断\"><span>多轮对话数据判断</span></a></h3>\n<p>✅ 首先，训练一个小的判别模型来判断session中的每个turn是否连续。连续为1，不连续为0。主题不变的真多轮数据直接加入训练，而主题变化的伪多轮数据则选择性加入，以提高模型学习难度。</p>\n<h3 id=\"多轮对话数据合成\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#多轮对话数据合成\"><span>多轮对话数据合成</span></a></h3>\n<p>✅ 如果现有数据量不足，可以利用单轮对话合成多轮对话数据。通过第一轮的数据构造第二轮的提示（prompt），可以使用模板或GPT进行合成，然后继续合成回答。</p>\n<h3 id=\"多轮计算loss\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#多轮计算loss\"><span>多轮计算loss<img src=\"/img/user/附件/Pasted image 20250411130451.png\" alt=\"Pasted image 20250411130451.png\"></span></a></h3>\n<p>✅ 假设一个对话中有3轮user和bot的交互，可以构建三个样本。计算loss时，只计算bot response部分，公式为：</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>loss</mtext><mo>=</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><mrow><mo fence=\"true\">(</mo><msub><mi>n</mi><mn>1</mn></msub><mo>⋅</mo><msub><mi>l</mi><mn>1</mn></msub><mo>+</mo><msub><mi>n</mi><mn>2</mn></msub><mo>⋅</mo><msub><mi>l</mi><mn>2</mn></msub><mo>+</mo><msub><mi>n</mi><mn>3</mn></msub><mo>⋅</mo><msub><mi>l</mi><mn>3</mn></msub><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\text{loss} = \\frac{1}{3} \\left( n_1 \\cdot l_1 + n_2 \\cdot l_2 + n_3 \\cdot l_3 \\right)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">loss</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0074em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span></span></span></span></span></p>\n<p>其中，$$l_i$$表示第$$i$$个样本的loss，$$n_i$$表示第$$i$$个样本输出的token数量。</p>\n<h2 id=\"常见错误\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误\"><span>常见错误</span></a></h2>\n<p>⚠️ 如果将多个样本合并为一个样本进行计算，需注意token_ids和labels的设置，否则会导致loss计算错误。</p>\n<h2 id=\"💡启发点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#💡启发点\"><span>💡启发点</span></a></h2>\n<ul>\n<li>适量伪多轮数据能够有效提升模型的学习能力。</li>\n<li>数据飞轮机制有助于持续优化模型。</li>\n</ul>\n<h2 id=\"行动清单\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#行动清单\"><span>行动清单</span></a></h2>\n<ul>\n<li>评估现有对话数据是否符合真多轮和伪多轮的标准。</li>\n<li>实施数据合成策略以扩大训练集。</li>\n<li>优化loss计算方法以提高训练效率。</li>\n</ul>\n<h2 id=\"📈趋势预测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#📈趋势预测\"><span>📈趋势预测</span></a></h2>\n<p>随着对话系统需求的增加，未来在多轮对话数据的自动构造和优化方面将会有更多创新技术出现。</p>\n<h2 id=\"后续追踪\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#后续追踪\"><span>后续追踪</span></a></h2>\n<ul>\n<li>探索更多关于伪多轮数据对模型影响的实证研究。</li>\n<li>研究如何更高效地实现多轮对话数据飞轮机制。</li>\n</ul>\n<h2 id=\"思考\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#思考\"><span>[思考]</span></a></h2>\n<ul>\n<li>如何进一步提高伪多轮数据的质量？</li>\n<li>有哪些新的方法可以自动识别和合成多轮对话？</li>\n<li>在不同应用场景下，多轮对话模型需要做哪些调整？</li>\n</ul>\n<blockquote>\n<p>原始出处：本文内容基于提供的文本进行总结与整理。\n[[大语言模型学习/后训练/SFT监督微调/STF训练/多轮对话专项提升2|多轮对话专项提升2]]</p>\n</blockquote>\n","env":{"base":"/","filePath":"/Users/qianyuhe/Desktop/my-project/docs/notes_bak/大语言模型学习/后训练/SFT监督微调/STF训练/多轮对话专项提升.md","filePathRelative":"notes_bak/大语言模型学习/后训练/SFT监督微调/STF训练/多轮对话专项提升.md","frontmatter":{"dg-publish":true,"dg-permalink":"/大语言模型学习/后训练/SFT监督微调/STF训练/多轮对话专项提升","dg-home":false,"dg-description":"在此输入笔记的描述","dg-hide":false,"dg-hide-title":false,"dg-show-backlinks":true,"dg-show-local-graph":true,"dg-show-inline-title":true,"dg-pinned":false,"dg-passphrase":"在此输入访问密码","dg-enable-mathjax":false,"dg-enable-mermaid":false,"dg-enable-uml":false,"dg-note-icon":0,"dg-enable-dataview":false,"tags":["NLP"],"permalink":"/大语言模型学习/后训练/SFT监督微调/STF训练/多轮对话专项提升/","dgShowBacklinks":true,"dgShowLocalGraph":true,"dgShowInlineTitle":true,"dgPassFrontmatter":true,"noteIcon":0,"created":"2025-04-11T03:12:39.000Z","updated":"2025-04-13T05:06:02.000Z","title":"多轮对话专项提升","createTime":"2025/05/13 17:33:52"},"sfcBlocks":{"template":{"type":"template","content":"<template><h2 id=\"元数据\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#元数据\"><span>元数据</span></a></h2>\n<ul>\n<li>分类：自然语言处理</li>\n<li>标签：多轮对话、数据构造、模型优化、伪多轮数据</li>\n<li>日期：2023年11月1日</li>\n</ul>\n<h2 id=\"核心观点总结\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#核心观点总结\"><span>核心观点总结</span></a></h2>\n<p>本文讨论了如何通过多轮对话数据的构造和优化来提升对话模型的表现。重点在于如何判断和利用真多轮与伪多轮数据，以及如何通过合成和飞轮机制来增强数据集。此外，还介绍了通过样本拆分和合并来加速计算的策略。</p>\n<h2 id=\"重点段落\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#重点段落\"><span>重点段落</span></a></h2>\n<h3 id=\"多轮对话数据判断\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#多轮对话数据判断\"><span>多轮对话数据判断</span></a></h3>\n<p>✅ 首先，训练一个小的判别模型来判断session中的每个turn是否连续。连续为1，不连续为0。主题不变的真多轮数据直接加入训练，而主题变化的伪多轮数据则选择性加入，以提高模型学习难度。</p>\n<h3 id=\"多轮对话数据合成\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#多轮对话数据合成\"><span>多轮对话数据合成</span></a></h3>\n<p>✅ 如果现有数据量不足，可以利用单轮对话合成多轮对话数据。通过第一轮的数据构造第二轮的提示（prompt），可以使用模板或GPT进行合成，然后继续合成回答。</p>\n<h3 id=\"多轮计算loss\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#多轮计算loss\"><span>多轮计算loss<img src=\"/img/user/附件/Pasted image 20250411130451.png\" alt=\"Pasted image 20250411130451.png\"></span></a></h3>\n<p>✅ 假设一个对话中有3轮user和bot的交互，可以构建三个样本。计算loss时，只计算bot response部分，公式为：</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>loss</mtext><mo>=</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><mrow><mo fence=\"true\">(</mo><msub><mi>n</mi><mn>1</mn></msub><mo>⋅</mo><msub><mi>l</mi><mn>1</mn></msub><mo>+</mo><msub><mi>n</mi><mn>2</mn></msub><mo>⋅</mo><msub><mi>l</mi><mn>2</mn></msub><mo>+</mo><msub><mi>n</mi><mn>3</mn></msub><mo>⋅</mo><msub><mi>l</mi><mn>3</mn></msub><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\text{loss} = \\frac{1}{3} \\left( n_1 \\cdot l_1 + n_2 \\cdot l_2 + n_3 \\cdot l_3 \\right)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">loss</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0074em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span></span></span></span></span></p>\n<p>其中，$$l_i$$表示第$$i$$个样本的loss，$$n_i$$表示第$$i$$个样本输出的token数量。</p>\n<h2 id=\"常见错误\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误\"><span>常见错误</span></a></h2>\n<p>⚠️ 如果将多个样本合并为一个样本进行计算，需注意token_ids和labels的设置，否则会导致loss计算错误。</p>\n<h2 id=\"💡启发点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#💡启发点\"><span>💡启发点</span></a></h2>\n<ul>\n<li>适量伪多轮数据能够有效提升模型的学习能力。</li>\n<li>数据飞轮机制有助于持续优化模型。</li>\n</ul>\n<h2 id=\"行动清单\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#行动清单\"><span>行动清单</span></a></h2>\n<ul>\n<li>评估现有对话数据是否符合真多轮和伪多轮的标准。</li>\n<li>实施数据合成策略以扩大训练集。</li>\n<li>优化loss计算方法以提高训练效率。</li>\n</ul>\n<h2 id=\"📈趋势预测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#📈趋势预测\"><span>📈趋势预测</span></a></h2>\n<p>随着对话系统需求的增加，未来在多轮对话数据的自动构造和优化方面将会有更多创新技术出现。</p>\n<h2 id=\"后续追踪\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#后续追踪\"><span>后续追踪</span></a></h2>\n<ul>\n<li>探索更多关于伪多轮数据对模型影响的实证研究。</li>\n<li>研究如何更高效地实现多轮对话数据飞轮机制。</li>\n</ul>\n<h2 id=\"思考\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#思考\"><span>[思考]</span></a></h2>\n<ul>\n<li>如何进一步提高伪多轮数据的质量？</li>\n<li>有哪些新的方法可以自动识别和合成多轮对话？</li>\n<li>在不同应用场景下，多轮对话模型需要做哪些调整？</li>\n</ul>\n<blockquote>\n<p>原始出处：本文内容基于提供的文本进行总结与整理。\n[[大语言模型学习/后训练/SFT监督微调/STF训练/多轮对话专项提升2|多轮对话专项提升2]]</p>\n</blockquote>\n</template>","contentStripped":"<h2 id=\"元数据\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#元数据\"><span>元数据</span></a></h2>\n<ul>\n<li>分类：自然语言处理</li>\n<li>标签：多轮对话、数据构造、模型优化、伪多轮数据</li>\n<li>日期：2023年11月1日</li>\n</ul>\n<h2 id=\"核心观点总结\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#核心观点总结\"><span>核心观点总结</span></a></h2>\n<p>本文讨论了如何通过多轮对话数据的构造和优化来提升对话模型的表现。重点在于如何判断和利用真多轮与伪多轮数据，以及如何通过合成和飞轮机制来增强数据集。此外，还介绍了通过样本拆分和合并来加速计算的策略。</p>\n<h2 id=\"重点段落\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#重点段落\"><span>重点段落</span></a></h2>\n<h3 id=\"多轮对话数据判断\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#多轮对话数据判断\"><span>多轮对话数据判断</span></a></h3>\n<p>✅ 首先，训练一个小的判别模型来判断session中的每个turn是否连续。连续为1，不连续为0。主题不变的真多轮数据直接加入训练，而主题变化的伪多轮数据则选择性加入，以提高模型学习难度。</p>\n<h3 id=\"多轮对话数据合成\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#多轮对话数据合成\"><span>多轮对话数据合成</span></a></h3>\n<p>✅ 如果现有数据量不足，可以利用单轮对话合成多轮对话数据。通过第一轮的数据构造第二轮的提示（prompt），可以使用模板或GPT进行合成，然后继续合成回答。</p>\n<h3 id=\"多轮计算loss\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#多轮计算loss\"><span>多轮计算loss<img src=\"/img/user/附件/Pasted image 20250411130451.png\" alt=\"Pasted image 20250411130451.png\"></span></a></h3>\n<p>✅ 假设一个对话中有3轮user和bot的交互，可以构建三个样本。计算loss时，只计算bot response部分，公式为：</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>loss</mtext><mo>=</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><mrow><mo fence=\"true\">(</mo><msub><mi>n</mi><mn>1</mn></msub><mo>⋅</mo><msub><mi>l</mi><mn>1</mn></msub><mo>+</mo><msub><mi>n</mi><mn>2</mn></msub><mo>⋅</mo><msub><mi>l</mi><mn>2</mn></msub><mo>+</mo><msub><mi>n</mi><mn>3</mn></msub><mo>⋅</mo><msub><mi>l</mi><mn>3</mn></msub><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\text{loss} = \\frac{1}{3} \\left( n_1 \\cdot l_1 + n_2 \\cdot l_2 + n_3 \\cdot l_3 \\right)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord text\"><span class=\"mord\">loss</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0074em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span></span></span></span></span></p>\n<p>其中，$$l_i$$表示第$$i$$个样本的loss，$$n_i$$表示第$$i$$个样本输出的token数量。</p>\n<h2 id=\"常见错误\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#常见错误\"><span>常见错误</span></a></h2>\n<p>⚠️ 如果将多个样本合并为一个样本进行计算，需注意token_ids和labels的设置，否则会导致loss计算错误。</p>\n<h2 id=\"💡启发点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#💡启发点\"><span>💡启发点</span></a></h2>\n<ul>\n<li>适量伪多轮数据能够有效提升模型的学习能力。</li>\n<li>数据飞轮机制有助于持续优化模型。</li>\n</ul>\n<h2 id=\"行动清单\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#行动清单\"><span>行动清单</span></a></h2>\n<ul>\n<li>评估现有对话数据是否符合真多轮和伪多轮的标准。</li>\n<li>实施数据合成策略以扩大训练集。</li>\n<li>优化loss计算方法以提高训练效率。</li>\n</ul>\n<h2 id=\"📈趋势预测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#📈趋势预测\"><span>📈趋势预测</span></a></h2>\n<p>随着对话系统需求的增加，未来在多轮对话数据的自动构造和优化方面将会有更多创新技术出现。</p>\n<h2 id=\"后续追踪\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#后续追踪\"><span>后续追踪</span></a></h2>\n<ul>\n<li>探索更多关于伪多轮数据对模型影响的实证研究。</li>\n<li>研究如何更高效地实现多轮对话数据飞轮机制。</li>\n</ul>\n<h2 id=\"思考\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#思考\"><span>[思考]</span></a></h2>\n<ul>\n<li>如何进一步提高伪多轮数据的质量？</li>\n<li>有哪些新的方法可以自动识别和合成多轮对话？</li>\n<li>在不同应用场景下，多轮对话模型需要做哪些调整？</li>\n</ul>\n<blockquote>\n<p>原始出处：本文内容基于提供的文本进行总结与整理。\n[[大语言模型学习/后训练/SFT监督微调/STF训练/多轮对话专项提升2|多轮对话专项提升2]]</p>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"\n## 元数据\n- 分类：自然语言处理\n- 标签：多轮对话、数据构造、模型优化、伪多轮数据\n- 日期：2023年11月1日\n\n\n## 核心观点总结\n本文讨论了如何通过多轮对话数据的构造和优化来提升对话模型的表现。重点在于如何判断和利用真多轮与伪多轮数据，以及如何通过合成和飞轮机制来增强数据集。此外，还介绍了通过样本拆分和合并来加速计算的策略。\n\n\n## 重点段落\n\n### 多轮对话数据判断\n✅ 首先，训练一个小的判别模型来判断session中的每个turn是否连续。连续为1，不连续为0。主题不变的真多轮数据直接加入训练，而主题变化的伪多轮数据则选择性加入，以提高模型学习难度。\n\n\n### 多轮对话数据合成\n✅ 如果现有数据量不足，可以利用单轮对话合成多轮对话数据。通过第一轮的数据构造第二轮的提示（prompt），可以使用模板或GPT进行合成，然后继续合成回答。\n\n\n### 多轮计算loss![Pasted image 20250411130451.png](/img/user/%E9%99%84%E4%BB%B6/Pasted%20image%2020250411130451.png)\n✅ 假设一个对话中有3轮user和bot的交互，可以构建三个样本。计算loss时，只计算bot response部分，公式为：\n$$\n\\text{loss} = \\frac{1}{3} \\left( n_1 \\cdot l_1 + n_2 \\cdot l_2 + n_3 \\cdot l_3 \\right)\n$$\n其中，$$l_i$$表示第$$i$$个样本的loss，$$n_i$$表示第$$i$$个样本输出的token数量。\n\n\n## 常见错误\n⚠️ 如果将多个样本合并为一个样本进行计算，需注意token_ids和labels的设置，否则会导致loss计算错误。\n\n\n## 💡启发点\n- 适量伪多轮数据能够有效提升模型的学习能力。\n- 数据飞轮机制有助于持续优化模型。\n\n\n## 行动清单\n- 评估现有对话数据是否符合真多轮和伪多轮的标准。\n- 实施数据合成策略以扩大训练集。\n- 优化loss计算方法以提高训练效率。\n\n\n## 📈趋势预测\n随着对话系统需求的增加，未来在多轮对话数据的自动构造和优化方面将会有更多创新技术出现。\n\n\n## 后续追踪\n- 探索更多关于伪多轮数据对模型影响的实证研究。\n- 研究如何更高效地实现多轮对话数据飞轮机制。\n\n\n## [思考]\n- 如何进一步提高伪多轮数据的质量？\n- 有哪些新的方法可以自动识别和合成多轮对话？\n- 在不同应用场景下，多轮对话模型需要做哪些调整？\n\n> 原始出处：本文内容基于提供的文本进行总结与整理。\n[[大语言模型学习/后训练/SFT监督微调/STF训练/多轮对话专项提升2\\|多轮对话专项提升2]]","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":2,"title":"元数据","slug":"元数据","link":"#元数据","children":[]},{"level":2,"title":"核心观点总结","slug":"核心观点总结","link":"#核心观点总结","children":[]},{"level":2,"title":"重点段落","slug":"重点段落","link":"#重点段落","children":[{"level":3,"title":"多轮对话数据判断","slug":"多轮对话数据判断","link":"#多轮对话数据判断","children":[]},{"level":3,"title":"多轮对话数据合成","slug":"多轮对话数据合成","link":"#多轮对话数据合成","children":[]},{"level":3,"title":"多轮计算loss","slug":"多轮计算loss","link":"#多轮计算loss","children":[]}]},{"level":2,"title":"常见错误","slug":"常见错误","link":"#常见错误","children":[]},{"level":2,"title":"💡启发点","slug":"💡启发点","link":"#💡启发点","children":[]},{"level":2,"title":"行动清单","slug":"行动清单","link":"#行动清单","children":[]},{"level":2,"title":"📈趋势预测","slug":"📈趋势预测","link":"#📈趋势预测","children":[]},{"level":2,"title":"后续追踪","slug":"后续追踪","link":"#后续追踪","children":[]},{"level":2,"title":"[思考]","slug":"思考","link":"#思考","children":[]}]}}
